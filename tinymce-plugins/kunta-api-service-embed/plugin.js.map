{"version":3,"sources":["../src/kunta-api-service-embed/build/plugin.js"],"names":["$","ElectronicServiceChannelEditorDialog","editor","channel","console","log","JSON","stringify","on","onAfterDialogOpen","bind","locale","name","getTypedLocalizedValue","serviceChannel","names","shortDescription","descriptions","description","requiresAuthentication","requiresSignature","signatureQuantity","supportPhones","getLocalizedPhoneNumbers","supportEmails","getLocalizedEmails","url","getLocalizedValue","urls","languages","attachments","filter","attachment","language","webPages","getLocalizedWebPages","serviceHours","publishingStatus","getElectronicServiceChannelMetaform","areaCodes","areasToForm","areas","areaType","formValues","result","parse","service","supportedLocales","forEach","localeValues","getFormBooleanValue","setTypedLocalizedValue","setLocalizedTableValues","supportPhone","number","Object","assign","isFinnishServiceNumber","type","supportEmail","value","setLocalizedValue","newFormValues","areasFromForm","viewModel","getElectronicServiceChannelAdditionalDetailsMetaform","additionalDetailsToForm","dialog","openMetaformDialog","prepareViewModel","additionalDetailsFromForm","createAreasAutocomplete","find","data","onAddServiceHourClick","onEditServiceHourClick","onRemoveServiceHourClick","onEditAdditionalDetailsClick","redrawServiceHours","linkInputs","event","openServiceHourEditDialog","createdServiceHour","push","row","target","closest","index","serviceHour","updatedServiceHour","splice","openAdditionalDetailsEditDialog","window","AbstractServiceChannelEditorDialog","jQuery","ServiceChannelsDialog","callback","post","ajaxurl","response","fail","responseText","statusText","getServiceChannelsMetaform","tabs","id","title","openTabbedMetaformDialog","addClass","electronicChannelsTable","tableField","_onAfterElectronicChannelTableProcessRow","electronicServiceChannelPromises","electronicServiceChannelIds","map","electronicServiceChannelId","findElectronicServiceChannel","_onElectronicChannelTableEditChannelButtonClick","Promise","all","then","electronicServiceChannels","metaformAutocomplete","label","remove","channelId","close","channelDialog","open","catch","err","tinyMCE","activeEditor","windowManager","alert","element","input","searchElectronicServiceChannels","term","channels","preventDefault","openElectronicServiceChannelEditor","KuntaApiAbstractEditDialog","tinymce","SUPPORTED_COMPONENTS","ServiceDialog","getServiceMetaform","serviceToForm","openLocalizedMetaformDialog","updatedService","translateServiceFromForm","validationError","validate","showError","saveService","removeClass","getServiceAdditionalDetailsMetaform","createLanguagesAutocomplete","languageCodes","createServiceProducersAutocomplete","serviceProducersPurchaseServiceItems","serviceProducersOtherItems","chargeType","fundingType","alternateName","chargeTypeAdditionalInfo","userInstruction","deadLineAdditionalInfo","processingTimeAdditionalInfo","validityTimeAdditionalInfo","requirements","vouchers","voucher","legislation","legistation","webPage","serviceChargeType","serviceVouchersInUse","length","serviceVouchers","organizationItems","metaformMultivalueAutocomplete","search","splitSearchTerms","searchOrganizations","organizations","organization","serviceOrganizations","provisionType","findPromises","serviceOrganization","roleType","findOrganization","organizationId","formPromises","languagesToForm","serviceProducersToForm","results","serviceProducersPurchaseServices","serviceProducersOthers","serviceProducersSelfProduced","split","responsibleOrganizations","formProducersPurchaseServices","formProducersOthers","serviceProducersPurchaseOthers","ServiceEditor","buttonStyle","onBeforeSetcontent","onGetContent","onDblClick","addCommand","onServiceEdit","string","re","match","exec","content","replace","tag","attributesText","end","attributes","parseAttributes","placeholder","attr","css","i","attribute","component","getComponentTitle","append","html","shortcodeAttributes","attributeNames","attributeName","attributeValue","join","placeholderAttr","serviceId","execCommand","replaceShortcodes","restoreShortcodes","openElementEditor","ui","options","findService","channelComponents","indexOf","ServiceEmbed","displayLocale","searching","pending","addButton","onclick","width","height","body","onKeyUp","e","searchServices","innerResponse","handleResponse","classes","text","minHeight","onsubmit","responseHtml","allEmbedsFromSameChannel","componentsToEmbed","each","insertContent","query","empty","values","resultContainer","getLocalizedValueAndType","keys","appendResult","PluginManager","add"],"mappings":"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","file":"plugin.js","sourcesContent":["/* jshint esversion: 6 */\n/* global ajaxurl, moment, Promise */\n(($) => {\n  'use strict';\n  \n  class ElectronicServiceChannelEditorDialog extends window.AbstractServiceChannelEditorDialog {\n\n    /**\n     * Constructs service channel editor dialog\n     * \n     * @param {type} editor TinyMCE editor instance\n     * @param {type} channel\n     */\n    constructor(editor, channel) {\n      super(editor, channel, 'kunta_api_save_electronic_service_channel');\n      \n      console.log(JSON.stringify(channel, null, 2));\n      \n      this.on(\"afterDialogOpen\", this.onAfterDialogOpen.bind(this));\n    }\n    \n    /**\n     * Translates service channel to be suitable for form\n     * \n     * @param {String} locale locale\n     * @returns {Object} form data\n     */\n    serviceChannelToForm(locale) {\n      return {\n        name: this.getTypedLocalizedValue(this.serviceChannel.names, locale, 'Name'),\n        shortDescription: this.getTypedLocalizedValue(this.serviceChannel.descriptions, locale, 'ShortDescription'),\n        description: this.getTypedLocalizedValue(this.serviceChannel.descriptions, locale, 'Description'),\n        requiresAuthentication: this.serviceChannel.requiresAuthentication,\n        requiresSignature: this.serviceChannel.requiresSignature,\n        signatureQuantity: this.serviceChannel.signatureQuantity,\n        supportPhones: this.getLocalizedPhoneNumbers(this.serviceChannel.supportPhones, locale),\n        supportEmails: this.getLocalizedEmails(this.serviceChannel.supportEmails, locale),\n        url: this.getLocalizedValue(this.serviceChannel.urls, locale),\n        languages: this.serviceChannel.languages,\n        attachments: (this.serviceChannel.attachments || []).filter((attachment) => {\n          return attachment.url && attachment.language === locale;\n        }),\n        webPages: this.getLocalizedWebPages(this.serviceChannel.webPages, locale),\n        serviceHours: null,\n        publishingStatus: this.serviceChannel.publishingStatus\n      };\n    }\n    \n    /**\n     * Returns main form for service channel\n     * \n     * @returns {Object} metaform\n     */\n    getServiceChannelFormViewModel() {\n      return getElectronicServiceChannelMetaform();\n    }\n    \n    additionalDetailsToForm(serviceChannel) {\n      return {\n        areaCodes: this.areasToForm(serviceChannel.areas),\n        areaType: serviceChannel.areaType\n      };\n    }\n    \n    translateServiceFromForm(formValues) {\n      const result = JSON.parse(JSON.stringify(this.service));\n    }\n    \n    /**\n     * Translates form values to service channel\n     * \n     * @param {type} channel original channel data\n     * @param {type} formValues form values\n     * @returns {Object} updated service\n     */\n    serviceChannelFromForm(channel, formValues) {\n      const result = JSON.parse(JSON.stringify(channel));\n      \n      result.names = [];\n      result.descriptions = [];\n      result.urls = [];\n      result.attachments = [];\n      result.requiresSignature = false;\n      result.requiresAuthentication = false;\n      result.supportPhones = [];\n      result.supportEmails = [];\n      result.urls = [];\n      result.attachments = [];\n  \n      this.supportedLocales.forEach((locale) => {\n        const localeValues = formValues[locale];\n        \n        result.signatureQuantity = localeValues.signatureQuantity || result.signatureQuantity;\n        result.requiresSignature = this.getFormBooleanValue(localeValues.requiresSignature, result.requiresSignature);\n        result.publishingStatus = localeValues.publishingStatus || result.publishingStatus;\n        result.requiresAuthentication = this.getFormBooleanValue(localeValues.requiresAuthentication, result.requiresAuthentication);\n        \n        this.setTypedLocalizedValue(result, 'names', localeValues, 'name', locale, 'Name');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'shortDescription', locale, 'ShortDescription');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'description', locale, 'Description');\n\n        this.setLocalizedTableValues(result, 'supportPhones', localeValues, 'supportPhones', locale, (supportPhone) => {\n          return !!supportPhone.number;\n        }, (supportPhone) => {\n          return Object.assign({}, supportPhone, {\n            language: locale,\n            isFinnishServiceNumber: \"true\" === supportPhone.isFinnishServiceNumber,\n            type: \"Phone\"\n          });\n        });\n        \n        this.setLocalizedTableValues(result, 'supportEmails', localeValues, 'supportEmails', locale, (supportEmail) => {\n          return !!supportEmail.value;\n        });\n        \n        this.setLocalizedValue(result, 'urls', localeValues, 'url', locale);\n        this.setLocalizedTableValues(result, 'attachments', localeValues, 'attachments', locale, (attachment) => {\n          return !!attachment.url;\n        }, (attachment) => {\n          return Object.assign(attachment, {\n            language: locale,\n            type: 'Attachment'\n          });\n        });\n      });\n      \n      return result;\n    }\n    \n    additionalDetailsFromForm(newFormValues) {\n      this.serviceChannel.areaType = newFormValues.areaType;\n      this.serviceChannel.areas = this.areasFromForm(newFormValues.areaType, newFormValues.areas);\n    }\n    \n    openAdditionalDetailsEditDialog() {\n      const viewModel = getElectronicServiceChannelAdditionalDetailsMetaform();\n      const formValues = this.additionalDetailsToForm(this.serviceChannel);\n\n      const dialog = this.openMetaformDialog(this.prepareViewModel(viewModel), formValues, (newFormValues) => {\n        this.additionalDetailsFromForm(newFormValues);\n      });\n\n      this.createAreasAutocomplete(dialog.find('*[data-name=\"areas\"]'), formValues.areaCodes);      \n    }\n    \n    /**\n     * Method invoked after dialog open\n     * \n     * @param {Object} data event data\n     */\n    onAfterDialogOpen(data) {\n      const dialog = data.dialog;\n      \n      $(dialog).on('click', '.add-service-hour', this.onAddServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-service-hour', this.onEditServiceHourClick.bind(this));\n      $(dialog).on('click', '.remove-service-hour', this.onRemoveServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-additional-details', this.onEditAdditionalDetailsClick.bind(this));\n      \n      this.redrawServiceHours();\n      this.linkInputs(dialog, ['requiresAuthentication', 'requiresSignature', 'signatureQuantity']);\n    }\n    \n    onAddServiceHourClick(event) {\n      this.openServiceHourEditDialog(null, (createdServiceHour) => {\n        this.serviceChannel.serviceHours.push(createdServiceHour);\n        this.redrawServiceHours();\n      });\n    }\n    \n    onEditServiceHourClick(event) {\n      const row = $(event.target).closest('tr');\n      const index = row.index();\n      const serviceHour = this.serviceChannel.serviceHours[index];\n      \n      this.openServiceHourEditDialog(serviceHour, (updatedServiceHour) => {\n        this.serviceChannel.serviceHours.splice(index, 1, updatedServiceHour);\n        this.redrawServiceHours();\n      });\n    }\n    \n    onRemoveServiceHourClick(event) {\n      const row = $(event.target).closest('tr');\n      const index = row.index();\n      this.serviceChannel.serviceHours.splice(index, 1);\n      this.redrawServiceHours();\n    }\n    \n    onEditAdditionalDetailsClick() {\n      this.openAdditionalDetailsEditDialog(this.serviceChannel);\n    }\n  }\n  \n  window.ElectronicServiceChannelEditorDialog = ElectronicServiceChannelEditorDialog;\n  \n})(jQuery);;/* jshint esversion: 6 */\n/* global ajaxurl, moment, Promise */\n(($) => {\n  'use strict';\n  \n  class ServiceChannelsDialog extends window.KuntaApiAbstractEditDialog {\n\n    /**\n     * Constructs service channels dialog\n     * \n     * @param {type} editor TinyMCE editor instance\n     * @param {type} service\n     */\n    constructor(editor, service) {\n      super(editor);\n      this.service = service;\n    }\n\n    saveService(service, callback) {\n      $.post(ajaxurl, {\n        'action': 'kunta_api_save_service',\n        'service': JSON.stringify(this.service)\n      }, (response) => {\n        callback();\n      })\n      .fail((response) => {\n        callback(response.responseText || response.statusText || \"Unknown error occurred\");\n      });\n    }\n\n    open() {\n      const viewModel = getServiceChannelsMetaform();\n      const formValues = {};\n      const tabs = [{\n        id: 'electronic-channels',\n        title: 'Sähköiset asiointikanavat'\n      }];\n    \n      this.dialog = this.openTabbedMetaformDialog(tabs, viewModel, formValues, (newFormValues) => {\n        this.dialog.dialog(\"widget\").addClass('loading');\n      });\n      \n      const electronicChannelsTable = this.dialog.find('#electronic-channels .table-field[data-field-name=\"channels\"]');\n      electronicChannelsTable.tableField('option', 'afterProcessRow', this._onAfterElectronicChannelTableProcessRow.bind(this));\n      electronicChannelsTable.tableField('removeAllRows');\n      const electronicServiceChannelPromises = (this.service.electronicServiceChannelIds||[]).map((electronicServiceChannelId) => {\n        return this.findElectronicServiceChannel(electronicServiceChannelId);\n      });\n      \n      electronicChannelsTable.on('click', 'td button[data-action=\"edit-channel\"]', this._onElectronicChannelTableEditChannelButtonClick.bind(this));\n\n      Promise.all(electronicServiceChannelPromises).then((electronicServiceChannels) => {\n        electronicServiceChannels.forEach((channel) => {\n          const row = electronicChannelsTable.tableField('addRow', {\n            id: channel.id,\n            name: this.getLocalizedValue(channel.names, 'fi')\n          });\n          \n          row.find('*[data-column-name=\"name\"] input').metaformAutocomplete('val', {\n            value: channel.id,\n            label: this.getLocalizedValue(channel.names, 'fi')\n          });\n          \n        });\n      });\n    }\n    \n    /**\n     * Closes dialog\n     */\n    close() {\n      this.dialog.remove();\n    }\n    \n    /**\n     * Opens electronic service channel editor\n     * \n     * @param {String} channelId channel id\n     */\n    openElectronicServiceChannelEditor(channelId) {\n      this.close();\n      \n      this.findElectronicServiceChannel(channelId)\n        .then((serviceChannel) => {\n          const ElectronicServiceChannelEditorDialog = window.ElectronicServiceChannelEditorDialog;\n          const channelDialog = new ElectronicServiceChannelEditorDialog(this.editor, serviceChannel);\n          channelDialog.open();\n        })\n        .catch((err) => {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        });\n    }\n    \n    /**\n     * Creates autocomplete field for selecting service channels\n     * \n     * @param {jQuery} element autocomplete element\n     * @param {Array} channelId service channel id\n     */\n    createElectronicServiceChannelsAutocomplete(element, channelId) {\n      element.metaformAutocomplete('val', channelId);\n    }\n    \n    _onAfterElectronicChannelTableProcessRow(row) {\n      row.find('*[data-column-name=\"name\"] input')\n        .metaformAutocomplete('option', 'customSource', (input, callback) => {\n          this.searchElectronicServiceChannels(input.term + '*')\n            .then((channels) => {\n              callback((channels||[]).map((channel) => {\n                return {\n                  value: channel.id,\n                  label: this.getLocalizedValue(channel.names, 'fi')\n                };\n              }));\n            })\n            .catch((err) => {\n              tinyMCE.activeEditor.windowManager.alert(err);\n            });\n        });\n    }\n    \n    _onElectronicChannelTableEditChannelButtonClick(event) {\n      event.preventDefault();\n      \n      const value = $(event.target).closest('tr').find('*[data-column-name=\"name\"] input')\n        .metaformAutocomplete('val');\n\n      this.openElectronicServiceChannelEditor(value.value);\n    }\n\n  }\n  \n  window.ServiceChannelsDialog = ServiceChannelsDialog;\n  \n})(jQuery);;/* jshint esversion: 6 */\n/* global ajaxurl, tinymce, moment, Promise */\n((tinymce, $) => {\n  // TODO: Service:\n  // Luokittelu ja asiasanat\n\n  const SUPPORTED_COMPONENTS = {\n    'description': {\n      'title': 'Palvelun kuvaus'\n    },\n    'userInstruction': {\n      'title': 'Palvelun toimintaohjeet'\n    },\n    'languages': {\n      'title': 'Palvelun kielet'\n    },\n    'electronicServiceChannelIds': {\n      'title': 'Palvelun sähköiset palvelukanavat'\n    },\n    'phoneServiceChannelIds': {\n      'title': 'Palvelun puhelinpalvelukanavat'\n    },\n    'printableFormServiceChannelIds': {\n      'title': 'Palveluun liittyvät lomakkeet'\n    },\n    'serviceLocationServiceChannelIds': {\n      'title': 'Palvelun toimipisteet'\n    },\n    'webPageServiceChannelIds': {\n      'title': 'Palvelun hyödylliset linkit'\n    }\n  };\n  \n  class ServiceDialog extends window.KuntaApiAbstractEditDialog {\n    \n    /**\n     * Constructs edit dialog\n     * \n     * @param {type} editor TinyMCE editor instance\n     * @param {type} service\n     */\n    constructor(editor, service) {\n      super(editor);\n      this.service = service;\n    }\n    \n    saveService(service, callback) {\n      $.post(ajaxurl, {\n        'action': 'kunta_api_save_service',\n        'service': JSON.stringify(this.service)\n      }, (response) => {\n        callback();\n      })\n      .fail((response) => {\n        callback(response.responseText || response.statusText || \"Unknown error occurred\");\n      });\n    }\n    \n    open() {\n      const viewModel = getServiceMetaform();\n      const formValues = {};\n     \n      this.supportedLocales.map((locale) => {\n        formValues[locale] = this.serviceToForm(locale);\n      });\n     \n      const dialog = this.openLocalizedMetaformDialog(viewModel, formValues, (newFormValues) => {\n        dialog.dialog(\"widget\").addClass('loading');\n        \n        const updatedService = this.translateServiceFromForm(newFormValues);\n        const validationError = this.validate(updatedService);\n        \n        if (validationError !== null) {\n          this.showError('Virheellinen syöte', validationError);\n        } else {\n          this.service = updatedService;\n          \n          this.saveService(this.service, (err) => {\n            dialog.dialog(\"widget\").removeClass('loading');\n            if (err) {\n              this.showError('Virhe tallentaessa', err);\n            } else {\n              dialog.dialog('close'); \n            }\n          });\n        }\n      });\n      \n      $(dialog).on('click', '.edit-additional-details', this.onEditAdditionalDetailsClick.bind(this));\n    }\n    \n    openAdditionalDetailsEditDialog() {\n      const viewModel = getServiceAdditionalDetailsMetaform();\n      this.additionalDetailsToForm().then((formValues) => {\n        const dialog = this.openMetaformDialog(this.prepareViewModel(viewModel), formValues, (newFormValues) => {\n          this.additionalDetailsFromForm(newFormValues);\n        });\n        \n        this.createLanguagesAutocomplete(dialog.find('*[data-name=\"languages\"]'), formValues.languageCodes);\n        this.createAreasAutocomplete(dialog.find('*[data-name=\"areas\"]'), formValues.areaCodes);\n        this.createServiceProducersAutocomplete(dialog.find('*[data-name=\"serviceProducersPurchaseServices\"]'), formValues.serviceProducersPurchaseServiceItems);\n        this.createServiceProducersAutocomplete(dialog.find('*[data-name=\"serviceProducersOthers\"]'), formValues.serviceProducersOtherItems);\n      });\n      \n    }\n    \n    validate(service) {\n      return null;\n    }\n    \n    serviceToForm(locale) {\n      const type = this.service.type;\n      const chargeType = this.service.chargeType;\n      const fundingType = this.service.fundingType;\n      const name = this.getTypedLocalizedValue(this.service.names, locale, 'Name');\n      const alternateName = this.getTypedLocalizedValue(this.service.names, locale, 'AlternateName');\n      const shortDescription = this.getTypedLocalizedValue(this.service.descriptions, locale, 'ShortDescription');\n      const description = this.getTypedLocalizedValue(this.service.descriptions, locale, 'Description');\n      const chargeTypeAdditionalInfo = this.getTypedLocalizedValue(this.service.descriptions, locale, 'ChargeTypeAdditionalInfo');\n      const userInstruction = this.getTypedLocalizedValue(this.service.descriptions, locale, 'ServiceUserInstruction');\n      const deadLineAdditionalInfo = this.getTypedLocalizedValue(this.service.descriptions, locale, 'DeadLineAdditionalInfo');\n      const processingTimeAdditionalInfo = this.getTypedLocalizedValue(this.service.descriptions, locale, 'ProcessingTimeAdditionalInfo');\n      const validityTimeAdditionalInfo = this.getTypedLocalizedValue(this.service.descriptions, locale, 'ValidityTimeAdditionalInfo');\n      const requirements = this.getLocalizedValue(this.service.requirements, locale);\n      const vouchers = this.service.vouchers.filter((voucher) => {\n        return voucher.value && voucher.language === locale;\n      });\n      \n      const legislation = this.service.legislation\n        .map((legistation) => {\n          return {\n            name: this.getLocalizedValue(legistation.names, locale),\n            webPage: this.getLocalizedValue(legistation.webPages, locale, 'url')\n          };\n        })\n        .filter((legistation) => {\n          return legistation.name && legistation.webPage;\n        });\n      \n      return {\n        type: type,\n        serviceChargeType: chargeType,\n        fundingType: fundingType,\n        name: name,\n        alternateName: alternateName,\n        shortDescription: shortDescription,\n        description: description,\n        chargeTypeAdditionalInfo: chargeTypeAdditionalInfo,\n        userInstruction: userInstruction,\n        deadLineAdditionalInfo: deadLineAdditionalInfo,\n        processingTimeAdditionalInfo: processingTimeAdditionalInfo,\n        validityTimeAdditionalInfo: validityTimeAdditionalInfo,\n        requirements: requirements,\n        serviceVouchersInUse: vouchers.length > 0 ? 'true' : 'false',\n        serviceVouchers: vouchers,\n        legislation: legislation\n      };\n    }\n    \n    /**\n     * Creates autocomplete field for selecting service producers\n     * \n     * @param {jQuery} element autocomplete element\n     * @param {Array} organizationItems organizationItem to be loaded\n     */\n    createServiceProducersAutocomplete(element, organizationItems) {\n      element\n        .metaformMultivalueAutocomplete('val', organizationItems)\n        .metaformMultivalueAutocomplete('option', 'customSource', (input, callback) => {\n          const search = this.splitSearchTerms(input.term);\n          if (!search) {\n            callback([]);\n            return;\n          }\n          \n          this.searchOrganizations(search)\n            .then((organizations) => {\n              callback(organizations.map((organization) => {\n                return {\n                  value: organization.id,\n                  label: this.getLocalizedValue(organization.names, 'fi')\n                };\n              }));\n            })\n            .catch((err) => {\n              tinyMCE.activeEditor.windowManager.alert(err);\n            });\n        });\n    }\n    \n    serviceProducersToForm(serviceOrganizations, provisionType) {\n      const findPromises = (serviceOrganizations||[]).filter((serviceOrganization) => {\n        return serviceOrganization.roleType === \"Producer\" && serviceOrganization.provisionType === provisionType;\n      }).map((serviceOrganization) => {\n        return this.findOrganization(serviceOrganization.organizationId);\n      });\n      \n      return Promise.all(findPromises)\n        .then((organizations) => {\n          return organizations.map((organization) => {\n            return {\n              value: organization.id,\n              label: this.getLocalizedValue(organization.names, 'fi')\n            };\n          });\n        })\n        .catch((err) => {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        });\n    }\n    \n    additionalDetailsToForm() {\n      const formPromises = [\n        this.languagesToForm(this.service.languages),\n        this.serviceProducersToForm(this.service.organizations, 'PurchaseServices'),\n        this.serviceProducersToForm(this.service.organizations, 'Other')\n      ];\n      \n      return Promise.all(formPromises)\n        .then((results) => {\n          const languageCodes = results[0];\n          const serviceProducersPurchaseServices = results[1];\n          const serviceProducersOthers = results[2];\n          \n          return {\n            languageCodes: languageCodes,\n            areaCodes: this.areasToForm(this.service.areas),\n            areaType: this.service.areaType,\n            serviceProducersPurchaseServiceItems: serviceProducersPurchaseServices,\n            serviceProducersOtherItems: serviceProducersOthers,\n            serviceProducersSelfProduced: (this.service.organizations||[]).filter((serviceOrganization) => {\n              return serviceOrganization.roleType === \"Producer\" && serviceOrganization.provisionType === 'SelfProduced';\n            }).length > 0\n          };\n        });\n    }\n    \n    translateServiceFromForm(formValues) {\n      const result = JSON.parse(JSON.stringify(this.service));\n      \n      result.names = [];\n      result.descriptions = [];\n      result.vouchers = []; \n  \n      this.supportedLocales.forEach((locale) => {\n        const localeValues = formValues[locale];\n        \n        result.type = localeValues.type || result.type;\n        result.chargeType = localeValues.serviceChargeType || result.chargeType;\n        result.fundingType = localeValues.fundingType || result.fundingType;\n        \n        this.setTypedLocalizedValue(result, 'names', localeValues, 'name', locale, 'Name');\n        this.setTypedLocalizedValue(result, 'names', localeValues, 'alternateName', locale, 'AlternateName');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'shortDescription', locale, 'ShortDescription');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'description', locale, 'Description');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'chargeTypeAdditionalInfo', locale, 'ChargeTypeAdditionalInfo');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'userInstruction', locale, 'ServiceUserInstruction');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'deadLineAdditionalInfo', locale, 'DeadLineAdditionalInfo');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'processingTimeAdditionalInfo', locale, 'ProcessingTimeAdditionalInfo');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'validityTimeAdditionalInfo', locale, 'ValidityTimeAdditionalInfo');\n        \n        this.setLocalizedValue(result, 'requirements', localeValues, 'requirements', locale);\n        \n        this.setLocalizedTableValues(result, 'vouchers', localeValues, 'serviceVouchers', locale, (voucher) => {\n          return voucher.value && voucher.url;\n        });\n      });\n      \n      return result;\n    }\n    \n    additionalDetailsFromForm(newFormValues) {\n      this.service.areaType = newFormValues.areaType;\n      this.service.languages = (newFormValues.languages||'').split(',');\n      this.service.areas = this.areasFromForm(newFormValues.areaType, newFormValues.areas);\n      this.service.organizations = this.service.organizations.filter((serviceOrganization) => {\n        return serviceOrganization.roleType !== 'Producer';\n      });\n      \n      const responsibleOrganizations = this.service.organizations.filter((serviceOrganization) => {\n        return serviceOrganization.roleType === 'Responsible';\n      });\n      \n      const formProducersPurchaseServices =  (newFormValues.serviceProducersPurchaseServices||'').split(',');\n      const formProducersOthers =  (newFormValues.serviceProducersOthers||'').split(',');\n      \n      const serviceProducersPurchaseServices = formProducersPurchaseServices.forEach((organizationId) => {\n        this.service.organizations.push({\n          provisionType: 'PurchaseServices',\n          roleType: 'Producer',\n          organizationId: organizationId\n        });\n      });\n      \n      const serviceProducersPurchaseOthers = formProducersOthers.forEach((organizationId) => {\n        this.service.organizations.push({\n          provisionType: 'Other',\n          roleType: 'Producer',\n          organizationId: organizationId\n        });\n      });\n      \n      if (newFormValues.serviceProducersSelfProduced) {\n        this.service.organizations.push({\n          provisionType: 'SelfProduced',\n          roleType: 'Producer',\n          organizationId: responsibleOrganizations.length > 0 ? responsibleOrganizations[0].organizationId : null\n        });\n      }\n    }\n    \n    onEditAdditionalDetailsClick() {\n      this.openAdditionalDetailsEditDialog();\n    }\n  }\n  \n  class ServiceEditor {\n    \n    constructor (editor) {\n      this.buttonStyle = {\n        'color': '#555',\n        'width': '100%',\n        'border': '1px solid #ccc',\n        'background': '#f7f7f7',\n        'display': 'block',\n        'padding': '5px',\n        'margin-top': '5px',\n        'margin-bottom': '5px',\n        'cursor': 'pointer'\n      };\n      \n      this.editor = editor;\n      \n      this.editor.on('BeforeSetcontent', this.onBeforeSetcontent.bind(this));\n      this.editor.on('GetContent', this.onGetContent.bind(this));\n      this.editor.on('DblClick', this.onDblClick.bind(this));\n      this.editor.addCommand('kunta-api-service-edit', this.onServiceEdit.bind(this));\n    }\n    \n    parseAttributes (string) {\n      const result = [];\n      const re = /([a-zA-Z-_]*)(\\=\\\")([a-zA-Z0-9-]*)(\\\")/g;\n      let match = null;\n      \n      do {\n        match = re.exec(string);\n        if (match && match.length > 3) {\n          result.push({\n            name: match[1],\n            value: match[3] \n          });\n        }\n      } while (match);\n\n      return result;\n    }\n    \n    getComponentTitle (name) {\n      return SUPPORTED_COMPONENTS[name].title;\n    }\n    \n    replaceShortcodes(content) {\n      return content.replace(/(\\[kunta_api_service_component)([a-zA-Z0-9 -=]*)(\\])/g, (all, tag, attributesText, end) => {\n        const attributes = this.parseAttributes(attributesText);\n        const placeholder = $('<input>')\n          .attr({\n           'type': 'button',\n           'data-kunta-api-placeholder': 'service'\n          })\n          .css(this.buttonStyle);\n          \n        for (let i = 0; i < attributes.length; i++) {\n          const attribute = attributes[i];\n          placeholder.attr('data-' + attribute.name, attribute.value);\n        }\n        \n        const component = placeholder.attr('data-component');\n        if (!SUPPORTED_COMPONENTS[component]) {\n          return all;\n        }\n        \n        placeholder.attr('value', this.getComponentTitle(component));\n        return $('<div>').append(placeholder).html();\n      });\n      \n    }\n    \n    restoreShortcodes(content) {\n      return content.replace(/<input [^>]+>/g, (match) => {\n        const input = $(match);\n        \n        if (input.attr('data-kunta-api-placeholder') === 'service') {\n          const shortcodeAttributes = [];\n          const attributeNames = ['service-id', 'component'];\n          \n          for (let i = 0; i < attributeNames.length; i++) {\n            const attributeName = attributeNames[i];\n            const attributeValue = input.attr('data-' + attributeName);\n            shortcodeAttributes.push([attributeName, '\"' + attributeValue + '\"'].join('='));\n          }\n          \n          return '[kunta_api_service_component ' + shortcodeAttributes.join(' ') + ']';\n        }\n        \n        return match;\n      });\n    }\n    \n    openElementEditor(element) {\n      const placeholderAttr = element.attributes['data-kunta-api-placeholder'];\n      if (placeholderAttr && placeholderAttr.value === 'service') {\n        const serviceId = element.attributes['data-service-id'].value;\n        const component = element.attributes['data-component'].value;  \n        \n        this.editor.execCommand('kunta-api-service-edit', '', {\n          serviceId: serviceId,\n          component: component\n        });\n      }\n    }\n    \n    findService(id, callback) {\n      $.post(ajaxurl, {\n        'action': 'kunta_api_load_service',\n        'serviceId': id\n      }, (response) => {\n        callback(null, JSON.parse(response));\n      })\n      .fail((response) => {\n        callback(response.responseText || response.statusText);\n      });\n    }\n    \n    onBeforeSetcontent(event) {\n      event.content = this.replaceShortcodes(event.content);\n    }\n    \n    onGetContent(event) {\n      event.content = this.restoreShortcodes(event.content);\n    }\n    \n    onDblClick(event) {\n      const element = event.target;\n      this.openElementEditor(element);\n    }\n\n    onServiceEdit(ui, options) {\n      this.findService(options.serviceId, (err, service) => {\n        if (err) {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        } else {\n          const channelComponents = ['electronicServiceChannelIds'];\n          \n          const dialog = channelComponents.indexOf(options.component) === -1 \n            ? new ServiceDialog(this.editor, service) \n            : new ServiceChannelsDialog(this.editor, service);\n            \n          dialog.open();\n        }\n      });\n    }\n    \n  }\n  \n  class ServiceEmbed {\n    \n    constructor (editor) {\n      this.editor = editor;\n      this.displayLocale = 'fi';\n      this.searching = false;\n      this.pending = false;\n      this.addButton();\n    }\n    \n    addButton () {\n      this.editor.addButton('kunta_api_service_embed', {\n        title: 'Search Kunta API services',\n        onclick: () => {\n          this.editor.windowManager.open({\n            title: 'Search Kunta API services',\n            width: 768,\n            height: 500,\n            body: [\n              { type: 'textbox', name: 'kunta-api-service-query', label: 'Query', onKeyUp: (e) => {     \n                if (!this.searching) {\n                  this.searching = true;\n                  this.searchServices(e.target.value, (response) => {\n                    this.searching = false;\n                    if (this.pending) {\n                      this.searchServices(e.target.value, (innerResponse) => {\n                        this.handleResponse(innerResponse);\n                      });\n                    } else {\n                      this.handleResponse(response);\n                    }\n                  });\n                } else {\n                  this.pending = true;\n                }\n              }},\n              {type: 'label', classes: 'kunta-api-search-info', text: \"Kirjoita hakusana yllä olevaan hakukenttään\"},\n              {type: 'container', classes: 'kunta-api-search-results', minHeight: 400}\n            ],\n            onsubmit: (e) => {\n              let responseHtml = '';\n              let allEmbedsFromSameChannel = true;              \n              const componentsToEmbed = $('.service-component-embed-input:checked');\n              \n              componentsToEmbed.each(function () {\n                var component = $(this).attr('data-component-type');\n                var serviceId = $(this).attr('data-service-id');\n                responseHtml += '[kunta_api_service_component service-id=\"'+ serviceId +'\" component=\"'+ component +'\"]';\n              });\n\n              this.editor.insertContent(responseHtml);\n            }\n          });\n        }\n      });\n    }\n    \n    searchServices(query, callback) {\n      $('.mce-kunta-api-search-results').empty();\n      $('.mce-kunta-api-search-results').append($('<div>').addClass('mce-kunta-api-search-results-loader'));\n      $('.mce-kunta-api-search-info').text('Ladataan...');\n      $.post(ajaxurl, {\n        'action': 'kunta_api_search_services',\n        'data': query\n      }, (response) => {\n        $('.mce-kunta-api-search-results-loader').remove();\n        callback(JSON.parse(response));\n      });\n    }\n    \n    getLocalizedValueAndType(values, locale, type) {\n      for (let i = 0; i < values.length; i++) {\n        if (locale === values[i].language && type === values[i].type) {\n          return values[i].value;\n        }\n      }\n      \n      return null;\n    }\n    \n    appendResult(result) {\n      const resultContainer = $('<div>').addClass('mce-kunta-api-search-result-row');\n      const name = this.getLocalizedValueAndType(result.names, this.displayLocale, 'Name');\n\n      resultContainer.append(\n        $('<p>')\n          .addClass('mce-kunta-api-search-result-title')\n          .text(name)\n      );\n      \n      Object.keys(SUPPORTED_COMPONENTS).forEach((component) => {\n        const options = SUPPORTED_COMPONENTS[component]; \n        resultContainer.append(\n          $('<p>')\n            .append($('<input>')\n            .addClass('service-component-embed-input')\n            .attr({\n              'type':'checkbox',\n              'data-component-type': component,\n              'data-service-id': result.id\n            }))\n            .append($('<span>').text(options.title))\n        );\n      });\n      \n      $('.mce-kunta-api-search-results').append(resultContainer);\n    }\n    \n    handleResponse(response) {\n      $('.mce-kunta-api-search-results').empty();\n\n      if (response.length === 0) {\n        $('.mce-kunta-api-search-info').text('Hakusanalla ei löytynyt yhtään palvelua');\n      } else {\n        $('.mce-kunta-api-search-info').text('Kirjoita hakusana yllä olevaan hakukenttään');\n      }\n\n      for (let i = 0; i < response.length; i++) {\n        this.appendResult(response[i]);\n      }\n\n    }\n    \n  }\n  \n  tinymce.PluginManager.add('kunta_api_service_embed', (editor, url) => {\n    new ServiceEmbed(editor);\n    new ServiceEditor(editor);\n  });\n  \n})(tinymce, jQuery);"]}
{"version":3,"sources":["../src/kunta-api-service-embed/js/plugin.js"],"names":["tinymce","$","SUPPORTED_COMPONENTS","ServiceDialog","editor","service","callback","post","ajaxurl","JSON","stringify","response","fail","responseText","statusText","viewModel","getServiceMetaform","formValues","supportedLocales","map","locale","serviceToForm","dialog","openLocalizedMetaformDialog","newFormValues","addClass","updatedService","translateServiceFromForm","validationError","validate","showError","saveService","err","removeClass","on","onEditAdditionalDetailsClick","bind","getServiceAdditionalDetailsMetaform","additionalDetailsToForm","then","openMetaformDialog","prepareViewModel","additionalDetailsFromForm","createLanguagesAutocomplete","find","languageCodes","createAreasAutocomplete","areaCodes","type","chargeType","fundingType","name","getTypedLocalizedValue","names","alternateName","shortDescription","descriptions","description","chargeTypeAdditionalInfo","userInstruction","deadLineAdditionalInfo","processingTimeAdditionalInfo","validityTimeAdditionalInfo","requirements","getLocalizedValue","vouchers","filter","voucher","value","language","legislation","legistation","webPage","webPages","serviceChargeType","serviceVouchersInUse","length","serviceVouchers","languagesToForm","languages","areasToForm","areas","areaType","result","parse","forEach","localeValues","setTypedLocalizedValue","setLocalizedValue","setLocalizedTableValues","url","console","log","split","areasFromForm","openAdditionalDetailsEditDialog","window","KuntaApiAbstractEditDialog","ServiceEditor","buttonStyle","onBeforeSetcontent","onGetContent","onDblClick","addCommand","onServiceEdit","string","re","match","exec","push","title","content","replace","all","tag","attributesText","end","attributes","parseAttributes","placeholder","attr","css","i","attribute","component","getComponentTitle","append","html","input","shortcodeAttributes","attributeNames","attributeName","attributeValue","join","element","placeholderAttr","serviceId","execCommand","id","event","replaceShortcodes","restoreShortcodes","target","openElementEditor","ui","options","findService","tinyMCE","activeEditor","windowManager","alert","open","ServiceEmbed","displayLocale","searching","pending","addButton","onclick","width","height","body","label","onKeyUp","e","searchServices","innerResponse","handleResponse","classes","text","minHeight","onsubmit","responseHtml","allEmbedsFromSameChannel","componentsToEmbed","each","insertContent","query","empty","remove","values","resultContainer","getLocalizedValueAndType","Object","keys","appendResult","PluginManager","add","jQuery"],"mappings":"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","file":"plugin.js","sourcesContent":["/* jshint esversion: 6 */\n/* global ajaxurl, tinymce, moment, Promise */\n((tinymce, $) => {\n  // TODO: Service:\n  // Palvelun pohjakuvaus\n  // Luokittelu ja asiasanat\n  // Toteutustapa ja tuottaja\n  // Tyypit:\n  //   - Palvelu\n  //   - Lupa tai muu velvoite\n  // Lisätiedot:\n  //   - Kielet, joilla palvelu on saatavilla\n  //   - Alue, jolla palvelu on käytettävissä\n  \n  const SUPPORTED_COMPONENTS = {\n    'description': {\n      'title': 'Palvelun kuvaus'\n    },\n    'userInstruction': {\n      'title': 'Palvelun toimintaohjeet'\n    },\n    'languages': {\n      'title': 'Palvelun kielet'\n    },\n    'electronicServiceChannelIds': {\n      'title': 'Palvelun sähköiset palvelukanavat'\n    },\n    'phoneServiceChannelIds': {\n      'title': 'Palvelun puhelinpalvelukanavat'\n    },\n    'printableFormServiceChannelIds': {\n      'title': 'Palveluun liittyvät lomakkeet'\n    },\n    'serviceLocationServiceChannelIds': {\n      'title': 'Palvelun toimipisteet'\n    },\n    'webPageServiceChannelIds': {\n      'title': 'Palvelun hyödylliset linkit'\n    }\n  };\n  \n  class ServiceDialog extends window.KuntaApiAbstractEditDialog {\n    \n    /**\n     * Constructs edit dialog\n     * \n     * @param {type} editor TinyMCE editor instance\n     * @param {type} service\n     */\n    constructor(editor, service) {\n      super(editor);\n      this.service = service;\n    }\n    \n    saveService(service, callback) {\n      $.post(ajaxurl, {\n        'action': 'kunta_api_save_service',\n        'service': JSON.stringify(this.service)\n      }, (response) => {\n        callback();\n      })\n      .fail((response) => {\n        callback(response.responseText || response.statusText || \"Unknown error occurred\");\n      });\n    }\n    \n    open() {\n      const viewModel = getServiceMetaform();\n      const formValues = {};\n     \n      this.supportedLocales.map((locale) => {\n        formValues[locale] = this.serviceToForm(locale);\n      });\n     \n      const dialog = this.openLocalizedMetaformDialog(viewModel, formValues, (newFormValues) => {\n        dialog.dialog(\"widget\").addClass('loading');\n        \n        const updatedService = this.translateServiceFromForm(newFormValues);\n        const validationError = this.validate(updatedService);\n        \n        if (validationError !== null) {\n          this.showError('Virheellinen syöte', validationError);\n        } else {\n          this.service = updatedService;\n          \n          this.saveService(this.service, (err) => {\n            dialog.dialog(\"widget\").removeClass('loading');\n            if (err) {\n              this.showError('Virhe tallentaessa', err);\n            } else {\n              dialog.dialog('close'); \n            }\n          });\n        }\n      });\n      /**\n      $(dialog).on('click', '.add-service-hour', this._onAddServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-service-hour', this._onEditServiceHourClick.bind(this));\n      $(dialog).on('click', '.remove-service-hour', this._onRemoveServiceHourClick.bind(this));\n      **/\n      $(dialog).on('click', '.edit-additional-details', this.onEditAdditionalDetailsClick.bind(this));\n    }\n    \n    openAdditionalDetailsEditDialog() {\n      const viewModel = getServiceAdditionalDetailsMetaform();\n      this.additionalDetailsToForm().then((formValues) => {\n        const dialog = this.openMetaformDialog(this.prepareViewModel(viewModel), formValues, (newFormValues) => {\n          this.additionalDetailsFromForm(newFormValues);\n        });\n        \n        this.createLanguagesAutocomplete(dialog.find('*[data-name=\"languages\"]'), formValues.languageCodes);\n        this.createAreasAutocomplete(dialog.find('*[data-name=\"areas\"]'), formValues.areaCodes);\n      });\n      \n    }\n    \n    validate(service) {\n      return null;\n    }\n    \n    serviceToForm(locale) {\n      const type = this.service.type;\n      const chargeType = this.service.chargeType;\n      const fundingType = this.service.fundingType;\n      const name = this.getTypedLocalizedValue(this.service.names, locale, 'Name');\n      const alternateName = this.getTypedLocalizedValue(this.service.names, locale, 'AlternateName');\n      const shortDescription = this.getTypedLocalizedValue(this.service.descriptions, locale, 'ShortDescription');\n      const description = this.getTypedLocalizedValue(this.service.descriptions, locale, 'Description');\n      const chargeTypeAdditionalInfo = this.getTypedLocalizedValue(this.service.descriptions, locale, 'ChargeTypeAdditionalInfo');\n      const userInstruction = this.getTypedLocalizedValue(this.service.descriptions, locale, 'ServiceUserInstruction');\n      const deadLineAdditionalInfo = this.getTypedLocalizedValue(this.service.descriptions, locale, 'DeadLineAdditionalInfo');\n      const processingTimeAdditionalInfo = this.getTypedLocalizedValue(this.service.descriptions, locale, 'ProcessingTimeAdditionalInfo');\n      const validityTimeAdditionalInfo = this.getTypedLocalizedValue(this.service.descriptions, locale, 'ValidityTimeAdditionalInfo');\n      const requirements = this.getLocalizedValue(this.service.requirements, locale);\n      const vouchers = this.service.vouchers.filter((voucher) => {\n        return voucher.value && voucher.language === locale;\n      });\n      \n      const legislation = this.service.legislation\n        .map((legistation) => {\n          return {\n            name: this.getLocalizedValue(legistation.names, locale),\n            webPage: this.getLocalizedValue(legistation.webPages, locale, 'url')\n          };\n        })\n        .filter((legistation) => {\n          return legistation.name && legistation.webPage;\n        });\n      \n      return {\n        type: type,\n        serviceChargeType: chargeType,\n        fundingType: fundingType,\n        name: name,\n        alternateName: alternateName,\n        shortDescription: shortDescription,\n        description: description,\n        chargeTypeAdditionalInfo: chargeTypeAdditionalInfo,\n        userInstruction: userInstruction,\n        deadLineAdditionalInfo: deadLineAdditionalInfo,\n        processingTimeAdditionalInfo: processingTimeAdditionalInfo,\n        validityTimeAdditionalInfo: validityTimeAdditionalInfo,\n        requirements: requirements,\n        serviceVouchersInUse: vouchers.length > 0 ? 'true' : 'false',\n        serviceVouchers: vouchers,\n        legislation: legislation\n      };\n    }\n    \n    additionalDetailsToForm() {\n      return this.languagesToForm(this.service.languages)\n        .then((languageCodes) => {\n          return {\n            languageCodes: languageCodes,\n            areaCodes: this.areasToForm(this.service.areas),\n            areaType: this.service.areaType\n          };\n        });\n    }\n    \n    translateServiceFromForm(formValues) {\n      const result = JSON.parse(JSON.stringify(this.service));\n      \n      result.names = [];\n      result.descriptions = [];\n      result.vouchers = []; \n  \n      this.supportedLocales.forEach((locale) => {\n        const localeValues = formValues[locale];\n        \n        result.type = localeValues.type || result.type;\n        result.chargeType = localeValues.serviceChargeType || result.chargeType;\n        result.fundingType = localeValues.fundingType || result.fundingType;\n        \n        this.setTypedLocalizedValue(result, 'names', localeValues, 'name', locale, 'Name');\n        this.setTypedLocalizedValue(result, 'names', localeValues, 'alternateName', locale, 'AlternateName');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'shortDescription', locale, 'ShortDescription');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'description', locale, 'Description');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'chargeTypeAdditionalInfo', locale, 'ChargeTypeAdditionalInfo');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'userInstruction', locale, 'ServiceUserInstruction');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'deadLineAdditionalInfo', locale, 'DeadLineAdditionalInfo');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'processingTimeAdditionalInfo', locale, 'ProcessingTimeAdditionalInfo');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'validityTimeAdditionalInfo', locale, 'ValidityTimeAdditionalInfo');\n        \n        this.setLocalizedValue(result, 'requirements', localeValues, 'requirements', locale);\n        \n        this.setLocalizedTableValues(result, 'vouchers', localeValues, 'serviceVouchers', locale, (voucher) => {\n          return voucher.value && voucher.url;\n        });\n      });\n      \n      return result;\n    }\n    \n    additionalDetailsFromForm(newFormValues) {\n      console.log(\"this.service BEFORE\", this.service);\n      \n      console.log(\"newFormValues\", newFormValues);\n      \n      this.service.areaType = newFormValues.areaType;\n      this.service.languages = (newFormValues.languages||'').split(',');\n      this.service.areas = this.areasFromForm(newFormValues.areaType, newFormValues.areas);\n      \n      console.log(\"this.service.\", this.service);\n    }\n    \n    onEditAdditionalDetailsClick() {\n      this.openAdditionalDetailsEditDialog();\n    }\n  }\n  \n  class ServiceEditor {\n    \n    constructor (editor) {\n      this.buttonStyle = {\n        'color': '#555',\n        'width': '100%',\n        'border': '1px solid #ccc',\n        'background': '#f7f7f7',\n        'display': 'block',\n        'padding': '5px',\n        'margin-top': '5px',\n        'margin-bottom': '5px',\n        'cursor': 'pointer'\n      };\n      \n      this.editor = editor;\n      \n      this.editor.on('BeforeSetcontent', this.onBeforeSetcontent.bind(this));\n      this.editor.on('GetContent', this.onGetContent.bind(this));\n      this.editor.on('DblClick', this.onDblClick.bind(this));\n      this.editor.addCommand('kunta-api-service-edit', this.onServiceEdit.bind(this));\n    }\n    \n    parseAttributes (string) {\n      const result = [];\n      const re = /([a-zA-Z-_]*)(\\=\\\")([a-zA-Z0-9-]*)(\\\")/g;\n      let match = null;\n      \n      do {\n        match = re.exec(string);\n        if (match && match.length > 3) {\n          result.push({\n            name: match[1],\n            value: match[3] \n          });\n        }\n      } while (match);\n\n      return result;\n    }\n    \n    getComponentTitle (name) {\n      return SUPPORTED_COMPONENTS[name].title;\n    }\n    \n    replaceShortcodes(content) {\n      return content.replace(/(\\[kunta_api_service_component)([a-zA-Z0-9 -=]*)(\\])/g, (all, tag, attributesText, end) => {\n        const attributes = this.parseAttributes(attributesText);\n        const placeholder = $('<input>')\n          .attr({\n           'type': 'button',\n           'data-kunta-api-placeholder': 'service'\n          })\n          .css(this.buttonStyle);\n          \n        for (let i = 0; i < attributes.length; i++) {\n          const attribute = attributes[i];\n          placeholder.attr('data-' + attribute.name, attribute.value);\n        }\n        \n        const component = placeholder.attr('data-component');\n        if (!SUPPORTED_COMPONENTS[component]) {\n          return all;\n        }\n        \n        placeholder.attr('value', this.getComponentTitle(component));\n        return $('<div>').append(placeholder).html();\n      });\n      \n    }\n    \n    restoreShortcodes(content) {\n      return content.replace(/<input [^>]+>/g, (match) => {\n        const input = $(match);\n        \n        if (input.attr('data-kunta-api-placeholder') === 'service') {\n          const shortcodeAttributes = [];\n          const attributeNames = ['service-id', 'component'];\n          \n          for (let i = 0; i < attributeNames.length; i++) {\n            const attributeName = attributeNames[i];\n            const attributeValue = input.attr('data-' + attributeName);\n            shortcodeAttributes.push([attributeName, '\"' + attributeValue + '\"'].join('='));\n          }\n          \n          return '[kunta_api_service_component ' + shortcodeAttributes.join(' ') + ']';\n        }\n        \n        return match;\n      });\n    }\n    \n    openElementEditor(element) {\n      const placeholderAttr = element.attributes['data-kunta-api-placeholder'];\n      if (placeholderAttr && placeholderAttr.value === 'service') {\n        const serviceId = element.attributes['data-service-id'].value;\n        this.editor.execCommand('kunta-api-service-edit', '', {\n          serviceId: serviceId\n        });\n      }\n    }\n    \n    findService(id, callback) {\n      $.post(ajaxurl, {\n        'action': 'kunta_api_load_service',\n        'serviceId': id\n      }, (response) => {\n        callback(null, JSON.parse(response));\n      })\n      .fail((response) => {\n        callback(response.responseText || response.statusText);\n      });\n    }\n    \n    onBeforeSetcontent(event) {\n      event.content = this.replaceShortcodes(event.content);\n    }\n    \n    onGetContent(event) {\n      event.content = this.restoreShortcodes(event.content);\n    }\n    \n    onDblClick(event) {\n      const element = event.target;\n      this.openElementEditor(element);\n    }\n\n    onServiceEdit(ui, options) {\n      this.findService(options.serviceId, (err, service) => {\n        if (err) {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        } else {\n          console.log(\"Service\", service);\n          \n          const dialog = new ServiceDialog(this.editor, service);\n          dialog.open();\n        }\n      });\n    } \n    \n  }\n  \n  class ServiceEmbed {\n    \n    constructor (editor) {\n      this.editor = editor;\n      this.displayLocale = 'fi';\n      this.searching = false;\n      this.pending = false;\n      this.addButton();\n    }\n    \n    addButton () {\n      this.editor.addButton('kunta_api_service_embed', {\n        title: 'Search Kunta API services',\n        onclick: () => {\n          this.editor.windowManager.open({\n            title: 'Search Kunta API services',\n            width: 768,\n            height: 500,\n            body: [\n              { type: 'textbox', name: 'kunta-api-service-query', label: 'Query', onKeyUp: (e) => {     \n                if (!this.searching) {\n                  this.searching = true;\n                  this.searchServices(e.target.value, (response) => {\n                    this.searching = false;\n                    if (this.pending) {\n                      this.searchServices(e.target.value, (innerResponse) => {\n                        this.handleResponse(innerResponse);\n                      });\n                    } else {\n                      this.handleResponse(response);\n                    }\n                  });\n                } else {\n                  this.pending = true;\n                }\n              }},\n              {type: 'label', classes: 'kunta-api-search-info', text: \"Kirjoita hakusana yllä olevaan hakukenttään\"},\n              {type: 'container', classes: 'kunta-api-search-results', minHeight: 400}\n            ],\n            onsubmit: (e) => {\n              let responseHtml = '';\n              let allEmbedsFromSameChannel = true;              \n              const componentsToEmbed = $('.service-component-embed-input:checked');\n              \n              componentsToEmbed.each(function () {\n                var component = $(this).attr('data-component-type');\n                var serviceId = $(this).attr('data-service-id');\n                responseHtml += '[kunta_api_service_component service-id=\"'+ serviceId +'\" component=\"'+ component +'\"]';\n              });\n\n              this.editor.insertContent(responseHtml);\n            }\n          });\n        }\n      });\n    }\n    \n    searchServices(query, callback) {\n      $('.mce-kunta-api-search-results').empty();\n      $('.mce-kunta-api-search-results').append($('<div>').addClass('mce-kunta-api-search-results-loader'));\n      $('.mce-kunta-api-search-info').text('Ladataan...');\n      $.post(ajaxurl, {\n        'action': 'kunta_api_search_services',\n        'data': query\n      }, (response) => {\n        $('.mce-kunta-api-search-results-loader').remove();\n        callback(JSON.parse(response));\n      });\n    }\n    \n    getLocalizedValueAndType(values, locale, type) {\n      for (let i = 0; i < values.length; i++) {\n        if (locale === values[i].language && type === values[i].type) {\n          return values[i].value;\n        }\n      }\n      \n      return null;\n    }\n    \n    appendResult(result) {\n      const resultContainer = $('<div>').addClass('mce-kunta-api-search-result-row');\n      const name = this.getLocalizedValueAndType(result.names, this.displayLocale, 'Name');\n\n      resultContainer.append(\n        $('<p>')\n          .addClass('mce-kunta-api-search-result-title')\n          .text(name)\n      );\n      \n      Object.keys(SUPPORTED_COMPONENTS).forEach((component) => {\n        const options = SUPPORTED_COMPONENTS[component]; \n        resultContainer.append(\n          $('<p>')\n            .append($('<input>')\n            .addClass('service-component-embed-input')\n            .attr({\n              'type':'checkbox',\n              'data-component-type': component,\n              'data-service-id': result.id\n            }))\n            .append($('<span>').text(options.title))\n        );\n      });\n      \n      $('.mce-kunta-api-search-results').append(resultContainer);\n    }\n    \n    handleResponse(response) {\n      $('.mce-kunta-api-search-results').empty();\n\n      if (response.length === 0) {\n        $('.mce-kunta-api-search-info').text('Hakusanalla ei löytynyt yhtään palvelua');\n      } else {\n        $('.mce-kunta-api-search-info').text('Kirjoita hakusana yllä olevaan hakukenttään');\n      }\n\n      for (let i = 0; i < response.length; i++) {\n        this.appendResult(response[i]);\n      }\n\n    }\n    \n  }\n  \n  tinymce.PluginManager.add('kunta_api_service_embed', (editor, url) => {\n    new ServiceEmbed(editor);\n    new ServiceEditor(editor);\n  });\n  \n})(tinymce, jQuery);"]}
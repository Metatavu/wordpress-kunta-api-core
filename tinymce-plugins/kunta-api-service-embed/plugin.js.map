{"version":3,"sources":["../src/kunta-api-service-embed/build/plugin.js"],"names":["$","PrintableFormServiceChannelEditorDialog","editor","channel","on","onAfterDialogOpen","bind","locale","deliveryAddress","serviceChannel","name","getTypedLocalizedValue","names","shortDescription","descriptions","description","formIdentifier","getLocalizedValue","formReceiver","addressType","subtype","streetAddress","postOfficeBox","streetNumber","postalCode","addressAdditionalInformation","additionalInformations","addressAdditionalInformationNoAddress","channelUrls","getLocalizedValues","attachments","filter","attachment","url","language","supportPhones","getLocalizedPhoneNumbers","supportEmails","getLocalizedEmails","publishingStatus","getPrintableFormServiceChannelMetaform","areaCodes","areasToForm","areas","areaType","formValues","result","JSON","parse","stringify","supportedLocales","forEach","localeValues","setTypedLocalizedValue","setLocalizedValue","setLocalizedTableValues","supportPhone","number","Object","assign","isFinnishServiceNumber","type","supportEmail","value","webPages","push","channelUrl","newFormValues","areasFromForm","viewModel","getPrintableFormServiceChannelAdditionalDetailsMetaform","additionalDetailsToForm","dialog","openMetaformDialog","prepareViewModel","additionalDetailsFromForm","createAreasAutocomplete","find","data","onAddServiceHourClick","onEditServiceHourClick","onRemoveServiceHourClick","onEditAdditionalDetailsClick","redrawServiceHours","linkInputs","event","openServiceHourEditDialog","createdServiceHour","serviceHours","row","target","closest","index","serviceHour","updatedServiceHour","splice","openAdditionalDetailsEditDialog","window","AbstractServiceChannelEditorDialog","jQuery","ElectronicServiceChannelEditorDialog","requiresAuthentication","requiresSignature","signatureQuantity","webPage","getLocalizedWebPageUrl","languages","getElectronicServiceChannelMetaform","getFormBooleanValue","setLocalizedWebPages","getElectronicServiceChannelAdditionalDetailsMetaform","PhoneServiceChannelEditorDialog","phoneNumbers","getPhoneServiceChannelMetaform","languagesToForm","then","languageCodes","phoneNumber","split","getPhoneServiceChannelAdditionalDetailsMetaform","createLanguagesAutocomplete","catch","err","tinyMCE","activeEditor","windowManager","alert","WebPageServiceChannelEditorDialog","getWebPageServiceChannelMetaform","getWebPageServiceChannelAdditionalDetailsMetaform","ServiceChannelsDialog","service","_channelDetails","tabId","property","title","afterProcessRow","onAfterElectronicChannelTableProcessRow","click","onElectronicChannelTableEditChannelButtonClick","findMethod","findElectronicServiceChannel","onAfterWebPageTableProcessRow","onWebPageChannelTableEditChannelButtonClick","findWebPageServiceChannel","onAfterPrintableFormTableProcessRow","onPrintableFormChannelTableEditChannelButtonClick","findPrintableFormServiceChannel","onAfterPhoneServiceTableProcessRow","onPhoneServiceChannelTableEditChannelButtonClick","findPhoneServiceChannel","onAfterServiceLocationTableProcessRow","onServiceLocationServiceChannelTableEditChannelButtonClick","findServiceLocationServiceChannel","getServiceChannelsMetaform","openTabbedMetaformDialog","map","channelDetail","id","metaform","addClass","updatedService","translateServiceFromForm","saveService","removeClass","showError","channelsTable","tableField","channelPromises","channelId","call","Promise","all","channels","metaformAutocomplete","label","change","remove","close","channelDialog","open","ServiceLocationServiceChannelDialog","element","tableData","channelIds","tableRow","createChannelAutocomplete","searchElectronicServiceChannels","searchWebPageServiceChannels","searchPrintableFormServiceChannels","searchPhoneServiceChannels","searchServiceLocationServiceChannels","searchCall","input","callback","term","preventDefault","openElectronicServiceChannelEditor","openWebPageServiceChannelEditor","openPrintableFormServiceChannelEditor","openPhoneServiceChannelEditor","openServiceLocationServiceChannelEditor","KuntaApiAbstractEditDialog","tinymce","SUPPORTED_COMPONENTS","ServiceDialog","getServiceMetaform","serviceToForm","openLocalizedMetaformDialog","validationError","validate","onEditChannelsClick","getServiceAdditionalDetailsMetaform","createServiceProducersAutocomplete","serviceProducersPurchaseServiceItems","serviceProducersOtherItems","chargeType","fundingType","alternateName","chargeTypeAdditionalInfo","userInstruction","deadLineAdditionalInfo","processingTimeAdditionalInfo","validityTimeAdditionalInfo","requirements","vouchers","voucher","legislation","legistation","serviceChargeType","serviceVouchersInUse","length","serviceVouchers","organizationItems","metaformMultivalueAutocomplete","search","splitSearchTerms","searchOrganizations","organizations","organization","serviceOrganizations","provisionType","findPromises","serviceOrganization","roleType","findOrganization","organizationId","formPromises","serviceProducersToForm","results","serviceProducersPurchaseServices","serviceProducersOthers","serviceProducersSelfProduced","responsibleOrganizations","formProducersPurchaseServices","formProducersOthers","serviceProducersPurchaseOthers","ServiceEditor","buttonStyle","onBeforeSetcontent","onGetContent","onDblClick","addCommand","onServiceEdit","string","re","match","exec","content","replace","tag","attributesText","end","attributes","parseAttributes","placeholder","attr","css","i","attribute","component","getComponentTitle","append","html","shortcodeAttributes","attributeNames","attributeName","attributeValue","join","placeholderAttr","serviceId","execCommand","post","ajaxurl","response","fail","responseText","statusText","replaceShortcodes","restoreShortcodes","openElementEditor","ui","options","overlay","appendTo","findService","channelComponents","indexOf","ServiceEmbed","displayLocale","searching","pending","addButton","onclick","width","height","body","onKeyUp","e","searchServices","innerResponse","handleResponse","classes","text","minHeight","onsubmit","responseHtml","allEmbedsFromSameChannel","componentsToEmbed","each","insertContent","query","empty","values","resultContainer","getLocalizedValueAndType","keys","appendResult","PluginManager","add"],"mappings":"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","file":"plugin.js","sourcesContent":["/* jshint esversion: 6 */\n/* global ajaxurl, moment, Promise */\n(($) => {\n  'use strict';\n  \n  class PrintableFormServiceChannelEditorDialog extends window.AbstractServiceChannelEditorDialog {\n\n    /**\n     * Constructs service channel editor dialog\n     * \n     * @param {type} editor TinyMCE editor instance\n     * @param {type} channel\n     */\n    constructor(editor, channel) {\n      super(editor, channel, 'kunta_api_save_printable_form_service_channel');\n      this.on(\"afterDialogOpen\", this.onAfterDialogOpen.bind(this));\n    }\n    \n    /**\n     * Translates service channel to be suitable for form\n     * \n     * @param {String} locale locale\n     * @returns {Object} form data\n     */\n    serviceChannelToForm(locale) {      \n      const deliveryAddress = this.serviceChannel.deliveryAddress || {};\n\n      return {\n        name: this.getTypedLocalizedValue(this.serviceChannel.names, locale, 'Name'),\n        shortDescription: this.getTypedLocalizedValue(this.serviceChannel.descriptions, locale, 'Summary'),\n        description: this.getTypedLocalizedValue(this.serviceChannel.descriptions, locale, 'Description'),\n        formIdentifier: this.getLocalizedValue(this.serviceChannel.formIdentifier, locale),\n        formReceiver: this.getLocalizedValue(this.serviceChannel.formReceiver, locale),\n        addressType: deliveryAddress.subtype,\n        streetAddress: this.getLocalizedValue(deliveryAddress.streetAddress, locale),\n        postOfficeBox: this.getLocalizedValue(deliveryAddress.postOfficeBox, locale),\n        streetNumber: deliveryAddress.streetNumber,\n        postalCode: deliveryAddress.postalCode,\n        addressAdditionalInformation: this.getLocalizedValue(deliveryAddress.additionalInformations, locale),\n        addressAdditionalInformationNoAddress: this.getLocalizedValue(deliveryAddress.additionalInformations, locale),\n        channelUrls: this.getLocalizedValues(this.serviceChannel.channelUrls, locale),\n        attachments: (this.serviceChannel.attachments || []).filter((attachment) => {\n          return attachment.url && attachment.language === locale;\n        }),\n        supportPhones: this.getLocalizedPhoneNumbers(this.serviceChannel.supportPhones, locale),\n        supportEmails: this.getLocalizedEmails(this.serviceChannel.supportEmails, locale),\n        publishingStatus: this.serviceChannel.publishingStatus\n      };\n    }\n    \n    /**\n     * Returns main form for service channel\n     * \n     * @returns {Object} metaform\n     */\n    getServiceChannelFormViewModel() {\n      return getPrintableFormServiceChannelMetaform();\n    }\n    \n    additionalDetailsToForm(serviceChannel) {\n      return {\n        areaCodes: this.areasToForm(serviceChannel.areas),\n        areaType: serviceChannel.areaType\n      };\n    }\n    \n    /**\n     * Translates form values to service channel\n     * \n     * @param {type} channel original channel data\n     * @param {type} formValues form values\n     * @returns {Object} updated service\n     */\n    serviceChannelFromForm(channel, formValues) {\n      const result = JSON.parse(JSON.stringify(channel));\n      \n      result.names = [];\n      result.descriptions = [];\n      result.formIdentifier = [];\n      result.formReceiver = [];\n      result.channelUrls = [];\n      result.deliveryAddress = {};\n      result.supportPhones = [];\n      result.attachments = [];\n\n      this.supportedLocales.forEach((locale) => {\n        const localeValues = formValues[locale];\n        \n        result.publishingStatus = localeValues.publishingStatus || result.publishingStatus;\n        \n        this.setTypedLocalizedValue(result, 'names', localeValues, 'name', locale, 'Name');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'shortDescription', locale, 'Summary');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'description', locale, 'Description');\n        \n        this.setLocalizedValue(result, 'formIdentifier', localeValues, 'formIdentifier', locale);\n        this.setLocalizedValue(result, 'formReceiver', localeValues, 'formReceiver', locale);\n        \n        this.setLocalizedTableValues(result, 'supportPhones', localeValues, 'supportPhones', locale, (supportPhone) => {\n          return !!supportPhone.number;\n        }, (supportPhone) => {\n          return Object.assign({}, supportPhone, {\n            language: locale,\n            isFinnishServiceNumber: \"true\" === supportPhone.isFinnishServiceNumber,\n            type: \"Phone\"\n          });\n        });\n        \n        this.setLocalizedTableValues(result, 'supportEmails', localeValues, 'supportEmails', locale, (supportEmail) => {\n          return !!supportEmail.value;\n        });\n        \n        this.setLocalizedTableValues(result, 'attachments', localeValues, 'attachments', locale, (attachment) => {\n          return !!attachment.url;\n        }, (attachment) => {\n          return Object.assign(attachment, {\n            language: locale,\n            type: 'Attachment'\n          });\n        });\n        \n        if (localeValues.webPages) {\n          result.webPages.push({\n            url: localeValues.webPages,\n            language: locale\n          });\n        }\n        \n        this.setLocalizedTableValues(result, 'channelUrls', localeValues, 'channelUrls', locale, (channelUrl) => {\n          return !!channelUrl.value;\n        }, (channelUrl) => {\n          return Object.assign(channelUrl, {\n            language: locale\n          });\n        });\n        \n        const addressType = localeValues.addressType; \n        if (!result.deliveryAddress.subtype) {\n          result.deliveryAddress.subtype = addressType;\n          result.deliveryAddress.streetNumber = localeValues.streetNumber || result.deliveryAddress.streetNumber;\n          result.deliveryAddress.postalCode = localeValues.postalCode || result.deliveryAddress.postalCode;\n        }\n      \n        this.setLocalizedValue(result.deliveryAddress, 'streetAddress', localeValues, 'streetAddress', locale);\n        this.setLocalizedValue(result.deliveryAddress, 'postOfficeBox', localeValues, 'postOfficeBox', locale);\n        this.setLocalizedValue(result.deliveryAddress, 'additionalInformations', localeValues, addressType === 'NoAddress' ? 'addressAdditionalInformationNoAddress' : 'addressAdditionalInformation', locale);\n      });\n\n      return result;\n    }\n    \n    additionalDetailsFromForm(newFormValues) {\n      this.serviceChannel.areaType = newFormValues.areaType;\n      this.serviceChannel.areas = this.areasFromForm(newFormValues.areaType, newFormValues.areas);\n    }\n    \n    openAdditionalDetailsEditDialog() {\n      const viewModel = getPrintableFormServiceChannelAdditionalDetailsMetaform();\n      const formValues = this.additionalDetailsToForm(this.serviceChannel);\n\n      const dialog = this.openMetaformDialog(this.prepareViewModel(viewModel), formValues, (newFormValues) => {\n        this.additionalDetailsFromForm(newFormValues);\n      });\n\n      this.createAreasAutocomplete(dialog.find('*[data-name=\"areas\"]'), formValues.areaCodes);      \n    }\n    \n    /**\n     * Method invoked after dialog open\n     * \n     * @param {Object} data event data\n     */\n    onAfterDialogOpen(data) {\n      const dialog = data.dialog;\n      \n      $(dialog).on('click', '.add-service-hour', this.onAddServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-service-hour', this.onEditServiceHourClick.bind(this));\n      $(dialog).on('click', '.remove-service-hour', this.onRemoveServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-additional-details', this.onEditAdditionalDetailsClick.bind(this));\n      \n      this.redrawServiceHours();\n      this.linkInputs(dialog, ['addressType']);\n    }\n    \n    onAddServiceHourClick(event) {\n      this.openServiceHourEditDialog(null, (createdServiceHour) => {\n        this.serviceChannel.serviceHours.push(createdServiceHour);\n        this.redrawServiceHours();\n      });\n    }\n    \n    onEditServiceHourClick(event) {\n      const row = $(event.target).closest('tr');\n      const index = row.index();\n      const serviceHour = this.serviceChannel.serviceHours[index];\n      \n      this.openServiceHourEditDialog(serviceHour, (updatedServiceHour) => {\n        this.serviceChannel.serviceHours.splice(index, 1, updatedServiceHour);\n        this.redrawServiceHours();\n      });\n    }\n    \n    onRemoveServiceHourClick(event) {\n      const row = $(event.target).closest('tr');\n      const index = row.index();\n      this.serviceChannel.serviceHours.splice(index, 1);\n      this.redrawServiceHours();\n    }\n    \n    onEditAdditionalDetailsClick() {\n      this.openAdditionalDetailsEditDialog();\n    }\n  }\n  \n  window.PrintableFormServiceChannelEditorDialog = PrintableFormServiceChannelEditorDialog;\n  \n})(jQuery);;/* jshint esversion: 6 */\n/* global ajaxurl, moment, Promise */\n(($) => {\n  'use strict';\n  \n  class ElectronicServiceChannelEditorDialog extends window.AbstractServiceChannelEditorDialog {\n\n    /**\n     * Constructs service channel editor dialog\n     * \n     * @param {type} editor TinyMCE editor instance\n     * @param {type} channel\n     */\n    constructor(editor, channel) {\n      super(editor, channel, 'kunta_api_save_electronic_service_channel');\n      this.on(\"afterDialogOpen\", this.onAfterDialogOpen.bind(this));\n    }\n    \n    /**\n     * Translates service channel to be suitable for form\n     * \n     * @param {String} locale locale\n     * @returns {Object} form data\n     */\n    serviceChannelToForm(locale) {\n      return {\n        name: this.getTypedLocalizedValue(this.serviceChannel.names, locale, 'Name'),\n        shortDescription: this.getTypedLocalizedValue(this.serviceChannel.descriptions, locale, 'Summary'),\n        description: this.getTypedLocalizedValue(this.serviceChannel.descriptions, locale, 'Description'),\n        requiresAuthentication: this.serviceChannel.requiresAuthentication,\n        requiresSignature: this.serviceChannel.requiresSignature,\n        signatureQuantity: this.serviceChannel.signatureQuantity,\n        supportPhones: this.getLocalizedPhoneNumbers(this.serviceChannel.supportPhones, locale),\n        supportEmails: this.getLocalizedEmails(this.serviceChannel.supportEmails, locale),\n        webPage: this.getLocalizedWebPageUrl(this.serviceChannel.webPages, locale),\n        languages: this.serviceChannel.languages,\n        attachments: (this.serviceChannel.attachments || []).filter((attachment) => {\n          return attachment.url && attachment.language === locale;\n        }),\n        serviceHours: null,\n        publishingStatus: this.serviceChannel.publishingStatus\n      };\n    }\n    \n    /**\n     * Returns main form for service channel\n     * \n     * @returns {Object} metaform\n     */\n    getServiceChannelFormViewModel() {\n      return getElectronicServiceChannelMetaform();\n    }\n    \n    additionalDetailsToForm(serviceChannel) {\n      return {\n        areaCodes: this.areasToForm(serviceChannel.areas),\n        areaType: serviceChannel.areaType\n      };\n    }\n    \n    /**\n     * Translates form values to service channel\n     * \n     * @param {type} channel original channel data\n     * @param {type} formValues form values\n     * @returns {Object} updated service\n     */\n    serviceChannelFromForm(channel, formValues) {\n      const result = JSON.parse(JSON.stringify(channel));\n      \n      result.names = [];\n      result.descriptions = [];\n      result.webPages = [];\n      result.attachments = [];\n      result.requiresSignature = false;\n      result.requiresAuthentication = false;\n      result.supportPhones = [];\n      result.supportEmails = [];\n      result.attachments = [];\n  \n      this.supportedLocales.forEach((locale) => {\n        const localeValues = formValues[locale];\n        \n        result.signatureQuantity = localeValues.signatureQuantity || result.signatureQuantity;\n        result.requiresSignature = this.getFormBooleanValue(localeValues.requiresSignature, result.requiresSignature);\n        result.publishingStatus = localeValues.publishingStatus || result.publishingStatus;\n        result.requiresAuthentication = this.getFormBooleanValue(localeValues.requiresAuthentication, result.requiresAuthentication);\n        \n        this.setTypedLocalizedValue(result, 'names', localeValues, 'name', locale, 'Name');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'shortDescription', locale, 'Summary');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'description', locale, 'Description');\n\n        this.setLocalizedTableValues(result, 'supportPhones', localeValues, 'supportPhones', locale, (supportPhone) => {\n          return !!supportPhone.number;\n        }, (supportPhone) => {\n          return Object.assign({}, supportPhone, {\n            language: locale,\n            isFinnishServiceNumber: \"true\" === supportPhone.isFinnishServiceNumber,\n            type: \"Phone\"\n          });\n        });\n        \n        this.setLocalizedTableValues(result, 'supportEmails', localeValues, 'supportEmails', locale, (supportEmail) => {\n          return !!supportEmail.value;\n        });\n        \n        this.setLocalizedWebPages(result, 'webPages', localeValues, 'webPage', locale);\n        this.setLocalizedTableValues(result, 'attachments', localeValues, 'attachments', locale, (attachment) => {\n          return !!attachment.url;\n        }, (attachment) => {\n          return Object.assign(attachment, {\n            language: locale,\n            type: 'Attachment'\n          });\n        });\n      });\n      \n      return result;\n    }\n    \n    additionalDetailsFromForm(newFormValues) {\n      this.serviceChannel.areaType = newFormValues.areaType;\n      this.serviceChannel.areas = this.areasFromForm(newFormValues.areaType, newFormValues.areas);\n    }\n    \n    openAdditionalDetailsEditDialog() {\n      const viewModel = getElectronicServiceChannelAdditionalDetailsMetaform();\n      const formValues = this.additionalDetailsToForm(this.serviceChannel);\n\n      const dialog = this.openMetaformDialog(this.prepareViewModel(viewModel), formValues, (newFormValues) => {\n        this.additionalDetailsFromForm(newFormValues);\n      });\n\n      this.createAreasAutocomplete(dialog.find('*[data-name=\"areas\"]'), formValues.areaCodes);      \n    }\n    \n    /**\n     * Method invoked after dialog open\n     * \n     * @param {Object} data event data\n     */\n    onAfterDialogOpen(data) {\n      const dialog = data.dialog;\n      \n      $(dialog).on('click', '.add-service-hour', this.onAddServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-service-hour', this.onEditServiceHourClick.bind(this));\n      $(dialog).on('click', '.remove-service-hour', this.onRemoveServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-additional-details', this.onEditAdditionalDetailsClick.bind(this));\n      \n      this.redrawServiceHours();\n      this.linkInputs(dialog, ['requiresAuthentication', 'requiresSignature', 'signatureQuantity']);\n    }\n    \n    onAddServiceHourClick(event) {\n      this.openServiceHourEditDialog(null, (createdServiceHour) => {\n        this.serviceChannel.serviceHours.push(createdServiceHour);\n        this.redrawServiceHours();\n      });\n    }\n    \n    onEditServiceHourClick(event) {\n      const row = $(event.target).closest('tr');\n      const index = row.index();\n      const serviceHour = this.serviceChannel.serviceHours[index];\n      \n      this.openServiceHourEditDialog(serviceHour, (updatedServiceHour) => {\n        this.serviceChannel.serviceHours.splice(index, 1, updatedServiceHour);\n        this.redrawServiceHours();\n      });\n    }\n    \n    onRemoveServiceHourClick(event) {\n      const row = $(event.target).closest('tr');\n      const index = row.index();\n      this.serviceChannel.serviceHours.splice(index, 1);\n      this.redrawServiceHours();\n    }\n    \n    onEditAdditionalDetailsClick() {\n      this.openAdditionalDetailsEditDialog(this.serviceChannel);\n    }\n  }\n  \n  window.ElectronicServiceChannelEditorDialog = ElectronicServiceChannelEditorDialog;\n  \n})(jQuery);;/* jshint esversion: 6 */\n/* global ajaxurl, moment, Promise */\n(($) => {\n  'use strict';\n  \n  class PhoneServiceChannelEditorDialog extends window.AbstractServiceChannelEditorDialog {\n\n    /**\n     * Constructs service channel editor dialog\n     * \n     * @param {type} editor TinyMCE editor instance\n     * @param {type} channel\n     */\n    constructor(editor, channel) {\n      super(editor, channel, 'kunta_api_save_phone_service_channel');\n      this.on(\"afterDialogOpen\", this.onAfterDialogOpen.bind(this));\n    }\n    \n    /**\n     * Translates service channel to be suitable for form\n     * \n     * @param {String} locale locale\n     * @returns {Object} form data\n     */\n    serviceChannelToForm(locale) {\n      return {\n        name: this.getTypedLocalizedValue(this.serviceChannel.names, locale, 'Name'),\n        shortDescription: this.getTypedLocalizedValue(this.serviceChannel.descriptions, locale, 'Summary'),\n        description: this.getTypedLocalizedValue(this.serviceChannel.descriptions, locale, 'Description'),\n        phoneNumbers: this.getLocalizedPhoneNumbers(this.serviceChannel.phoneNumbers, locale),\n        supportEmails: this.getLocalizedEmails(this.serviceChannel.supportEmails, locale),\n        languages: this.serviceChannel.languages,\n        webPages: this.getLocalizedValue(this.serviceChannel.webPages, locale, 'url'),\n        serviceHours: null,\n        publishingStatus: this.serviceChannel.publishingStatus\n      };\n    }\n    \n    /**\n     * Returns main form for service channel\n     * \n     * @returns {Object} metaform\n     */\n    getServiceChannelFormViewModel() {\n      return getPhoneServiceChannelMetaform();\n    }\n    \n    /**\n     * Loads values for additional details form\n     * \n     * @param {Object} serviceChannel service channel\n     * @returns {Promise} promise for additional details\n     */\n    additionalDetailsToForm(serviceChannel) {\n      return this.languagesToForm(serviceChannel.languages)\n        .then((languageCodes) => {\n          return {\n            languageCodes: languageCodes,\n            areaCodes: this.areasToForm(serviceChannel.areas),\n            areaType: serviceChannel.areaType\n          };\n        });\n    }\n    \n    /**\n     * Translates form values to service channel\n     * \n     * @param {type} channel original channel data\n     * @param {type} formValues form values\n     * @returns {Object} updated service\n     */\n    serviceChannelFromForm(channel, formValues) {\n      const result = JSON.parse(JSON.stringify(channel));\n      \n      result.names = [];\n      result.descriptions = [];\n      result.phoneNumbers = [];\n      result.supportEmails = [];\n      result.webPages = [];\n  \n      this.supportedLocales.forEach((locale) => {\n        const localeValues = formValues[locale];\n        \n        result.publishingStatus = localeValues.publishingStatus || result.publishingStatus;\n        \n        this.setTypedLocalizedValue(result, 'names', localeValues, 'name', locale, 'Name');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'shortDescription', locale, 'Summary');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'description', locale, 'Description');\n\n        this.setLocalizedTableValues(result, 'phoneNumbers', localeValues, 'phoneNumbers', locale, (phoneNumber) => {\n          return !!phoneNumber.number;\n        }, (phoneNumber) => {\n          return Object.assign({}, phoneNumber, {\n            language: locale,\n            isFinnishServiceNumber: \"true\" === phoneNumber.isFinnishServiceNumber\n          });\n        });\n        \n        this.setLocalizedTableValues(result, 'supportEmails', localeValues, 'supportEmails', locale, (supportEmail) => {\n          return !!supportEmail.value;\n        });\n        \n        if (localeValues.webPages) {\n          result.webPages.push({\n            url: localeValues.webPages,\n            language: locale\n          });\n        }\n        \n      });\n      \n      return result;\n    }\n    \n    additionalDetailsFromForm(newFormValues) {\n      this.serviceChannel.areaType = newFormValues.areaType;\n      this.serviceChannel.languages = newFormValues.languages.split(\",\");\n      this.serviceChannel.areas = this.areasFromForm(newFormValues.areaType, newFormValues.areas);\n    }\n    \n    openAdditionalDetailsEditDialog() {\n      const viewModel = getPhoneServiceChannelAdditionalDetailsMetaform();\n      this.additionalDetailsToForm(this.serviceChannel)\n        .then((formValues) => {\n          const dialog = this.openMetaformDialog(this.prepareViewModel(viewModel), formValues, (newFormValues) => {\n            this.additionalDetailsFromForm(newFormValues);\n          });\n\n          this.createAreasAutocomplete(dialog.find('*[data-name=\"areas\"]'), formValues.areaCodes);   \n          this.createLanguagesAutocomplete(dialog.find('*[data-name=\"languages\"]'), formValues.languageCodes);   \n        })\n        .catch((err) => {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        });\n    }\n    \n    /**\n     * Method invoked after dialog open\n     * \n     * @param {Object} data event data\n     */\n    onAfterDialogOpen(data) {\n      const dialog = data.dialog;\n      \n      $(dialog).on('click', '.add-service-hour', this.onAddServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-service-hour', this.onEditServiceHourClick.bind(this));\n      $(dialog).on('click', '.remove-service-hour', this.onRemoveServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-additional-details', this.onEditAdditionalDetailsClick.bind(this));\n      \n      this.redrawServiceHours();\n    }\n    \n    onAddServiceHourClick(event) {\n      this.openServiceHourEditDialog(null, (createdServiceHour) => {\n        this.serviceChannel.serviceHours.push(createdServiceHour);\n        this.redrawServiceHours();\n      });\n    }\n    \n    onEditServiceHourClick(event) {\n      const row = $(event.target).closest('tr');\n      const index = row.index();\n      const serviceHour = this.serviceChannel.serviceHours[index];\n      \n      this.openServiceHourEditDialog(serviceHour, (updatedServiceHour) => {\n        this.serviceChannel.serviceHours.splice(index, 1, updatedServiceHour);\n        this.redrawServiceHours();\n      });\n    }\n    \n    onRemoveServiceHourClick(event) {\n      const row = $(event.target).closest('tr');\n      const index = row.index();\n      this.serviceChannel.serviceHours.splice(index, 1);\n      this.redrawServiceHours();\n    }\n    \n    onEditAdditionalDetailsClick() {\n      this.openAdditionalDetailsEditDialog();\n    }\n  }\n  \n  window.PhoneServiceChannelEditorDialog = PhoneServiceChannelEditorDialog;\n  \n})(jQuery);;/* jshint esversion: 6 */\n/* global ajaxurl, moment, Promise */\n(($) => {\n  'use strict';\n  \n  class WebPageServiceChannelEditorDialog extends window.AbstractServiceChannelEditorDialog {\n\n    /**\n     * Constructs service channel editor dialog\n     * \n     * @param {type} editor TinyMCE editor instance\n     * @param {type} channel\n     */\n    constructor(editor, channel) {\n      super(editor, channel, 'kunta_api_save_webpage_service_channel');\n      this.on(\"afterDialogOpen\", this.onAfterDialogOpen.bind(this));\n    }\n    \n    /**\n     * Translates service channel to be suitable for form\n     * \n     * @param {String} locale locale\n     * @returns {Object} form data\n     */\n    serviceChannelToForm(locale) {\n      return {\n        name: this.getTypedLocalizedValue(this.serviceChannel.names, locale, 'Name'),\n        shortDescription: this.getTypedLocalizedValue(this.serviceChannel.descriptions, locale, 'Summary'),\n        description: this.getTypedLocalizedValue(this.serviceChannel.descriptions, locale, 'Description'),\n        supportPhones: this.getLocalizedPhoneNumbers(this.serviceChannel.supportPhones, locale),\n        supportEmails: this.getLocalizedEmails(this.serviceChannel.supportEmails, locale),\n        webPage: this.getLocalizedWebPageUrl(this.serviceChannel.webPages, locale),\n        languages: this.serviceChannel.languages,\n        publishingStatus: this.serviceChannel.publishingStatus\n      };\n    }\n    \n    /**\n     * Returns main form for service channel\n     * \n     * @returns {Object} metaform\n     */\n    getServiceChannelFormViewModel() {\n      return getWebPageServiceChannelMetaform();\n    }\n    \n    /**\n     * Loads values for additional details form\n     * \n     * @param {Object} serviceChannel service channel\n     * @returns {Promise} promise for additional details\n     */\n    additionalDetailsToForm(serviceChannel) {\n      return this.languagesToForm(serviceChannel.languages)\n        .then((languageCodes) => {\n          return {\n            languageCodes: languageCodes\n          };\n        });\n    }\n    \n    /**\n     * Translates form values to service channel\n     * \n     * @param {type} channel original channel data\n     * @param {type} formValues form values\n     * @returns {Object} updated service\n     */\n    serviceChannelFromForm(channel, formValues) {\n      const result = JSON.parse(JSON.stringify(channel));\n      \n      result.names = [];\n      result.descriptions = [];\n      result.webPages = [];\n      result.supportPhones = [];\n      result.supportEmails = [];\n  \n      this.supportedLocales.forEach((locale) => {\n        const localeValues = formValues[locale];\n        \n        result.publishingStatus = localeValues.publishingStatus || result.publishingStatus;\n        \n        this.setTypedLocalizedValue(result, 'names', localeValues, 'name', locale, 'Name');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'shortDescription', locale, 'Summary');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'description', locale, 'Description');\n\n        this.setLocalizedTableValues(result, 'supportPhones', localeValues, 'supportPhones', locale, (supportPhone) => {\n          return !!supportPhone.number;\n        }, (supportPhone) => {\n          return Object.assign({}, supportPhone, {\n            language: locale,\n            isFinnishServiceNumber: \"true\" === supportPhone.isFinnishServiceNumber,\n            type: \"Phone\"\n          });\n        });\n        \n        this.setLocalizedTableValues(result, 'supportEmails', localeValues, 'supportEmails', locale, (supportEmail) => {\n          return !!supportEmail.value;\n        });\n        \n        this.setLocalizedWebPages(result, 'webPages', localeValues, 'webPage', locale);\n      });\n      \n      return result;\n    }\n    \n    additionalDetailsFromForm(newFormValues) {\n      this.serviceChannel.languages = (newFormValues.languages||'').split(',');\n    }\n    \n    openAdditionalDetailsEditDialog() {\n      const viewModel = getWebPageServiceChannelAdditionalDetailsMetaform();\n      this.additionalDetailsToForm(this.serviceChannel)\n        .then((formValues) => {\n          const dialog = this.openMetaformDialog(this.prepareViewModel(viewModel), formValues, (newFormValues) => {\n            this.additionalDetailsFromForm(newFormValues);\n          });\n\n          this.createLanguagesAutocomplete(dialog.find('*[data-name=\"languages\"]'), formValues.languageCodes);     \n        })\n        .catch((err) => {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        });\n    }\n    \n    /**\n     * Method invoked after dialog open\n     * \n     * @param {Object} data event data\n     */\n    onAfterDialogOpen(data) {\n      const dialog = data.dialog;\n      \n      $(dialog).on('click', '.edit-additional-details', this.onEditAdditionalDetailsClick.bind(this));\n    }\n    \n    onEditAdditionalDetailsClick() {\n      this.openAdditionalDetailsEditDialog(this.serviceChannel);\n    }\n  }\n  \n  window.WebPageServiceChannelEditorDialog = WebPageServiceChannelEditorDialog;\n  \n})(jQuery);;/* jshint esversion: 6 */\n/* global ajaxurl, moment, Promise */\n(($) => {\n  'use strict';\n  \n  class ServiceChannelsDialog extends window.KuntaApiAbstractEditDialog {\n\n    /**\n     * Constructs service channels dialog\n     * \n     * @param {type} editor TinyMCE editor instance\n     * @param {type} service\n     */\n    constructor(editor, service) {\n      super(editor);\n      this.service = service;\n      \n      this._channelDetails = [{\n        tabId: 'electronic-channels',\n        property: 'electronicServiceChannelIds',\n        title: 'Verkkoasiointikanavat',\n        afterProcessRow: this.onAfterElectronicChannelTableProcessRow.bind(this),\n        click: this.onElectronicChannelTableEditChannelButtonClick.bind(this),\n        findMethod: this.findElectronicServiceChannel\n      }, {\n        tabId: 'webpage-channels',\n        property: 'webPageServiceChannelIds',\n        title: 'Verkkosivu',\n        afterProcessRow: this.onAfterWebPageTableProcessRow.bind(this),\n        click: this.onWebPageChannelTableEditChannelButtonClick.bind(this),\n        findMethod: this.findWebPageServiceChannel\n      }, {\n        tabId: 'printable-form-service-channels',\n        property: 'printableFormServiceChannelIds',\n        title: 'Tulostettava lomake',\n        afterProcessRow: this.onAfterPrintableFormTableProcessRow.bind(this),\n        click: this.onPrintableFormChannelTableEditChannelButtonClick.bind(this),\n        findMethod: this.findPrintableFormServiceChannel\n      }, {\n        tabId: 'phone-service-channels',\n        property: 'phoneServiceChannelIds',\n        title: 'Puhelinasiointi',\n        afterProcessRow: this.onAfterPhoneServiceTableProcessRow.bind(this),\n        click: this.onPhoneServiceChannelTableEditChannelButtonClick.bind(this),\n        findMethod: this.findPhoneServiceChannel\n      }, {\n        tabId: 'service-location-service-channels',\n        property: 'serviceLocationServiceChannelIds',\n        title: 'Palvelupaikka',\n        afterProcessRow: this.onAfterServiceLocationTableProcessRow.bind(this),\n        click: this.onServiceLocationServiceChannelTableEditChannelButtonClick.bind(this),\n        findMethod: this.findServiceLocationServiceChannel\n      }];\n    }\n\n    open() {\n      const viewModel = getServiceChannelsMetaform();\n      const formValues = {};\n\n      this.dialog = this.openTabbedMetaformDialog(this._channelDetails.map((channelDetail) => {\n        return {\n          id: channelDetail.tabId,\n          title: channelDetail.title\n        };\n      }), viewModel, formValues, () => {\n        const newFormValues = {};\n        \n        this._channelDetails.forEach((channelDetail) => {\n          newFormValues[channelDetail.tabId] = {};\n          $(this.dialog).find(`#${channelDetail.tabId} form.metaform`).metaform('val', true).forEach((value) => {\n            newFormValues[channelDetail.tabId][value.name] = value.value;\n          });\n        });\n        \n        this.dialog.dialog(\"widget\").addClass('loading');\n        \n        const updatedService = this.translateServiceFromForm(newFormValues);\n        \n        this.saveService(updatedService, (err) => {\n          this.service = updatedService;\n           \n          this.dialog.dialog(\"widget\").removeClass('loading');\n          if (err) {\n            this.showError('Virhe tallentaessa', err);\n          } else {\n            this.dialog.dialog('close'); \n          }\n        });\n      });\n      \n      this._channelDetails.forEach((channelDetail) => {\n        const tabId = channelDetail.tabId;\n        \n        const channelsTable = this.dialog.find(`#${tabId} .table-field[data-field-name=\"channels\"]`);\n        channelsTable.tableField('option', 'afterProcessRow', channelDetail.afterProcessRow);\n        channelsTable.tableField('removeAllRows');\n        const channelPromises = (this.service[channelDetail.property]||[]).map((channelId) => {\n          return channelDetail.findMethod.call(this, channelId);\n        });\n        \n        channelsTable.on('click', 'td button[data-action=\"edit-channel\"]', channelDetail.click);\n        \n        Promise.all(channelPromises).then((channels) => {\n          channels.forEach((channel) => {\n            const row = channelsTable.tableField('addRow', {\n              id: channel.id,\n              name: this.getLocalizedValue(channel.names, 'fi')\n            });\n\n            row.find('*[data-column-name=\"name\"] input').metaformAutocomplete('val', {\n              value: channel.id,\n              label: this.getLocalizedValue(channel.names, 'fi')\n            }).change() ;\n          });\n        });\n        \n      });\n    }\n    \n    /**\n     * Closes dialog\n     */\n    close() {\n      this.dialog.remove();\n    }\n    \n    /**\n     * Opens electronic service channel editor\n     * \n     * @param {String} channelId channel id\n     */\n    openElectronicServiceChannelEditor(channelId) {\n      if (!channelId) {\n        return;\n      }\n      \n      this.close();\n      \n      this.findElectronicServiceChannel(channelId)\n        .then((serviceChannel) => {\n          const ElectronicServiceChannelEditorDialog = window.ElectronicServiceChannelEditorDialog;\n          const channelDialog = new ElectronicServiceChannelEditorDialog(this.editor, serviceChannel);\n          channelDialog.open();\n        })\n        .catch((err) => {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        });\n    }\n    \n    /**\n     * Opens phone service channel editor\n     * \n     * @param {String} channelId channel id\n     */\n    openPhoneServiceChannelEditor(channelId) {\n      if (!channelId) {\n        return;\n      }\n      \n      this.close();\n      \n      this.findPhoneServiceChannel(channelId)\n        .then((serviceChannel) => {\n          const PhoneServiceChannelEditorDialog = window.PhoneServiceChannelEditorDialog;\n          const channelDialog = new PhoneServiceChannelEditorDialog(this.editor, serviceChannel);\n          channelDialog.open();\n        })\n        .catch((err) => {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        });\n    }\n    \n    /**\n     * Opens printable form service channel editor\n     * \n     * @param {String} channelId channel id\n     */\n    openPrintableFormServiceChannelEditor(channelId) {\n      if (!channelId) {\n        return;\n      }\n      \n      this.close();\n      \n      this.findPrintableFormServiceChannel(channelId)\n        .then((serviceChannel) => {\n          const PrintableFormServiceChannelEditorDialog = window.PrintableFormServiceChannelEditorDialog;\n          const channelDialog = new PrintableFormServiceChannelEditorDialog(this.editor, serviceChannel);\n          channelDialog.open();\n        })\n        .catch((err) => {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        });\n    }\n    \n    /**\n     * Opens service location service channel editor\n     * \n     * @param {type} channelId\n     */\n    openServiceLocationServiceChannelEditor(channelId) {\n      if (!channelId) {\n        return;\n      }\n      \n      this.close();\n      \n      this.findServiceLocationServiceChannel(channelId)\n        .then((serviceChannel) => {\n          const ServiceLocationServiceChannelDialog = window.ServiceLocationServiceChannelDialog;\n          const dialog = new ServiceLocationServiceChannelDialog(this.editor, serviceChannel);\n          dialog.open();\n        })\n        .catch((err) => {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        });\n    }\n    \n    /**\n     * Opens web page service channel editor\n     * \n     * @param {String} channelId channel id\n     */\n    openWebPageServiceChannelEditor(channelId) {\n      if (!channelId) {\n        return;\n      }\n      \n      this.close();\n      \n      this.findWebPageServiceChannel(channelId)\n        .then((serviceChannel) => {\n          const WebPageServiceChannelEditorDialog = window.WebPageServiceChannelEditorDialog;\n          const channelDialog = new WebPageServiceChannelEditorDialog(this.editor, serviceChannel);\n          channelDialog.open();\n        })\n        .catch((err) => {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        });\n    }\n    \n    /**\n     * Creates autocomplete field for selecting service channels\n     * \n     * @param {jQuery} element autocomplete element\n     * @param {Array} channelId service channel id\n     */\n    createElectronicServiceChannelsAutocomplete(element, channelId) {\n      element.metaformAutocomplete('val', channelId);\n    }\n    \n    /**\n     * Creates updated version of service using form values\n     * \n     * @returns {Object} updated service\n     */\n    translateServiceFromForm() {\n      const result = JSON.parse(JSON.stringify(this.service));\n      \n      this._channelDetails.forEach((channelDetail) => {\n        const formValues = {};\n        \n        this.dialog.find(`#${channelDetail.tabId} .metaform`).metaform('val', true).forEach((value) => {\n          formValues[value.name] = value.value;\n        });\n        \n        const tableData = formValues.channels;\n        \n        const channelIds = (tableData ? JSON.parse(tableData) : []).map((tableRow) => {\n          return tableRow.name;\n        }).filter((channelId) => {\n          return !!channelId;\n        });\n        \n        result[channelDetail.property] = channelIds;\n      });\n      \n      return result;\n    }\n    \n    onAfterElectronicChannelTableProcessRow(row) {\n      this.createChannelAutocomplete(row, this.searchElectronicServiceChannels.bind(this));\n    }\n    \n    onAfterWebPageTableProcessRow(row) {\n      this.createChannelAutocomplete(row, this.searchWebPageServiceChannels.bind(this));\n    }\n    \n    onAfterPrintableFormTableProcessRow(row) {\n      this.createChannelAutocomplete(row, this.searchPrintableFormServiceChannels.bind(this));\n    }\n    \n    onAfterPhoneServiceTableProcessRow(row) {\n      this.createChannelAutocomplete(row, this.searchPhoneServiceChannels.bind(this));\n    }\n    \n    onAfterServiceLocationTableProcessRow(row) {\n      this.createChannelAutocomplete(row, this.searchServiceLocationServiceChannels.bind(this));\n    }\n    \n    createChannelAutocomplete(row, searchCall) {\n      row.find('*[data-column-name=\"name\"] input')\n        .metaformAutocomplete('option', 'customSource', (input, callback) => {\n          searchCall(input.term + '*')\n            .then((channels) => {\n              callback((channels||[]).map((channel) => {\n                return {\n                  value: channel.id,\n                  label: this.getLocalizedValue(channel.names, 'fi')\n                };\n              }));\n            })\n            .catch((err) => {\n              tinyMCE.activeEditor.windowManager.alert(err);\n            });\n        });\n    }\n    \n    onElectronicChannelTableEditChannelButtonClick(event) {\n      event.preventDefault();\n      \n      const value = $(event.target).closest('tr').find('*[data-column-name=\"name\"] input')\n        .metaformAutocomplete('val');\n\n      this.openElectronicServiceChannelEditor(value.value);\n    }\n\n    onWebPageChannelTableEditChannelButtonClick(event) {\n      event.preventDefault();\n      \n      const value = $(event.target).closest('tr').find('*[data-column-name=\"name\"] input')\n        .metaformAutocomplete('val');\n\n      this.openWebPageServiceChannelEditor(value.value);\n    }\n    \n    onPrintableFormChannelTableEditChannelButtonClick(event) {\n      event.preventDefault();\n      \n      const value = $(event.target).closest('tr').find('*[data-column-name=\"name\"] input')\n        .metaformAutocomplete('val');\n\n      this.openPrintableFormServiceChannelEditor(value.value);\n    }\n    \n    onPhoneServiceChannelTableEditChannelButtonClick(event) {\n      event.preventDefault();\n      \n      const value = $(event.target).closest('tr').find('*[data-column-name=\"name\"] input')\n        .metaformAutocomplete('val');\n\n      this.openPhoneServiceChannelEditor(value.value);\n    }\n    \n    onServiceLocationServiceChannelTableEditChannelButtonClick(event) {\n      event.preventDefault();\n      \n      const value = $(event.target).closest('tr').find('*[data-column-name=\"name\"] input')\n        .metaformAutocomplete('val');\n\n      this.openServiceLocationServiceChannelEditor(value.value);\n    }\n    \n  }\n  \n  window.ServiceChannelsDialog = ServiceChannelsDialog;\n  \n})(jQuery);;/* jshint esversion: 6 */\n/* global ajaxurl, tinymce, moment, Promise */\n((tinymce, $) => {\n  // TODO: Service:\n  // Luokittelu ja asiasanat\n\n  const SUPPORTED_COMPONENTS = {\n    'description': {\n      'title': 'Palvelun kuvaus'\n    },\n    'userInstruction': {\n      'title': 'Palvelun toimintaohjeet'\n    },\n    'languages': {\n      'title': 'Palvelun kielet'\n    },\n    'electronicServiceChannelIds': {\n      'title': 'Palvelun sähköiset palvelukanavat'\n    },\n    'phoneServiceChannelIds': {\n      'title': 'Palvelun puhelinpalvelukanavat'\n    },\n    'printableFormServiceChannelIds': {\n      'title': 'Palveluun liittyvät lomakkeet'\n    },\n    'serviceLocationServiceChannelIds': {\n      'title': 'Palvelun toimipisteet'\n    },\n    'webPageServiceChannelIds': {\n      'title': 'Palvelun hyödylliset linkit'\n    }\n  };\n  \n  class ServiceDialog extends window.KuntaApiAbstractEditDialog {\n    \n    /**\n     * Constructs edit dialog\n     * \n     * @param {type} editor TinyMCE editor instance\n     * @param {type} service\n     */\n    constructor(editor, service) {\n      super(editor);\n      this.service = service;\n    }\n    \n    open() {\n      const viewModel = getServiceMetaform();\n      const formValues = {};\n     \n      this.supportedLocales.map((locale) => {\n        formValues[locale] = this.serviceToForm(locale);\n      });\n     \n      const dialog = this.openLocalizedMetaformDialog(viewModel, formValues, (newFormValues) => {\n        dialog.dialog(\"widget\").addClass('loading');\n        \n        const updatedService = this.translateServiceFromForm(newFormValues);\n        const validationError = this.validate(updatedService);\n        \n        if (validationError !== null) {\n          this.showError('Virheellinen syöte', validationError);\n        } else {\n          this.service = updatedService;\n          \n          this.saveService(this.service, (err) => {\n            dialog.dialog(\"widget\").removeClass('loading');\n            if (err) {\n              this.showError('Virhe tallentaessa', err);\n            } else {\n              dialog.dialog('close'); \n            }\n          });\n        }\n      });\n      \n      $(dialog).on('click', '.edit-additional-details', this.onEditAdditionalDetailsClick.bind(this));\n      $(dialog).on('click', '.edit-channels', this.onEditChannelsClick.bind(this));\n    }\n    \n    openAdditionalDetailsEditDialog() {\n      const viewModel = getServiceAdditionalDetailsMetaform();\n      this.additionalDetailsToForm().then((formValues) => {\n        const dialog = this.openMetaformDialog(this.prepareViewModel(viewModel), formValues, (newFormValues) => {\n          this.additionalDetailsFromForm(newFormValues);\n        });\n        \n        this.createLanguagesAutocomplete(dialog.find('*[data-name=\"languages\"]'), formValues.languageCodes);\n        this.createAreasAutocomplete(dialog.find('*[data-name=\"areas\"]'), formValues.areaCodes);\n        this.createServiceProducersAutocomplete(dialog.find('*[data-name=\"serviceProducersPurchaseServices\"]'), formValues.serviceProducersPurchaseServiceItems);\n        this.createServiceProducersAutocomplete(dialog.find('*[data-name=\"serviceProducersOthers\"]'), formValues.serviceProducersOtherItems);\n      });\n      \n    }\n    \n    validate(service) {\n      return null;\n    }\n    \n    serviceToForm(locale) {\n      const type = this.service.type;\n      const chargeType = this.service.chargeType;\n      const fundingType = this.service.fundingType;\n      const name = this.getTypedLocalizedValue(this.service.names, locale, 'Name');\n      const alternateName = this.getTypedLocalizedValue(this.service.names, locale, 'AlternateName');\n      const shortDescription = this.getTypedLocalizedValue(this.service.descriptions, locale, 'Summary');\n      const description = this.getTypedLocalizedValue(this.service.descriptions, locale, 'Description');\n      const chargeTypeAdditionalInfo = this.getTypedLocalizedValue(this.service.descriptions, locale, 'ChargeTypeAdditionalInfo');\n      const userInstruction = this.getTypedLocalizedValue(this.service.descriptions, locale, 'ServiceUserInstruction');\n      const deadLineAdditionalInfo = this.getTypedLocalizedValue(this.service.descriptions, locale, 'DeadLineAdditionalInfo');\n      const processingTimeAdditionalInfo = this.getTypedLocalizedValue(this.service.descriptions, locale, 'ProcessingTimeAdditionalInfo');\n      const validityTimeAdditionalInfo = this.getTypedLocalizedValue(this.service.descriptions, locale, 'ValidityTimeAdditionalInfo');\n      const requirements = this.getLocalizedValue(this.service.requirements, locale);\n      const vouchers = this.service.vouchers.filter((voucher) => {\n        return voucher.value && voucher.language === locale;\n      });\n      \n      const legislation = this.service.legislation\n        .map((legistation) => {\n          return {\n            name: this.getLocalizedValue(legistation.names, locale),\n            webPage: this.getLocalizedValue(legistation.webPages, locale, 'url')\n          };\n        })\n        .filter((legistation) => {\n          return legistation.name && legistation.webPage;\n        });\n      \n      return {\n        type: type,\n        serviceChargeType: chargeType,\n        fundingType: fundingType,\n        name: name,\n        alternateName: alternateName,\n        shortDescription: shortDescription,\n        description: description,\n        chargeTypeAdditionalInfo: chargeTypeAdditionalInfo,\n        userInstruction: userInstruction,\n        deadLineAdditionalInfo: deadLineAdditionalInfo,\n        processingTimeAdditionalInfo: processingTimeAdditionalInfo,\n        validityTimeAdditionalInfo: validityTimeAdditionalInfo,\n        requirements: requirements,\n        serviceVouchersInUse: vouchers.length > 0 ? 'true' : 'false',\n        serviceVouchers: vouchers,\n        legislation: legislation\n      };\n    }\n    \n    /**\n     * Creates autocomplete field for selecting service producers\n     * \n     * @param {jQuery} element autocomplete element\n     * @param {Array} organizationItems organizationItem to be loaded\n     */\n    createServiceProducersAutocomplete(element, organizationItems) {\n      element\n        .metaformMultivalueAutocomplete('val', organizationItems)\n        .metaformMultivalueAutocomplete('option', 'customSource', (input, callback) => {\n          const search = this.splitSearchTerms(input.term);\n          if (!search) {\n            callback([]);\n            return;\n          }\n          \n          this.searchOrganizations(search)\n            .then((organizations) => {\n              callback(organizations.map((organization) => {\n                return {\n                  value: organization.id,\n                  label: this.getLocalizedValue(organization.names, 'fi')\n                };\n              }));\n            })\n            .catch((err) => {\n              tinyMCE.activeEditor.windowManager.alert(err);\n            });\n        });\n    }\n    \n    serviceProducersToForm(serviceOrganizations, provisionType) {\n      const findPromises = (serviceOrganizations||[]).filter((serviceOrganization) => {\n        return serviceOrganization.roleType === \"Producer\" && serviceOrganization.provisionType === provisionType;\n      }).map((serviceOrganization) => {\n        return this.findOrganization(serviceOrganization.organizationId);\n      });\n      \n      return Promise.all(findPromises)\n        .then((organizations) => {\n          return organizations.map((organization) => {\n            return {\n              value: organization.id,\n              label: this.getLocalizedValue(organization.names, 'fi')\n            };\n          });\n        })\n        .catch((err) => {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        });\n    }\n    \n    additionalDetailsToForm() {\n      const formPromises = [\n        this.languagesToForm(this.service.languages),\n        this.serviceProducersToForm(this.service.organizations, 'PurchaseServices'),\n        this.serviceProducersToForm(this.service.organizations, 'Other')\n      ];\n      \n      return Promise.all(formPromises)\n        .then((results) => {\n          const languageCodes = results[0];\n          const serviceProducersPurchaseServices = results[1];\n          const serviceProducersOthers = results[2];\n          \n          return {\n            languageCodes: languageCodes,\n            areaCodes: this.areasToForm(this.service.areas),\n            areaType: this.service.areaType,\n            serviceProducersPurchaseServiceItems: serviceProducersPurchaseServices,\n            serviceProducersOtherItems: serviceProducersOthers,\n            serviceProducersSelfProduced: (this.service.organizations||[]).filter((serviceOrganization) => {\n              return serviceOrganization.roleType === \"Producer\" && serviceOrganization.provisionType === 'SelfProduced';\n            }).length > 0\n          };\n        });\n    }\n    \n    translateServiceFromForm(formValues) {\n      const result = JSON.parse(JSON.stringify(this.service));\n      \n      result.names = [];\n      result.descriptions = [];\n      result.vouchers = []; \n  \n      // TODO: legislation\n    \n      this.supportedLocales.forEach((locale) => {\n        const localeValues = formValues[locale];\n        \n        result.type = localeValues.type || result.type;\n        result.chargeType = localeValues.serviceChargeType || result.chargeType;\n        result.fundingType = localeValues.fundingType || result.fundingType;\n        \n        this.setTypedLocalizedValue(result, 'names', localeValues, 'name', locale, 'Name');\n        this.setTypedLocalizedValue(result, 'names', localeValues, 'alternateName', locale, 'AlternativeName');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'shortDescription', locale, 'Summary');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'description', locale, 'Description');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'chargeTypeAdditionalInfo', locale, 'ChargeTypeAdditionalInfo');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'userInstruction', locale, 'ServiceUserInstruction');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'deadLineAdditionalInfo', locale, 'DeadLineAdditionalInfo');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'processingTimeAdditionalInfo', locale, 'ProcessingTimeAdditionalInfo');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'validityTimeAdditionalInfo', locale, 'ValidityTimeAdditionalInfo');\n        \n        this.setLocalizedValue(result, 'requirements', localeValues, 'requirements', locale);\n        \n        this.setLocalizedTableValues(result, 'vouchers', localeValues, 'serviceVouchers', locale, (voucher) => {\n          return voucher.value && voucher.url;\n        });\n\n      });\n      \n      return result;\n    }\n    \n    additionalDetailsFromForm(newFormValues) {\n      this.service.areaType = newFormValues.areaType;\n      this.service.languages = (newFormValues.languages||'').split(',');\n      this.service.areas = this.areasFromForm(newFormValues.areaType, newFormValues.areas);\n      this.service.organizations = this.service.organizations.filter((serviceOrganization) => {\n        return serviceOrganization.roleType !== 'Producer';\n      });\n      \n      const responsibleOrganizations = this.service.organizations.filter((serviceOrganization) => {\n        return serviceOrganization.roleType === 'Responsible';\n      });\n      \n      const formProducersPurchaseServices =  (newFormValues.serviceProducersPurchaseServices||'').split(',');\n      const formProducersOthers =  (newFormValues.serviceProducersOthers||'').split(',');\n      \n      const serviceProducersPurchaseServices = formProducersPurchaseServices.forEach((organizationId) => {\n        this.service.organizations.push({\n          provisionType: 'PurchaseServices',\n          roleType: 'Producer',\n          organizationId: organizationId\n        });\n      });\n      \n      const serviceProducersPurchaseOthers = formProducersOthers.forEach((organizationId) => {\n        this.service.organizations.push({\n          provisionType: 'Other',\n          roleType: 'Producer',\n          organizationId: organizationId\n        });\n      });\n      \n      if (newFormValues.serviceProducersSelfProduced) {\n        this.service.organizations.push({\n          provisionType: 'SelfProduced',\n          roleType: 'Producer',\n          organizationId: responsibleOrganizations.length > 0 ? responsibleOrganizations[0].organizationId : null\n        });\n      }\n    }\n    \n    onEditAdditionalDetailsClick() {\n      this.openAdditionalDetailsEditDialog();\n    }\n    \n    onEditChannelsClick() {\n      const dialog = new ServiceChannelsDialog(this.editor, this.service);\n      dialog.open();\n    }\n  }\n  \n  class ServiceEditor {\n    \n    constructor (editor) {\n      this.buttonStyle = {\n        'color': '#555',\n        'width': '100%',\n        'border': '1px solid #ccc',\n        'background': '#f7f7f7',\n        'display': 'block',\n        'padding': '5px',\n        'margin-top': '5px',\n        'margin-bottom': '5px',\n        'cursor': 'pointer'\n      };\n      \n      this.editor = editor;\n      \n      this.editor.on('BeforeSetcontent', this.onBeforeSetcontent.bind(this));\n      this.editor.on('GetContent', this.onGetContent.bind(this));\n      this.editor.on('DblClick', this.onDblClick.bind(this));\n      this.editor.addCommand('kunta-api-service-edit', this.onServiceEdit.bind(this));\n    }\n    \n    parseAttributes (string) {\n      const result = [];\n      const re = /([a-zA-Z-_]*)(\\=\\\")([a-zA-Z0-9-]*)(\\\")/g;\n      let match = null;\n      \n      do {\n        match = re.exec(string);\n        if (match && match.length > 3) {\n          result.push({\n            name: match[1],\n            value: match[3] \n          });\n        }\n      } while (match);\n\n      return result;\n    }\n    \n    getComponentTitle (name) {\n      return SUPPORTED_COMPONENTS[name].title;\n    }\n    \n    replaceShortcodes(content) {\n      return content.replace(/(\\[kunta_api_service_component)([a-zA-Z0-9 -=]*)(\\])/g, (all, tag, attributesText, end) => {\n        const attributes = this.parseAttributes(attributesText);\n        const placeholder = $('<input>')\n          .attr({\n           'type': 'button',\n           'data-kunta-api-placeholder': 'service'\n          })\n          .css(this.buttonStyle);\n          \n        for (let i = 0; i < attributes.length; i++) {\n          const attribute = attributes[i];\n          placeholder.attr('data-' + attribute.name, attribute.value);\n        }\n        \n        const component = placeholder.attr('data-component');\n        if (!SUPPORTED_COMPONENTS[component]) {\n          return all;\n        }\n        \n        placeholder.attr('value', this.getComponentTitle(component));\n        return $('<div>').append(placeholder).html();\n      });\n      \n    }\n    \n    restoreShortcodes(content) {\n      return content.replace(/<input [^>]+>/g, (match) => {\n        const input = $(match);\n        \n        if (input.attr('data-kunta-api-placeholder') === 'service') {\n          const shortcodeAttributes = [];\n          const attributeNames = ['service-id', 'component'];\n          \n          for (let i = 0; i < attributeNames.length; i++) {\n            const attributeName = attributeNames[i];\n            const attributeValue = input.attr('data-' + attributeName);\n            shortcodeAttributes.push([attributeName, '\"' + attributeValue + '\"'].join('='));\n          }\n          \n          return '[kunta_api_service_component ' + shortcodeAttributes.join(' ') + ']';\n        }\n        \n        return match;\n      });\n    }\n    \n    openElementEditor(element) {\n      const placeholderAttr = element.attributes['data-kunta-api-placeholder'];\n      if (placeholderAttr && placeholderAttr.value === 'service') {\n        const serviceId = element.attributes['data-service-id'].value;\n        const component = element.attributes['data-component'].value;  \n        \n        this.editor.execCommand('kunta-api-service-edit', '', {\n          serviceId: serviceId,\n          component: component\n        });\n      }\n    }\n    \n    findService(id, callback) {\n      $.post(ajaxurl, {\n        'action': 'kunta_api_load_service',\n        'serviceId': id\n      }, (response) => {\n        callback(null, JSON.parse(response));\n      })\n      .fail((response) => {\n        callback(response.responseText || response.statusText);\n      });\n    }\n    \n    onBeforeSetcontent(event) {\n      event.content = this.replaceShortcodes(event.content);\n    }\n    \n    onGetContent(event) {\n      event.content = this.restoreShortcodes(event.content);\n    }\n    \n    onDblClick(event) {\n      const element = event.target;\n      this.openElementEditor(element);\n    }\n\n    onServiceEdit(ui, options) {\n      const overlay = $('<div>')\n        .addClass('ui-widget-overlay')\n        .css('z-index', 99999)\n        .appendTo($('body'));\n\n      this.findService(options.serviceId, (err, service) => {\n        if (err) {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        } else {\n          const channelComponents = [\n            'electronicServiceChannelIds', \n            'phoneServiceChannelIds', \n            'printableFormServiceChannelIds', \n            'serviceLocationServiceChannelIds',\n            'webPageServiceChannelIds'];\n          \n          const dialog = channelComponents.indexOf(options.component) === -1 \n            ? new ServiceDialog(this.editor, service) \n            : new ServiceChannelsDialog(this.editor, service);\n            \n          overlay.remove();\n          dialog.open();\n        }\n      });\n    }\n    \n  }\n  \n  class ServiceEmbed {\n    \n    constructor (editor) {\n      this.editor = editor;\n      this.displayLocale = 'fi';\n      this.searching = false;\n      this.pending = false;\n      this.addButton();\n    }\n    \n    addButton () {\n      this.editor.addButton('kunta_api_service_embed', {\n        title: 'Search Kunta API services',\n        onclick: () => {\n          this.editor.windowManager.open({\n            title: 'Search Kunta API services',\n            width: 768,\n            height: 500,\n            body: [\n              { type: 'textbox', name: 'kunta-api-service-query', label: 'Query', onKeyUp: (e) => {     \n                if (!this.searching) {\n                  this.searching = true;\n                  this.searchServices(e.target.value, (response) => {\n                    this.searching = false;\n                    if (this.pending) {\n                      this.searchServices(e.target.value, (innerResponse) => {\n                        this.handleResponse(innerResponse);\n                      });\n                    } else {\n                      this.handleResponse(response);\n                    }\n                  });\n                } else {\n                  this.pending = true;\n                }\n              }},\n              {type: 'label', classes: 'kunta-api-search-info', text: \"Kirjoita hakusana yllä olevaan hakukenttään\"},\n              {type: 'container', classes: 'kunta-api-search-results', minHeight: 400}\n            ],\n            onsubmit: (e) => {\n              let responseHtml = '';\n              let allEmbedsFromSameChannel = true;              \n              const componentsToEmbed = $('.service-component-embed-input:checked');\n              \n              componentsToEmbed.each(function () {\n                var component = $(this).attr('data-component-type');\n                var serviceId = $(this).attr('data-service-id');\n                responseHtml += '[kunta_api_service_component service-id=\"'+ serviceId +'\" component=\"'+ component +'\"]';\n              });\n\n              this.editor.insertContent(responseHtml);\n            }\n          });\n        }\n      });\n    }\n    \n    searchServices(query, callback) {\n      $('.mce-kunta-api-search-results').empty();\n      $('.mce-kunta-api-search-results').append($('<div>').addClass('mce-kunta-api-search-results-loader'));\n      $('.mce-kunta-api-search-info').text('Ladataan...');\n      $.post(ajaxurl, {\n        'action': 'kunta_api_search_services',\n        'data': query\n      }, (response) => {\n        $('.mce-kunta-api-search-results-loader').remove();\n        callback(JSON.parse(response));\n      });\n    }\n    \n    getLocalizedValueAndType(values, locale, type) {\n      for (let i = 0; i < values.length; i++) {\n        if (locale === values[i].language && type === values[i].type) {\n          return values[i].value;\n        }\n      }\n      \n      return null;\n    }\n    \n    appendResult(result) {\n      const resultContainer = $('<div>').addClass('mce-kunta-api-search-result-row');\n      const name = this.getLocalizedValueAndType(result.names, this.displayLocale, 'Name');\n\n      resultContainer.append(\n        $('<p>')\n          .addClass('mce-kunta-api-search-result-title')\n          .text(name)\n      );\n      \n      Object.keys(SUPPORTED_COMPONENTS).forEach((component) => {\n        const options = SUPPORTED_COMPONENTS[component]; \n        resultContainer.append(\n          $('<p>')\n            .append($('<input>')\n            .addClass('service-component-embed-input')\n            .attr({\n              'type':'checkbox',\n              'data-component-type': component,\n              'data-service-id': result.id\n            }))\n            .append($('<span>').text(options.title))\n        );\n      });\n      \n      $('.mce-kunta-api-search-results').append(resultContainer);\n    }\n    \n    handleResponse(response) {\n      $('.mce-kunta-api-search-results').empty();\n\n      if (response.length === 0) {\n        $('.mce-kunta-api-search-info').text('Hakusanalla ei löytynyt yhtään palvelua');\n      } else {\n        $('.mce-kunta-api-search-info').text('Kirjoita hakusana yllä olevaan hakukenttään');\n      }\n\n      for (let i = 0; i < response.length; i++) {\n        this.appendResult(response[i]);\n      }\n\n    }\n    \n  }\n  \n  tinymce.PluginManager.add('kunta_api_service_embed', (editor, url) => {\n    new ServiceEmbed(editor);\n    new ServiceEditor(editor);\n  });\n  \n})(tinymce, jQuery);"]}
function getServiceHourMetaform(){return {"title":"Palveluaika","sections":[{"title":"Palvelunajan tyyppi","fields":[{"title":"Valitse","name":"type","type":"radio","required":true,"options":[{"name":"DaysOfTheWeek","text":"Normaalit palveluajat: viikonpäivät","checked":true},{"name":"OverMidnight","text":"Normaalit palveluajat: vuorokauden yli (päivystys)"},{"name":"Exceptional","text":"Poikkeavat palveluajat"}],"contexts":["FORM"],"editable":true}]},{"visible-if":{"field":"type","equals":"DaysOfTheWeek"},"title":"Normaalit palveluajat: viikonpäivät","fields":[{"title":"Toistaiseksi voimassa oleva","name":"Standard-validForNow","type":"radio","required":true,"options":[{"name":"true","text":"Toistaiseksi voimassa oleva","checked":true},{"name":"false","text":"Voimassa ajanjaksolla"}],"contexts":["FORM"],"editable":true},{"visible-if":{"field":"Standard-validForNow","equals":"false"},"title":"Voimassaolo alkaa","name":"Standard-validFrom","type":"date","required":true,"contexts":["FORM"],"editable":true},{"visible-if":{"field":"Standard-validForNow","equals":"false"},"title":"Voimassaolo päättyy","name":"Standard-validTo","type":"date","required":true,"contexts":["FORM"],"editable":true},{"title":"Aina avoinna (24/7).","name":"Standard-open24h","type":"boolean","required":true,"contexts":["FORM"],"editable":true},{"visible-if":{"field":"Standard-open24h","not-equals":true},"name":"Standard-openinghours","type":"table","title":"Palveluajat","required":true,"contexts":"FORM","addRows":true,"columns":[{"type":"enum","title":"Viikonpäivä","name":"day","values":[{"value":"1","text":"Maanantai"},{"value":"2","text":"Tiistai"},{"value":"3","text":"Keskiviikko"},{"value":"4","text":"Torstai"},{"value":"5","text":"Perjantai"},{"value":"6","text":"Lauantai"},{"value":"0","text":"Sunnuntai"}]},{"type":"time","title":"Avautuu","name":"from"},{"type":"time","title":"Sulkeutuu","name":"to"}]}]},{"visible-if":{"field":"type","equals":"OverMidnight"},"title":"Normaalit palveluajat: vuorokauden yli (päivystys)","fields":[{"title":"Toistaiseksi voimassa oleva","name":"Special-validForNow","type":"radio","required":true,"options":[{"name":"true","text":"Toistaiseksi voimassa oleva","checked":true},{"name":"false","text":"Voimassa ajanjaksolla"}],"contexts":["FORM"],"editable":true}]},{"visible-if":{"field":"type","equals":"OverMidnight"},"fields":[{"visible-if":{"field":"Special-validForNow","not-equals":"true"},"title":"Voimassaolo alkaa","name":"Special-validFrom","type":"date-time","required":true,"contexts":["FORM"],"editable":true},{"visible-if":{"field":"Special-validForNow","not-equals":"true"},"title":"Voimassaolo päättyy","name":"Special-validTo","type":"date-time","required":true,"contexts":["FORM"],"editable":true},{"title":"Alkupäivä","name":"Special-from-date","type":"select","options":[{"name":"1","text":"Maanantai"},{"name":"2","text":"Tiistai"},{"name":"3","text":"Keskiviikko"},{"name":"4","text":"Torstai"},{"name":"5","text":"Perjantai"},{"name":"6","text":"Lauantai"},{"name":"0","text":"Sunnuntai"}]},{"title":"Alkuaika","name":"Special-from-time","type":"time","required":true,"contexts":["FORM"],"editable":true},{"title":"Päättysmispäivä","name":"Special-to-date","type":"select","options":[{"name":"1","text":"Maanantai"},{"name":"2","text":"Tiistai"},{"name":"3","text":"Keskiviikko"},{"name":"4","text":"Torstai"},{"name":"5","text":"Perjantai"},{"name":"6","text":"Lauantai"},{"name":"0","text":"Sunnuntai"}]},{"title":"Päättymisaika","name":"Special-to-time","type":"time","required":true,"contexts":["FORM"],"editable":true}]},{"visible-if":{"field":"type","equals":"Exceptional"},"title":"Poikkeavat palveluajat","fields":[{"title":"Lisätieto ({LOCALE})","name":"Exception-additional-information-{LOCALE}","type":"text","required":true,"contexts":["FORM"],"editable":true},{"name":"Exception-type","type":"radio","required":true,"options":[{"name":"single","text":"Päivä"},{"name":"range","text":"Ajanjakso"},{"name":"closed-all-day","text":"Suljettu koko päivän","checked":true}],"contexts":["FORM"],"editable":true},{"title":"Alkupäivä","name":"Exception-from-date","type":"date","required":true,"contexts":["FORM"],"editable":true},{"visible-if":{"field":"Exception-type","equals":"range"},"title":"Päättymispäivä","name":"Exception-to-date","type":"date","required":true,"contexts":["FORM"],"editable":true},{"visible-if":{"field":"Exception-type","equals":"single","or":[{"field":"Exception-type","equals":"range"}]},"title":"Alkamisaika","name":"Exception-from-time","type":"time","required":true,"contexts":["FORM"],"editable":true},{"visible-if":{"field":"Exception-type","equals":"single","or":[{"field":"Exception-type","equals":"range"}]},"title":"Päättymisaika","name":"Exception-to-time","type":"time","required":true,"contexts":["FORM"],"editable":true}]}]};}'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}(function($){'use strict';var AbstractServiceChannelEditorDialog=function(_window$KuntaApiAbstr){_inherits(AbstractServiceChannelEditorDialog,_window$KuntaApiAbstr);function AbstractServiceChannelEditorDialog(editor,serviceChannel,saveAction){_classCallCheck(this,AbstractServiceChannelEditorDialog);var _this=_possibleConstructorReturn(this,(AbstractServiceChannelEditorDialog.__proto__||Object.getPrototypeOf(AbstractServiceChannelEditorDialog)).call(this,editor));_this.serviceChannel=serviceChannel;_this.saveAction=saveAction;return _this}_createClass(AbstractServiceChannelEditorDialog,[{key:'serviceChannelToForm',value:function serviceChannelToForm(locale,channel){return{}}},{key:'serviceChannelFromForm',value:function serviceChannelFromForm(channel,formValues){return{}}},{key:'getServiceChannelFormViewModel',value:function getServiceChannelFormViewModel(){return null}},{key:'validate',value:function validate(serviceChannel){return null}},{key:'saveChannel',value:function saveChannel(updatedChannel){var _this2=this;return new Promise(function(resolve,reject){$.post(ajaxurl,{'action':_this2.saveAction,'serviceChannel':JSON.stringify(updatedChannel)},function(response){resolve()}).fail(function(response){reject(response.responseText||response.statusText||'Unknown error occurred')})})}},{key:'redrawServiceHours',value:function redrawServiceHours(){var _this3=this;var serviceHourTexts=this.serviceChannel.serviceHours.map(function(serviceHour){return _this3.formatServiceHour(serviceHour)});$('table.serviceHours tbody').empty();if(serviceHourTexts.length){serviceHourTexts.forEach(function(serviceHourText){var row=$('<tr>').appendTo($('table.serviceHours tbody'));$('<td>').html(serviceHourText).appendTo(row);$('<td>').append($('<a>').addClass('btn btn-sm btn-warning remove-service-hour').html('Poista')).appendTo(row);$('<td>').append($('<a>').addClass('btn btn-sm btn-success edit-service-hour').html('Muokkaa')).appendTo(row)})}else{$('<tr>').append($('<td>').html('Palveluaikoja ei ole viel\xE4 m\xE4\xE4ritelty')).appendTo($('table.serviceHours tbody'))}}},{key:'serviceHourFromFormException',value:function serviceHourFromFormException(formValues){console.log('serviceHourFromFormException',formValues);var additionalInformation=[];var isClosed=formValues.type==='closed-all-day';var validForNow=false;var toTime=isClosed?null:formValues['Exception-to-time'];var fromTime=isClosed?null:formValues['Exception-from-time'];var openingHour=[];if(toTime||fromTime){openingHour.push({dayFrom:null,dayTo:null,from:fromTime,to:toTime,isExtra:false})}this.supportedLocales.forEach(function(locale){var value=formValues['Exception-additional-information-'+locale];if(value){additionalInformation.push({language:locale,value:value})}});return{serviceHourType:formValues.type,validFrom:this.parseIsoDate(formValues['Exception-from-date']),validTo:this.parseIsoDate(formValues['Exception-to-date']),isClosed:isClosed,validForNow:validForNow,additionalInformation:additionalInformation,openingHour:openingHour}}},{key:'serviceHourFromFormStandard',value:function serviceHourFromFormStandard(formValues){var isClosed=false;var validForNow=formValues[formValues.type+'-validForNow']==='true';var additionalInformation=[];var serviceHours=JSON.parse(formValues['Standard-openinghours']);var openingHour=formValues['Standard-open24h']?[]:serviceHours.map(function(serviceHour){return{dayFrom:parseInt(serviceHour.day),dayTo:parseInt(serviceHour.day),from:serviceHour.from,to:serviceHour.to,isExtra:false}});return{serviceHourType:formValues.type,validFrom:validForNow?null:this.parseIsoDate(formValues[formValues.type+'-validFrom']),validTo:validForNow?null:this.parseIsoDate(formValues[formValues.type+'-validTo']),isClosed:isClosed,validForNow:validForNow,additionalInformation:additionalInformation,openingHour:openingHour}}},{key:'serviceHourFromFormSpecial',value:function serviceHourFromFormSpecial(formValues){var isClosed=false;var validForNow=formValues[formValues.type+'-validForNow']==='true';var additionalInformation=[];var openingHour=[{dayFrom:parseInt(formValues['Special-from-date']),dayTo:parseInt(formValues['Special-to-date']),from:formValues['Special-from-time'],to:formValues['Special-to-time'],isExtra:false}];return{serviceHourType:formValues.type,validFrom:validForNow?null:this.parseIsoDate(formValues[formValues.type+'-validFrom']),validTo:validForNow?null:this.parseIsoDate(formValues[formValues.type+'-validTo']),isClosed:isClosed,validForNow:validForNow,additionalInformation:additionalInformation,openingHour:openingHour}}},{key:'serviceHourFromForm',value:function serviceHourFromForm(formValues){var serviceHourType=formValues.type;switch(serviceHourType){case'Exceptional':return this.serviceHourFromFormException(formValues);case'DaysOfTheWeek':return this.serviceHourFromFormStandard(formValues);case'OverMidnight':return this.serviceHourFromFormSpecial(formValues);}}},{key:'serviceHourToForm',value:function serviceHourToForm(serviceHour){var _this4=this;if(!serviceHour){return{}}var type=serviceHour.serviceHourType;var validForNow=serviceHour.validForNow?'true':'false';var validFrom=serviceHour.validForNow||!serviceHour.validFrom?null:moment(serviceHour.validFrom);var validTo=serviceHour.validForNow||!serviceHour.validTo?null:moment(serviceHour.validTo);var open24h=serviceHour.openingHour.length===0&&!serviceHour.isClosed;var validFromStr=validFrom?validFrom.format():null;var validToStr=validTo?validTo.format():null;var openingHour=serviceHour.openingHour&&serviceHour.openingHour.length?serviceHour.openingHour[0]:null;var openingHours=[];(serviceHour.openingHour||[]).forEach(function(openingHour){for(var day=openingHour.dayFrom;day<=openingHour.dayTo;day++){openingHours.push({day:day,from:openingHour.from,to:openingHour.to})}});switch(type){case'DaysOfTheWeek':return{'type':type,'Standard-validForNow':validForNow,'Standard-validFrom':validFromStr,'Standard-validTo':validToStr,'Standard-open24h':open24h,'Standard-openinghours':openingHours};case'OverMidnight':return{'type':type,'Special-validForNow':validForNow,'Special-validFrom':validFromStr,'Special-validTo':validToStr,'Special-from-date':openingHour?openingHour.dayFrom:null,'Special-from-time':openingHour?openingHour.from:null,'Special-to-date':openingHour?openingHour.dayTo:null,'Special-to-time':openingHour?openingHour.to:null};case'Exceptional':var openFrom=openingHour?openingHour.from:null;var openTo=openingHour?openingHour.to:null;var exceptionType=!validTo?!openFrom&&!openTo?'closed-all-day':'single':'range';if(validFrom&&openFrom){var parts=openFrom.split(':');validFrom.hour(parseInt(parts[0]));validFrom.minute(parseInt(parts[1]))}if(validTo&&openTo){var _parts=openTo.split(':');validTo.hour(parseInt(_parts[0]));validTo.minute(parseInt(_parts[1]))}var result={'type':type,'Exception-type':exceptionType,'Exception-from-date':validFrom?validFrom.format():null,'Exception-to-date':validTo?validTo.format():null,'Exception-from-time':openFrom,'Exception-to-time':openTo};this.supportedLocales.forEach(function(locale){result['Exception-additional-information-'+locale]=_this4.getLocalizedValue(serviceHour.additionalInformation,locale)});return result;default:throw new Error('Unknown service hour type '+type);}}},{key:'openServiceHourEditDialog',value:function openServiceHourEditDialog(serviceHour,callback){var _this5=this;var viewModel=getServiceHourMetaform();var formValues=this.serviceHourToForm(serviceHour);var dialog=this.openMetaformDialog(this.prepareViewModel(viewModel),formValues,function(newFormValues){var updatedServiceHour=_this5.serviceHourFromForm(newFormValues);callback(updatedServiceHour)})}},{key:'open',value:function open(){var _this6=this;var viewModel=this.getServiceChannelFormViewModel();var formValues={};this.supportedLocales.map(function(locale){formValues[locale]=_this6.serviceChannelToForm(locale)});this.trigger('beforeDialogOpen');var dialog=this.openLocalizedMetaformDialog(viewModel,formValues,function(newFormValues){dialog.dialog('widget').addClass('loading');var updatedChannel=_this6.serviceChannelFromForm(_this6.serviceChannel,newFormValues);var validationError=_this6.validate(updatedChannel);console.log('updatedChannel',updatedChannel);if(validationError!==null){_this6.showError('Virheellinen sy\xF6te',validationError)}else{_this6.saveChannel(updatedChannel).then(function(){_this6.serviceChannel=updatedChannel;dialog.dialog('close')}).catch(function(err){_this6.showError('Virhe tallentaessa',err)})}});this.trigger('afterDialogOpen',{dialog:dialog})}}]);return AbstractServiceChannelEditorDialog}(window.KuntaApiAbstractEditDialog);window.AbstractServiceChannelEditorDialog=AbstractServiceChannelEditorDialog})(jQuery);
//# sourceMappingURL=abstract-channel-edit-dialog.js.map

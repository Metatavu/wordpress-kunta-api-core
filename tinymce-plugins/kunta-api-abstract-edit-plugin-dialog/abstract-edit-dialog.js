'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}/* jshint esversion: 6 *//* global ajaxurl, moment, Promise */(function($){var KuntaApiAbstractEditDialog=function(){/**
     * Constructs abstract dialog class
     * 
     * @param {type} editor TinyMCE editor instance
     * @param {type} serviceLocationServiceChannel
     */function KuntaApiAbstractEditDialog(editor){_classCallCheck(this,KuntaApiAbstractEditDialog);this.supportedLocales=['fi','en','sv'];this.localeNames={'fi':'Suomi','en':'Englanti','sv':'Ruotsi'};this.serviceHourTypeNames={'Special':'P\xE4ivystys','Standard':'Normaali','Exception':'Poikkeus'};this.dayNames={0:'Sunnuntai',1:'Maanantai',2:'Tiistai',3:'Keskiviikko',4:'Torstai',5:'Perjantai',6:'Lauantai'};this.editor=editor;this.listeners=[]}_createClass(KuntaApiAbstractEditDialog,[{key:'getLocaleName',value:function getLocaleName(locale){return this.localeNames[locale]}},{key:'getServiceHourTypeName',value:function getServiceHourTypeName(type){return this.serviceHourTypeNames[type]}},{key:'getDayName',value:function getDayName(index,short){var name=this.dayNames[index];if(short){return name.substring(0,2)}return name}},{key:'formatServiceHour',value:function formatServiceHour(serviceHour){var _this=this;var type=this.getServiceHourTypeName(serviceHour.serviceHourType);if(serviceHour.serviceHourType==='Exception'){var result='('+type+')';if(serviceHour.isClosed){result+=' Suljettu'}var openingHour=serviceHour.openingHour&&serviceHour.openingHour.length?serviceHour.openingHour[0]:null;var openFrom=openingHour?openingHour.from:null;var openTo=openingHour?openingHour.to:null;if(serviceHour.validFrom&&serviceHour.validTo){result+=' '+this.formatDateWithTime(serviceHour.validFrom,openFrom)+' - '+this.formatDateWithTime(serviceHour.validTo,openTo)}else if(serviceHour.validFrom){result+=' '+this.formatDateWithTimes(serviceHour.validFrom,openFrom,openTo)}var additionalInformation=this.getAnyLocalizedValue(serviceHour.additionalInformation);if(additionalInformation){return result+' - '+additionalInformation}return result}else{if(serviceHour.openingHour.length===0&&!serviceHour.isClosed){return'('+type+') Aina avoinna (24/7)'}var openingHours=serviceHour.openingHour.map(function(openingHour){return _this.formatOpeningHour(openingHour)});return'('+type+') '+openingHours.join(',')}}},{key:'formatDateTime',value:function formatDateTime(dateTime){return moment(dateTime).locale('fi').format('lll')}},{key:'formatDate',value:function formatDate(date){return moment(date).locale('fi').format('ll')}},{key:'formatDateWithTime',value:function formatDateWithTime(date,time){var result=this.formatDate(date);if(time){return result+' '+time}return result}},{key:'formatDateWithTimes',value:function formatDateWithTimes(date,startTime,endTime){var start=this.formatDateWithTime(date,startTime);return endTime?start+' - '+endTime:start}},{key:'formatOpeningHour',value:function formatOpeningHour(dailyOpeningTime){if(dailyOpeningTime.dayFrom===null){return''}else{var result=this.getDayName(dailyOpeningTime.dayFrom,true);if(dailyOpeningTime.dayTo!==null&&dailyOpeningTime.dayTo!==dailyOpeningTime.dayFrom){result+=' - '+this.getDayName(dailyOpeningTime.dayTo,true)}if(dailyOpeningTime.from){result+=' '+dailyOpeningTime.from}if(dailyOpeningTime.to){result+=' - '+dailyOpeningTime.to}return result}}},{key:'openMetaformDialog',value:function openMetaformDialog(viewModel,formValues,callback){var dialog=$('<div>').attr({'title':viewModel.title});var dialogContents=$('<div>').addClass('container-fluid').html(mfRender({viewModel:viewModel,formValues:formValues})).appendTo(dialog);$(dialog).dialog({modal:true,draggable:false,width:$(window).width()*0.9,height:$(window).height()*0.9,buttons:[{text:'Tallenna',click:function click(){var formValues={};$(dialog).find('form.metaform').metaform('val',true).forEach(function(value){formValues[value.name]=value.value});callback(formValues);$(dialog).dialog('close')}},{text:'Peruuta',click:function click(){$(dialog).dialog('close')}}]});$(dialog).find('form.metaform').metaform();return dialog}},{key:'openLocalizedMetaformDialog',value:function openLocalizedMetaformDialog(viewModel,formValues,callback){var _this2=this;var dialog=$('<div>').attr({'title':viewModel.title});var dialogContents=$('<div>').addClass('container-fluid').appendTo(dialog);var dialogTabs=$('<ul>').appendTo(dialogContents);this.supportedLocales.forEach(function(locale){var tabId='locale-tab-'+locale;$('<li>').appendTo(dialogTabs).append($('<a>').attr('href','#'+tabId).text(_this2.getLocaleName(locale)));$('<div>').attr('id',tabId).html(mfRender({viewModel:viewModel,formValues:formValues[locale]})).appendTo(dialogContents)});dialogContents.tabs();$(dialog).dialog({modal:true,draggable:false,width:$(window).width()*0.9,height:$(window).height()*0.9,buttons:[{text:'Tallenna',click:function click(){var formValues={};_this2.supportedLocales.forEach(function(locale){formValues[locale]={};$(dialog).find('#locale-tab-'+locale+' form.metaform').metaform('val',true).forEach(function(value){formValues[locale][value.name]=value.value})});callback(formValues)}},{text:'Peruuta',click:function click(){$(dialog).dialog('close')}}]});$(dialog).find('form.metaform').metaform();return dialog}},{key:'searchCodes',value:function searchCodes(types,search){return new Promise(function(resolve,reject){$.post(ajaxurl,{'action':'kunta_api_search_codes','types':types,'search':search},function(response){var codes=JSON.parse(response);resolve(codes)}).fail(function(response){reject(response.responseText||response.statusText)})})}},{key:'getCodeTypeName',value:function getCodeTypeName(type){switch(type){case'Municipality':return'kunta';case'Province':return'maakunta';case'HospitalRegions':return'sairaanhoitopiiri';case'BusinessRegions':return'yrityspalvelujen seutualue';case'Country':return'maa';case'Language':return'kieli';case'Postal':return'postinumero';}}},{key:'getCodeNameWithType',value:function getCodeNameWithType(codeItem){var name=this.getLocalizedValue(codeItem.names,'fi');var type=this.getCodeTypeName(codeItem.type);return name+' ('+type+')'}},{key:'getMunicipalityNameWithType',value:function getMunicipalityNameWithType(municipality){var name=this.getLocalizedValue(municipality.names,'fi');var type=this.getCodeTypeName('Municipality');return name+' ('+type+')'}},{key:'showError',value:function showError(title,text){var contents=$('<div>').addClass('error').text(text);var dialog=$('<div>').attr('title',title).append(contents).dialog({modal:true,draggable:false,width:600,height:350,buttons:{Ok:function Ok(){$(dialog).dialog('close')}}})}},{key:'getTypedLocalizedValue',value:function getTypedLocalizedValue(values,locale,type){if(!values){return null}for(var i=0;i<values.length;i++){if(locale===values[i].language&&type===values[i].type){return values[i].value}}return null}},{key:'getLocalizedValue',value:function getLocalizedValue(values,locale){if(!values){return null}for(var i=0;i<values.length;i++){if(locale===values[i].language){return values[i].value}}return null}},{key:'getAnyLocalizedValue',value:function getAnyLocalizedValue(values){for(var i=0;i<this.supportedLocales.length;i++){var result=this.getLocalizedValue(values,this.supportedLocales[i]);if(result){return result}}return null}},{key:'prepareViewModel',value:function prepareViewModel(viewModel){var _this3=this;(viewModel.sections||[]).forEach(function(section){(section.fields||[]).forEach(function(field,index){var localeVariableIndex=field.name.indexOf('{LOCALE}');if(localeVariableIndex!==-1){section.fields.splice(index,1);_this3.supportedLocales.forEach(function(locale){section.fields.splice(index,0,Object.assign({},field,{name:field.name.replace(/\{LOCALE\}/g,locale),title:field.title.replace(/\{LOCALE\}/g,_this3.getLocaleName(locale))}))})}})});return viewModel}},{key:'parseIsoDate',value:function parseIsoDate(string){if(!string){return null}return new Date(Date.parse(string))}},{key:'trigger',value:function trigger(event,data){this.listeners.forEach(function(listener){if(listener.event===event){listener.callable(data||{})}})}},{key:'on',value:function on(event,callable){this.listeners.push({event:event,callable:callable})}}]);return KuntaApiAbstractEditDialog}();window.KuntaApiAbstractEditDialog=KuntaApiAbstractEditDialog})(jQuery);
//# sourceMappingURL=abstract-edit-dialog.js.map

{"version":3,"sources":["../src/kunta-api-abstract-edit-plugin-dialog/js/abstract-edit-dialog.js"],"names":["$","KuntaApiAbstractEditDialog","editor","supportedLocales","localeNames","serviceHourTypeNames","dayNames","listeners","locale","type","index","short","name","substring","serviceHour","getServiceHourTypeName","serviceHourType","result","isClosed","openingHour","length","openFrom","from","openTo","to","validFrom","validTo","formatDateWithTime","formatDateWithTimes","additionalInformation","getAnyLocalizedValue","openingHours","map","formatOpeningHour","join","dateTime","moment","format","date","time","formatDate","startTime","endTime","start","dailyOpeningTime","dayFrom","getDayName","dayTo","viewModel","formValues","callback","dialog","attr","title","dialogContents","addClass","html","mfRender","appendTo","modal","draggable","width","window","height","buttons","text","click","find","metaform","forEach","value","dialogTabs","tabId","append","getLocaleName","tabs","types","search","Promise","resolve","reject","post","ajaxurl","response","codes","JSON","parse","fail","responseText","statusText","codeItem","getLocalizedValue","names","getCodeTypeName","municipality","contents","Ok","values","i","language","sections","section","fields","field","localeVariableIndex","indexOf","splice","Object","assign","replace","string","Date","event","data","listener","callable","push","jQuery"],"mappings":"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","file":"abstract-edit-dialog.js","sourcesContent":["/* jshint esversion: 6 */\n/* global ajaxurl, moment, Promise */\n(($) => {\n  \n  class KuntaApiAbstractEditDialog {\n    \n    /**\n     * Constructs abstract dialog class\n     * \n     * @param {type} editor TinyMCE editor instance\n     * @param {type} serviceLocationServiceChannel\n     */\n    constructor(editor) {\n      this.supportedLocales = ['fi', 'en', 'sv'];\n      this.localeNames = {\n        'fi': 'Suomi',\n        'en': 'Englanti',\n        'sv': 'Ruotsi'\n      };\n      \n      this.serviceHourTypeNames = {\n        'Special': 'Päivystys',\n        'Standard': 'Normaali',\n        'Exception': 'Poikkeus'\n      };\n      \n      this.dayNames = {\n        0: 'Sunnuntai',\n        1: 'Maanantai',\n        2: 'Tiistai',\n        3: 'Keskiviikko',\n        4: 'Torstai',\n        5: 'Perjantai',\n        6: 'Lauantai'\n      };\n      \n      this.editor = editor;\n      this.listeners = [];\n    }\n    \n    getLocaleName(locale) {\n      return this.localeNames[locale];\n    }\n    \n    getServiceHourTypeName(type) {\n      return this.serviceHourTypeNames[type];\n    }\n    \n    getDayName(index, short) {\n      const name = this.dayNames[index];\n      if (short) {\n        return name.substring(0, 2);\n      }\n      \n      return name;\n    }\n    \n    formatServiceHour(serviceHour) {\n      const type = this.getServiceHourTypeName(serviceHour.serviceHourType);\n      if (serviceHour.serviceHourType === 'Exception') {\n        let result = `(${type})`;\n        \n        if (serviceHour.isClosed) {\n          result += ' Suljettu';\n        }\n        \n        const openingHour = serviceHour.openingHour && serviceHour.openingHour.length ? serviceHour.openingHour[0] : null;\n        const openFrom = openingHour ? openingHour.from : null;\n        const openTo = openingHour ? openingHour.to : null;\n        \n        if (serviceHour.validFrom && serviceHour.validTo) {\n          result += ` ${this.formatDateWithTime(serviceHour.validFrom, openFrom)} - ${this.formatDateWithTime(serviceHour.validTo, openTo)}`;\n        } else if (serviceHour.validFrom) {\n          result += ` ${this.formatDateWithTimes(serviceHour.validFrom, openFrom, openTo)}`;\n        }\n        \n        const additionalInformation = this.getAnyLocalizedValue(serviceHour.additionalInformation);\n        if (additionalInformation) {\n          return `${result} - ${additionalInformation}`;\n        }\n        \n        return result;\n      } else {\n        if (serviceHour.openingHour.length === 0 && !serviceHour.isClosed) {\n          return `(${type}) Aina avoinna (24/7)`;\n        }\n        \n        const openingHours = serviceHour.openingHour.map((openingHour) => {\n          return this.formatOpeningHour(openingHour);\n        });\n\n        return `(${type}) ${openingHours.join(',')}`;\n      }\n    }\n    \n    formatDateTime(dateTime) {\n      return moment(dateTime).locale('fi').format('lll');\n    }\n    \n    formatDate(date) {\n      return moment(date).locale('fi').format('ll');\n    }\n    \n    formatDateWithTime(date, time) {\n      const result = this.formatDate(date);\n      if (time) {\n        return `${result} ${time}`;\n      }\n      \n      return result;\n    }\n    \n    formatDateWithTimes(date, startTime, endTime) {\n      const start = this.formatDateWithTime(date, startTime);\n      return endTime ? `${start} - ${endTime}` : start;\n    }\n    \n    formatOpeningHour(dailyOpeningTime) {\n      if (dailyOpeningTime.dayFrom === null) {\n        return '';\n      } else {\n        let result = this.getDayName(dailyOpeningTime.dayFrom, true);\n\n        if (dailyOpeningTime.dayTo !== null && dailyOpeningTime.dayTo !== dailyOpeningTime.dayFrom) {\n          result += ' - ' + this.getDayName(dailyOpeningTime.dayTo, true);\n        }\n\n        if (dailyOpeningTime.from) {\n          result += ' ' + dailyOpeningTime.from;\n        }\n\n        if (dailyOpeningTime.to) {\n          result += ' - ' + dailyOpeningTime.to;\n        }\n\n        return result;\n      }\n    }\n    \n    openMetaformDialog(viewModel, formValues, callback) {\n      const dialog = $('<div>')\n        .attr({\n          'title': viewModel.title\n        });\n      \n      const dialogContents = $('<div>')\n        .addClass('container-fluid')\n        .html(mfRender({\n          viewModel: viewModel,\n          formValues: formValues\n        }))\n        .appendTo(dialog);\n      \n      $(dialog).dialog({\n        modal: true,\n        draggable: false,\n        width: $(window).width() * 0.9,\n        height: $(window).height() * 0.9,\n        buttons: [{\n          text: \"Tallenna\",\n          click: () => {\n            const formValues = {};\n            \n            $(dialog).find(`form.metaform`).metaform('val', true).forEach((value) => {\n              formValues[value.name] = value.value;\n            });\n            \n            callback(formValues);\n            $(dialog).dialog(\"close\");\n          }\n        }, {\n          text: \"Peruuta\",\n          click: () => {\n            $(dialog).dialog(\"close\");\n          }\n        }]\n      });\n       \n      $(dialog).find('form.metaform').metaform();\n      \n      return dialog;\n    }\n    \n    openLocalizedMetaformDialog(viewModel, formValues, callback) {\n      const dialog = $('<div>')\n        .attr({\n          'title': viewModel.title\n        });\n      \n      const dialogContents = $('<div>')\n        .addClass('container-fluid')\n        .appendTo(dialog);\n      \n      const dialogTabs = $('<ul>').appendTo(dialogContents);\n     \n      this.supportedLocales.forEach((locale) => {\n        const tabId = `locale-tab-${locale}`;\n        \n        $('<li>')\n          .appendTo(dialogTabs)\n          .append($('<a>').attr('href', `#${tabId}`).text(this.getLocaleName(locale)));\n\n        $('<div>')\n          .attr('id', tabId)\n          .html(mfRender({\n            viewModel: viewModel,\n            formValues: formValues[locale]\n          }))\n          .appendTo(dialogContents);\n      });\n      \n      dialogContents.tabs();\n      \n      $(dialog).dialog({\n        modal: true,\n        draggable: false,\n        width: $(window).width() * 0.9,\n        height: $(window).height() * 0.9,\n        buttons: [{\n          text: \"Tallenna\",\n          click: () => {\n            const formValues = {};\n            this.supportedLocales.forEach((locale) => {\n              formValues[locale] = {};\n              $(dialog).find(`#locale-tab-${locale} form.metaform`).metaform('val', true).forEach((value) => {\n                formValues[locale][value.name] = value.value;\n              });\n            });\n            \n            callback(formValues);\n          }\n        }, {\n          text: \"Peruuta\",\n          click: () => {\n            $(dialog).dialog(\"close\");\n          }\n        }]\n      });\n       \n      $(dialog).find('form.metaform').metaform();\n      \n      return dialog;\n    }\n    \n    searchCodes(types, search) {\n      return new Promise((resolve, reject) => {\n        $.post(ajaxurl, {\n          'action': 'kunta_api_search_codes',\n          'types': types,\n          'search': search\n        }, (response) => {\n          const codes = JSON.parse(response);\n          resolve(codes);\n        })\n        .fail((response) => {\n          reject(response.responseText || response.statusText);\n        });\n      });\n    }\n    \n    getCodeTypeName(type) {\n       switch (type) {\n        case 'Municipality':\n          return 'kunta';\n        case 'Province':\n          return 'maakunta';\n        case 'HospitalRegions':\n          return 'sairaanhoitopiiri';\n        case 'BusinessRegions':\n          return 'yrityspalvelujen seutualue';\n        case 'Country':\n          return 'maa';\n        case 'Language':\n          return 'kieli';\n        case 'Postal':\n          return 'postinumero';\n      }\n    }\n    \n    getCodeNameWithType(codeItem) {\n      const name = this.getLocalizedValue(codeItem.names, 'fi');\n      const type = this.getCodeTypeName(codeItem.type);\n      return `${name} (${type})`;\n    }\n    \n    getMunicipalityNameWithType(municipality) {\n      const name = this.getLocalizedValue(municipality.names, 'fi');\n      const type = this.getCodeTypeName('Municipality');\n      return `${name} (${type})`;\n    }\n    \n    showError(title, text) {\n      const contents = $('<div>')\n        .addClass('error')\n        .text(text);\n      \n      const dialog = $('<div>')\n        .attr('title', title)\n        .append(contents)\n        .dialog({\n          modal: true,\n          draggable: false,\n          width: 600,\n          height: 350,\n          buttons: {\n            Ok: () => {\n              $(dialog).dialog( \"close\" );\n            }\n          }\n        });\n    }\n    \n    getTypedLocalizedValue(values, locale, type) {\n      if (!values) {\n        return null;\n      }\n      \n      for (let i = 0; i < values.length; i++) {\n        if (locale === values[i].language && type === values[i].type) {\n          return values[i].value;\n        }\n      }\n      \n      return null;\n    }\n    \n    getLocalizedValue(values, locale) {\n      if (!values) {\n        return null;\n      }\n      \n      for (let i = 0; i < values.length; i++) {\n        if (locale === values[i].language) {\n          return values[i].value;\n        }\n      }\n      \n      return null;\n    }\n    \n    getAnyLocalizedValue(values) {\n      for (let i = 0; i < this.supportedLocales.length; i++) {\n        const result = this.getLocalizedValue(values, this.supportedLocales[i]);\n        if (result) {\n          return result;\n        }\n      }\n      \n      return null;\n    }\n    \n    prepareViewModel(viewModel) {\n      (viewModel.sections||[]).forEach((section) => {\n        (section.fields||[]).forEach((field, index) => {\n          const localeVariableIndex = field.name.indexOf('{LOCALE}');\n          if (localeVariableIndex !== -1) {\n            section.fields.splice(index, 1);\n            \n            this.supportedLocales.forEach((locale) => {\n              section.fields.splice(index, 0, Object.assign({}, field, {\n                name: field.name.replace(/\\{LOCALE\\}/g, locale),\n                title: field.title.replace(/\\{LOCALE\\}/g, this.getLocaleName(locale))\n              }));   \n            });\n          }\n        });\n      });\n      \n      return viewModel;\n    }\n    \n    parseIsoDate(string) {\n      if (!string) {\n        return null;\n      }\n      \n      return new Date(Date.parse(string));\n    }\n    \n    trigger (event, data) {\n      this.listeners.forEach((listener) => {\n        if (listener.event === event) {\n          listener.callable(data||{});\n        }\n      });\n    }\n    \n    on (event, callable) {\n      this.listeners.push({\n        event: event,\n        callable: callable\n      });\n    }\n    \n  }\n  \n  window.KuntaApiAbstractEditDialog = KuntaApiAbstractEditDialog;\n  \n})(jQuery);"]}
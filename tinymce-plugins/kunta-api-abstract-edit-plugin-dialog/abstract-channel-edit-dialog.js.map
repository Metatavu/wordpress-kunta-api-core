{"version":3,"sources":["../src/kunta-api-abstract-edit-plugin-dialog/js/abstract-channel-edit-dialog.js"],"names":["$","AbstractServiceChannelEditorDialog","editor","serviceChannel","saveAction","locale","channel","formValues","updatedChannel","Promise","resolve","reject","post","ajaxurl","JSON","stringify","response","fail","responseText","statusText","serviceHourTexts","serviceHours","map","serviceHour","formatServiceHour","empty","length","forEach","serviceHourText","row","appendTo","html","append","addClass","console","log","additionalInformation","isClosed","type","validForNow","toTime","fromTime","openingHour","push","dayFrom","dayTo","from","to","isExtra","supportedLocales","value","language","serviceHourType","validFrom","parseIsoDate","validTo","parse","parseInt","day","serviceHourFromFormException","serviceHourFromFormStandard","serviceHourFromFormSpecial","moment","open24h","validFromStr","format","validToStr","openingHours","openFrom","openTo","exceptionType","parts","split","hour","minute","result","getLocalizedValue","Error","callback","viewModel","getServiceHourMetaform","serviceHourToForm","dialog","openMetaformDialog","prepareViewModel","newFormValues","updatedServiceHour","serviceHourFromForm","getServiceChannelFormViewModel","serviceChannelToForm","trigger","openLocalizedMetaformDialog","serviceChannelFromForm","validationError","validate","showError","saveChannel","then","catch","err","window","KuntaApiAbstractEditDialog","jQuery"],"mappings":"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","file":"abstract-channel-edit-dialog.js","sourcesContent":["/* jshint esversion: 6 */\n/* global ajaxurl, moment, Promise */\n(($) => {\n  'use strict';\n  \n  class AbstractServiceChannelEditorDialog extends window.KuntaApiAbstractEditDialog {\n    \n    /**\n     * Constructs class\n     * \n     * @param {Object} editor TinyMCE editor instance\n     * @param {Object} serviceChannel service channel\n     * @param {String} saveAction ajax action to save the channel\n     */\n    constructor(editor, serviceChannel, saveAction) {\n      super(editor);\n      this.serviceChannel = serviceChannel;\n      this.saveAction = saveAction;\n    }\n    \n    /**\n     * Translates service channel to be suitable for form\n     * \n     * @param {String} locale locale\n     * @param {Object} channel channel object\n     * @returns {Object} form data\n     */\n    serviceChannelToForm(locale, channel) {\n      return {};\n    }\n    \n    /**\n     * Translates form values to service channel\n     * \n     * @param {type} channel original channel data\n     * @param {type} formValues form values\n     * @returns {Object} updated service\n     */\n    serviceChannelFromForm(channel, formValues) {\n      return {};  \n    }\n    \n    /**\n     * Returns main form for service channel\n     * \n     * @returns {Object} metaform\n     */\n    getServiceChannelFormViewModel() {\n      return null;\n    }\n    \n    /**\n     * Validates updated service channel. returns validation error message or null if servie channel is valid\n     * \n     * @param {Object} serviceChannel\n     * @returns {String} validation error message or null if servie channel is valid\n     */\n    validate(serviceChannel) {\n      return null;  \n    }\n    \n    /**\n     * Saves the channel\n     * \n     * @param updatedChannel channel data\n     * @returns {Promise} promise for save result\n     */\n    saveChannel(updatedChannel) {\n     return new Promise((resolve, reject) => {\n        $.post(ajaxurl, {\n          'action': this.saveAction,\n          'serviceChannel': JSON.stringify(updatedChannel)\n        }, (response) => {\n          resolve();\n        })\n        .fail((response) => {\n          reject(response.responseText || response.statusText || \"Unknown error occurred\");\n        });\n      });\n    }\n    \n    /**\n     * Redraws service hours table\n     */\n    redrawServiceHours() {\n      const serviceHourTexts = this.serviceChannel.serviceHours.map((serviceHour) => {\n        return this.formatServiceHour(serviceHour);\n      });\n      \n      $('table.serviceHours tbody').empty();\n      \n      if (serviceHourTexts.length) {\n        serviceHourTexts.forEach((serviceHourText) => {\n          const row = $('<tr>').appendTo($('table.serviceHours tbody'));\n          $('<td>').html(serviceHourText).appendTo(row);\n          $('<td>').append($('<a>').addClass('btn btn-sm btn-warning remove-service-hour').html('Poista')).appendTo(row);\n          $('<td>').append($('<a>').addClass('btn btn-sm btn-success edit-service-hour').html('Muokkaa')).appendTo(row);\n        });\n      } else {\n        $('<tr>')\n          .append($('<td>').html('Palveluaikoja ei ole vielä määritelty'))\n          .appendTo($('table.serviceHours tbody'));\n      }\n    }\n    \n    serviceHourFromFormException(formValues) {\n      console.log(\"serviceHourFromFormException\", formValues);\n\n      const additionalInformation = [];\n      const isClosed = formValues.type === 'closed-all-day';\n      const validForNow = false;\n      const toTime = isClosed ? null : formValues[`Exception-to-time`];\n      const fromTime = isClosed ? null : formValues[`Exception-from-time`];\n      const openingHour = [];\n      \n      if (toTime || fromTime) {\n        openingHour.push({\n          dayFrom: null,\n          dayTo: null,\n          from: fromTime,\n          to: toTime,\n          isExtra: false\n        });\n      }\n      \n      this.supportedLocales.forEach((locale) => {\n        const value = formValues[`Exception-additional-information-${locale}`];\n        if (value) {\n          additionalInformation.push({\n            language: locale,\n            value: value\n          });  \n        }\n      });\n      \n      return {\n        serviceHourType: formValues.type,\n        validFrom: this.parseIsoDate(formValues[`Exception-from-date`]),\n        validTo: this.parseIsoDate(formValues[`Exception-to-date`]),\n        isClosed: isClosed,\n        validForNow: validForNow,\n        additionalInformation: additionalInformation,\n        openingHour: openingHour\n      };\n    }\n    \n    serviceHourFromFormStandard(formValues) {\n      const isClosed = false;\n      const validForNow = formValues[`${formValues.type}-validForNow`] === \"true\";\n      const additionalInformation = [];\n      const serviceHours = JSON.parse(formValues['Standard-openinghours']);\n      const openingHour = formValues['Standard-open24h'] ? [] : serviceHours.map((serviceHour) => {\n        return {\n          dayFrom: parseInt(serviceHour.day),\n          dayTo: parseInt(serviceHour.day),\n          from: serviceHour.from,\n          to: serviceHour.to,\n          isExtra: false\n        };\n      });\n      \n      return {\n        serviceHourType: formValues.type,\n        validFrom: validForNow ? null : this.parseIsoDate(formValues[`${formValues.type}-validFrom`]),\n        validTo: validForNow ? null : this.parseIsoDate(formValues[`${formValues.type}-validTo`]),\n        isClosed: isClosed,\n        validForNow: validForNow,\n        additionalInformation: additionalInformation,\n        openingHour: openingHour\n      };\n    }\n    \n    serviceHourFromFormSpecial(formValues) {\n      const isClosed = false;\n      const validForNow = formValues[`${formValues.type}-validForNow`] === \"true\";\n      const additionalInformation = [];\n      const openingHour = [{\n        dayFrom: parseInt(formValues['Special-from-date']),\n        dayTo: parseInt(formValues['Special-to-date']),\n        from: formValues['Special-from-time'],\n        to: formValues['Special-to-time'],\n        isExtra: false\n      }];\n    \n      return {\n        serviceHourType: formValues.type,\n        validFrom: validForNow ? null : this.parseIsoDate(formValues[`${formValues.type}-validFrom`]),\n        validTo: validForNow ? null : this.parseIsoDate(formValues[`${formValues.type}-validTo`]),\n        isClosed: isClosed,\n        validForNow: validForNow,\n        additionalInformation: additionalInformation,\n        openingHour: openingHour\n      };\n    }\n    \n    serviceHourFromForm(formValues) {\n      const serviceHourType = formValues.type;\n      switch (serviceHourType) {\n        case \"Exceptional\":\n          return this.serviceHourFromFormException(formValues);\n        case \"DaysOfTheWeek\":\n          return this.serviceHourFromFormStandard(formValues);\n        case \"OverMidnight\":\n          return this.serviceHourFromFormSpecial(formValues);\n      }\n    }\n    \n    serviceHourToForm(serviceHour) {\n      if (!serviceHour) {\n        return {};\n      }\n      \n      const type = serviceHour.serviceHourType;\n      const validForNow = serviceHour.validForNow ? \"true\" : \"false\";\n      const validFrom = serviceHour.validForNow || !serviceHour.validFrom ? null : moment(serviceHour.validFrom);\n      const validTo = serviceHour.validForNow || !serviceHour.validTo ? null : moment(serviceHour.validTo);\n      const open24h = serviceHour.openingHour.length === 0 && !serviceHour.isClosed;\n      const validFromStr = validFrom ? validFrom.format() : null;\n      const validToStr = validTo ? validTo.format() : null;\n      const openingHour = serviceHour.openingHour && serviceHour.openingHour.length ? serviceHour.openingHour[0] : null;\n      const openingHours = [];\n          \n      (serviceHour.openingHour||[]).forEach((openingHour) => {\n        for (let day = openingHour.dayFrom; day <= openingHour.dayTo; day++) {\n          openingHours.push({\n            day: day,\n            from: openingHour.from,\n            to: openingHour.to\n          });\n        }\n      });\n      \n      switch (type) {\n        case 'DaysOfTheWeek':\n          return {\n            'type': type,\n            'Standard-validForNow': validForNow,\n            'Standard-validFrom': validFromStr,\n            'Standard-validTo': validToStr,\n            'Standard-open24h': open24h,\n            'Standard-openinghours': openingHours\n          };\n        case 'OverMidnight':\n          return {\n            'type': type,\n            'Special-validForNow': validForNow,\n            'Special-validFrom': validFromStr,\n            'Special-validTo': validToStr,\n            'Special-from-date': openingHour ? openingHour.dayFrom : null,\n            'Special-from-time': openingHour ? openingHour.from : null,\n            'Special-to-date': openingHour ? openingHour.dayTo : null,\n            'Special-to-time': openingHour ? openingHour.to : null\n          };\n        case 'Exceptional':\n          const openFrom = openingHour ? openingHour.from : null;\n          const openTo = openingHour ? openingHour.to : null;\n          const exceptionType = !validTo ? !openFrom && !openTo ? 'closed-all-day' : 'single' : 'range';\n          \n          if (validFrom && openFrom) {\n            const parts = openFrom.split(':');\n            validFrom.hour(parseInt(parts[0]));\n            validFrom.minute(parseInt(parts[1]));\n          }\n          \n          if (validTo && openTo) {\n            const parts = openTo.split(':');\n            validTo.hour(parseInt(parts[0]));\n            validTo.minute(parseInt(parts[1]));\n          }\n          \n          const result = {\n            'type': type,\n            'Exception-type': exceptionType,\n            'Exception-from-date': validFrom ? validFrom.format() : null,\n            'Exception-to-date': validTo ? validTo.format() : null,\n            'Exception-from-time': openFrom,\n            'Exception-to-time': openTo\n          };\n          \n          this.supportedLocales.forEach((locale) => {\n            result[`Exception-additional-information-${locale}`] = this.getLocalizedValue(serviceHour.additionalInformation, locale);\n          });\n          \n          return result;\n        default:\n          throw new Error(`Unknown service hour type ${type}`);\n      }\n    }\n    \n    openServiceHourEditDialog(serviceHour, callback) {\n      const viewModel = getServiceHourMetaform();\n      const formValues = this.serviceHourToForm(serviceHour);\n      const dialog = this.openMetaformDialog(this.prepareViewModel(viewModel), formValues, (newFormValues) => {\n        const updatedServiceHour = this.serviceHourFromForm(newFormValues);\n        callback(updatedServiceHour);\n      });\n    }\n    \n    /**\n     * Opens channel editor\n     */\n    open() {\n      const viewModel = this.getServiceChannelFormViewModel();\n      const formValues = {};\n      this.supportedLocales.map((locale) => {\n        formValues[locale] = this.serviceChannelToForm(locale);\n      });\n      \n      this.trigger(\"beforeDialogOpen\");\n      \n      const dialog = this.openLocalizedMetaformDialog(viewModel, formValues, (newFormValues) => {\n        dialog.dialog(\"widget\").addClass('loading');\n        \n        const updatedChannel = this.serviceChannelFromForm(this.serviceChannel, newFormValues);\n        const validationError = this.validate(updatedChannel);\n\n        console.log(\"updatedChannel\", updatedChannel);\n        \n        if (validationError !== null) {\n          this.showError('Virheellinen syöte', validationError);\n        } else {\n          this.saveChannel(updatedChannel)\n            .then(() => {\n              this.serviceChannel = updatedChannel;\n              dialog.dialog('close'); \n            })\n            .catch((err) => {\n              this.showError('Virhe tallentaessa', err);\n            });\n        }\n      });\n      \n      this.trigger(\"afterDialogOpen\", {\n        dialog: dialog\n      });\n    }\n  }\n  \n  window.AbstractServiceChannelEditorDialog = AbstractServiceChannelEditorDialog;\n  \n})(jQuery);"]}
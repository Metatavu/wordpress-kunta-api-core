{"version":3,"sources":["../src/kunta-api-service-location-channel-embed/js/plugin.js"],"names":["tinymce","$","SUPPORTED_COMPONENTS","ServiceLocationServiceChannelDialog","editor","serviceChannel","on","onAfterDialogOpen","bind","getServiceLocationServiceChannelMetaform","viewModel","getServiceLocationChannelAdditionalDetailsMetaform","additionalDetailsToForm","then","formValues","dialog","openMetaformDialog","prepareViewModel","newFormValues","additionalDetailsFromForm","createLanguagesAutocomplete","find","languageCodes","createAreasAutocomplete","areaCodes","serviceLocationServiceChannel","addressSubtypes","j","addresses","length","address","subtype","i","push","existingLocationServiceChannel","JSON","parse","stringify","descriptions","emails","phoneNumbers","supportedLocales","forEach","locale","localeValues","localeAddresses","filter","street","trim","localeAddress","addressIndex","additionalInformations","streetAddress","type","country","additionalInformation","postalCode","postOfficeCode","streetNumber","foreignAddresses","foreign","foreignAddress","foreignAddressIndex","locationAbroad","concat","email","map","phoneNumber","prefixNumber","number","Object","assign","isFinnishServiceNumber","faxes","fax","webPages","webPage","url","description","shortDescription","languagesToForm","languages","areasToForm","areas","areaType","split","areasFromForm","name","getTypedLocalizedValue","names","visitAddresses","language","getLocalizedWebPages","getLocalizedValue","value","data","onAddServiceHourClick","onEditServiceHourClick","onRemoveServiceHourClick","onEditAdditionalDetailsClick","redrawServiceHours","event","openServiceHourEditDialog","createdServiceHour","serviceHours","openAdditionalDetailsEditDialog","row","target","closest","index","serviceHour","updatedServiceHour","splice","window","AbstractServiceChannelEditorDialog","ServiceLocationServiceChannelEditor","buttonStyle","onBeforeSetcontent","onGetContent","onDblClick","addCommand","onServiceLocationChannelEdit","string","result","re","match","exec","title","content","replace","all","tag","attributesText","end","attributes","parseAttributes","placeholder","attr","css","attribute","component","getComponentTitle","append","html","input","shortcodeAttributes","attributeNames","attributeName","attributeValue","join","element","placeholderAttr","serviceLocationServiceChannelId","execCommand","id","callback","post","ajaxurl","response","fail","responseText","statusText","replaceShortcodes","restoreShortcodes","openElementEditor","ui","options","findServiceLocationServiceChannel","err","tinyMCE","activeEditor","windowManager","alert","open","ServiceLocationServiceChannelEmbed","displayLocale","searching","pending","addButton","onclick","width","height","body","label","onKeyUp","e","searchServiceLocationChannels","innerResponse","handleResponse","classes","text","minHeight","onsubmit","responseHtml","allEmbedsFromSameChannel","componentsToEmbed","firstServiceLocationChannelId","first","serviceLocationChannelName","each","serviceLocationChannelId","confirm","confirmed","pageId","val","markAsServiceLocationPage","insertContent","query","empty","addClass","remove","values","resultContainer","getLocalizedValueAndType","keys","appendResult","PluginManager","add","jQuery"],"mappings":"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","file":"plugin.js","sourcesContent":["/* jshint esversion: 6 */\n/* global ajaxurl, tinymce, moment, Promise */\n((tinymce, $) => {\n  \n  const SUPPORTED_COMPONENTS = {\n    'name': {\n      'title': 'Palvelupisteen nimi'\n    },\n    'description': {\n      'title': 'Palvelupisteen kuvaus'\n    },\n    'email': {\n      'title': 'Palvelupisteen sähköpostiosoitteet'\n    },\n    'addresses': {\n      'title': 'Palvelupisteen osoitetiedot'\n    },\n    'fax': {\n      'title': 'Palvelupisteen faksi'\n    },\n    'phone': {\n      'title': 'Palvelupisteen puhelinnumerot'\n    },\n    'servicehours': {\n      'title': 'Palvelupisteen aukioloajat'\n    },\n    'webpages': {\n      'title': 'Palvelupisteen verkkosivustot'\n    }\n  };\n  \n  class ServiceLocationServiceChannelDialog extends window.AbstractServiceChannelEditorDialog {\n    \n    /**\n     * Constructs service location service channel dialog\n     * \n     * @param {Object} editor TinyMCE editor instance\n     * @param {Object} serviceChannel service channel\n     */\n    constructor(editor, serviceChannel) {\n      super(editor, serviceChannel, 'kunta_api_save_service_location_service_channel');\n      \n      this.on(\"afterDialogOpen\", this.onAfterDialogOpen.bind(this));\n    }\n    \n    /**\n     * Returns main form for service channel\n     * \n     * @returns {Object} metaform\n     */\n    getServiceChannelFormViewModel() {\n      return getServiceLocationServiceChannelMetaform();\n    }\n    \n    openAdditionalDetailsEditDialog() {\n      const viewModel = getServiceLocationChannelAdditionalDetailsMetaform();\n      this.additionalDetailsToForm(this.serviceChannel).then((formValues) => {\n        const dialog = this.openMetaformDialog(this.prepareViewModel(viewModel), formValues, (newFormValues) => {\n          this.additionalDetailsFromForm(newFormValues);\n        });\n        \n        this.createLanguagesAutocomplete(dialog.find('*[data-name=\"languages\"]'), formValues.languageCodes);\n        this.createAreasAutocomplete(dialog.find('*[data-name=\"areas\"]'), formValues.areaCodes);\n      });\n      \n    }\n    \n    validate(serviceLocationServiceChannel) {\n      const addressSubtypes = [];\n      \n      for (let j = 0; j < serviceLocationServiceChannel.addresses.length; j++) {\n        const address = serviceLocationServiceChannel.addresses[j];\n        if (address.subtype === \"Abroad\" || address.subtype === \"Single\") {\n          for (let i = 0; i < addressSubtypes.length; i++) {\n            if (addressSubtypes[i] !== address.subtype) {\n              return \"Toimipisteellä ei voi olla yhtäaikaa kotimaista ja ulkomaista osoitetta\"; \n            }\n          }\n        }\n        \n        addressSubtypes.push(address.subtype);\n      }\n      \n      return null;\n    }\n    \n    serviceChannelFromForm(existingLocationServiceChannel, formValues) {\n      const serviceLocationServiceChannel = JSON.parse(JSON.stringify(existingLocationServiceChannel));\n      serviceLocationServiceChannel.addresses = [];\n      serviceLocationServiceChannel.descriptions = [];\n      serviceLocationServiceChannel.emails = [];\n      serviceLocationServiceChannel.phoneNumbers = [];\n      \n      this.supportedLocales.forEach((locale) => {\n        const localeValues = formValues[locale];\n        \n        const localeAddresses = JSON.parse(localeValues.addresses).filter((address) => {\n          return !!address.street && !!address.street.trim();\n        });\n        \n        localeAddresses.forEach((localeAddress, addressIndex) => {\n          let address;\n          if (serviceLocationServiceChannel.addresses.length - 1 < addressIndex) {\n            address = {\n              additionalInformations: [],\n              streetAddress: [],\n              subtype: 'Single',\n              type: 'Location',\n              country: 'FI'\n            };\n            \n            serviceLocationServiceChannel.addresses.push(address);\n          } else {\n            address = serviceLocationServiceChannel.addresses[addressIndex];\n          }\n          \n          if (localeAddress.additionalInformation) {\n            localeAddress.additionalInformation = localeAddress.additionalInformation.trim();\n          }\n          \n          if (localeAddress.additionalInformation) {\n            address.additionalInformations.push({\n              \"language\": locale,\n              \"value\": localeAddress.additionalInformation\n            });\n          }\n        \n          address.streetAddress.push({\n            \"language\": locale,\n            \"value\": localeAddress.street\n          });\n          \n          address.postalCode = localeAddress.postOfficeCode;\n          address.streetNumber = localeAddress.streetNumber;\n        });\n        \n        const foreignAddresses = JSON.parse(localeValues.foreignAddresses).filter((address) => {\n          return !!address.foreign;\n        });\n        \n        foreignAddresses.forEach((foreignAddress, foreignAddressIndex) => {\n          const addressIndex = localeAddresses.length + foreignAddressIndex;\n          \n          let address;\n          if (serviceLocationServiceChannel.addresses.length - 1 < addressIndex) {\n            address = {\n              subtype: 'Abroad',\n              type: 'Location',\n              locationAbroad: []\n            };            \n            serviceLocationServiceChannel.addresses.push(address);\n          } else {\n            address = serviceLocationServiceChannel.addresses[addressIndex];\n          }\n          \n          address.locationAbroad.push({\n            \"language\": locale,\n            \"value\": foreignAddress.foreign\n          });\n        });\n        \n        serviceLocationServiceChannel.emails = serviceLocationServiceChannel.emails.concat(\n          JSON.parse(localeValues.emails)\n            .filter((email) => {\n              return !!email.email;\n            })\n            .map((email) => {\n              return {\n                \"language\": locale,\n                \"value\": email.email\n              };\n            })\n        );\n\n        serviceLocationServiceChannel.phoneNumbers = serviceLocationServiceChannel.phoneNumbers.concat(\n          JSON.parse(localeValues.phoneNumbers)\n            .filter((phoneNumber) => {\n              return !!phoneNumber.prefixNumber && !!phoneNumber.number;\n            })\n            .map((phoneNumber) => {\n              return Object.assign(phoneNumber, {\n                \"type\": \"Phone\",\n                \"language\": locale,\n                \"isFinnishServiceNumber\": phoneNumber.isFinnishServiceNumber === \"true\"\n              });\n            })\n        );\n\n        serviceLocationServiceChannel.phoneNumbers = serviceLocationServiceChannel.phoneNumbers.concat(\n          JSON.parse(localeValues.faxes)\n            .filter((fax) => {\n              return !!fax.prefixNumber && !!fax.number;\n            })\n            .map((fax) => {\n              return {\n                \"type\": \"Fax\",\n                \"language\": locale,\n                \"number\": fax.number,\n                \"prefixNumber\": fax.prefixNumber,\n                \"isFinnishServiceNumber\": false\n              };\n            })\n        );\n\n        serviceLocationServiceChannel.webPages = serviceLocationServiceChannel.webPages.concat(\n          JSON.parse(localeValues.webPages)\n            .filter((webPage) => {\n              return !!webPage.url;\n            })\n            .map((webPage) => {\n              return Object.assign(webPage, {\n                \"language\": locale\n              });\n            })\n        );\n        \n        if (localeValues.description) {\n          localeValues.description = localeValues.description.trim();\n        }\n        \n        if (localeValues.description) {\n          serviceLocationServiceChannel.descriptions.push({\n            \"language\": locale,\n            \"value\": localeValues.description,\n            \"type\": \"Description\"\n          });\n        }\n        \n        if (localeValues.shortDescription) {\n          localeValues.shortDescription = localeValues.shortDescription.trim();\n        }\n      \n        if (localeValues.shortDescription) {\n          serviceLocationServiceChannel.descriptions.push({\n            \"language\": locale,\n            \"value\": localeValues.shortDescription,\n            \"type\": \"ShortDescription\"\n          });\n        }\n      });\n      \n      return serviceLocationServiceChannel;\n    }\n    \n    additionalDetailsToForm(serviceLocationServiceChannel) {\n      return this.languagesToForm(serviceLocationServiceChannel.languages)\n        .then((languageCodes) => {\n          return {\n            languageCodes: languageCodes,\n            areaCodes: this.areasToForm(serviceLocationServiceChannel.areas),\n            areaType: serviceLocationServiceChannel.areaType\n          };\n        });\n    }\n    \n    additionalDetailsFromForm(newFormValues) {\n      this.serviceChannel.areaType = newFormValues.areaType;\n      this.serviceChannel.languages = (newFormValues.languages||'').split(',');\n      this.serviceChannel.areas = this.areasFromForm(newFormValues.areaType, newFormValues.areas);\n    }\n   \n    serviceChannelToForm(locale) {\n      const name = this.getTypedLocalizedValue(this.serviceChannel.names, locale, 'Name');\n      const shortDescription = this.getTypedLocalizedValue(this.serviceChannel.descriptions, locale, 'ShortDescription');\n      const description = this.getTypedLocalizedValue(this.serviceChannel.descriptions, locale, 'Description');\n      const visitAddresses = this.serviceChannel.addresses.filter((address) => {\n        return address.subtype !== 'Abroad';\n      });\n      \n      const foreignAddresses = this.serviceChannel.addresses.filter((address) => {\n        return address.subtype === 'Abroad';\n      });\n      \n      const emails = this.serviceChannel.emails.filter((email) => {\n        return locale === email.language;\n      });\n      \n      const faxes = this.serviceChannel.phoneNumbers.filter((phoneNumber) => {\n        return phoneNumber.type === 'Fax' && locale === phoneNumber.language;\n      });\n      \n      const phoneNumbers = this.serviceChannel.phoneNumbers.filter((phoneNumber) => {\n        return phoneNumber.type === 'Phone' && locale === phoneNumber.language;\n      });\n      \n      const webPages = this.getLocalizedWebPages(this.serviceChannel.webPages, locale);\n      \n      const addresses = visitAddresses.map((address) => {\n        return {\n          street: this.getLocalizedValue(address.streetAddress, locale),\n          streetNumber: address.streetNumber,\n          postOfficeCode: address.postalCode,\n          additionalInformation: this.getLocalizedValue(address.additionalInformations, locale) \n        };\n      });\n      \n      return {\n        name: name,\n        description: description,\n        shortDescription: shortDescription,\n        addresses: addresses,\n        emails: emails.map((email) => {\n          return {\n            email: email.value\n          };\n        }),\n        phoneNumbers: phoneNumbers.map((phoneNumber) => {\n          return Object.assign(phoneNumber, {\n            isFinnishServiceNumber: phoneNumber.isFinnishServiceNumber ? 'true' : 'false'\n          });\n        }),\n        faxes: faxes,\n        foreignAddresses: foreignAddresses.map((foreignAddress) => {\n          return {\n            foreign: this.getLocalizedValue(foreignAddress.locationAbroad, locale)\n          };\n        }),\n        webPages: webPages\n      };\n    }\n    \n    /**\n     * Method invoked after dialog open\n     * \n     * @param {Object} data event data\n     */\n    onAfterDialogOpen(data) {\n      const dialog = data.dialog;\n      \n      $(dialog).on('click', '.add-service-hour', this.onAddServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-service-hour', this.onEditServiceHourClick.bind(this));\n      $(dialog).on('click', '.remove-service-hour', this.onRemoveServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-additional-details', this.onEditAdditionalDetailsClick.bind(this));\n      \n      this.redrawServiceHours();\n    }\n    \n    onAddServiceHourClick(event) {\n      this.openServiceHourEditDialog(null, (createdServiceHour) => {\n        this.serviceChannel.serviceHours.push(createdServiceHour);\n        this.redrawServiceHours();\n      });\n    }\n    \n    onEditAdditionalDetailsClick() {\n      this.openAdditionalDetailsEditDialog(this.serviceChannel);\n    }\n    \n    onEditServiceHourClick(event) {\n      const row = $(event.target).closest('tr');\n      const index = row.index();\n      const serviceHour = this.serviceChannel.serviceHours[index];\n      \n      this.openServiceHourEditDialog(serviceHour, (updatedServiceHour) => {\n        this.serviceChannel.serviceHours.splice(index, 1, updatedServiceHour);\n        this.redrawServiceHours();\n      });\n    }\n    \n    onRemoveServiceHourClick(event) {\n      const row = $(event.target).closest('tr');\n      const index = row.index();\n      this.serviceChannel.serviceHours.splice(index, 1);\n      this.redrawServiceHours();\n    }\n    \n  }\n  \n  class ServiceLocationServiceChannelEditor {\n    \n    constructor (editor) {\n      this.buttonStyle = {\n        'color': '#555',\n        'width': '100%',\n        'border': '1px solid #ccc',\n        'background': '#f7f7f7',\n        'display': 'block',\n        'padding': '5px',\n        'margin-top': '5px',\n        'margin-bottom': '5px',\n        'cursor': 'pointer'\n      };\n      \n      this.editor = editor;\n      \n      this.editor.on('BeforeSetcontent', this.onBeforeSetcontent.bind(this));\n      this.editor.on('GetContent', this.onGetContent.bind(this));\n      this.editor.on('DblClick', this.onDblClick.bind(this));\n      this.editor.addCommand('kunta-api-service-location-channel-edit', this.onServiceLocationChannelEdit.bind(this));\n    }\n    \n    parseAttributes (string) {\n      const result = [];\n      const re = /([a-zA-Z-_]*)(\\=\\\")([a-zA-Z0-9-]*)(\\\")/g;\n      let match = null;\n      \n      do {\n        match = re.exec(string);\n        if (match && match.length > 3) {\n          result.push({\n            name: match[1],\n            value: match[3] \n          });\n        }\n      } while (match);\n\n      return result;\n    }\n    \n    getComponentTitle (name) {\n      return SUPPORTED_COMPONENTS[name].title;\n    }\n    \n    replaceShortcodes(content) {\n      return content.replace(/(\\[kunta_api_location_channel_component)([a-zA-Z0-9 -=]*)(\\])/g, (all, tag, attributesText, end) => {\n        const attributes = this.parseAttributes(attributesText);\n        const placeholder = $('<input>')\n          .attr({\n           'type': 'button',\n           'data-kunta-api-placeholder': 'location_channel_component'\n          })\n          .css(this.buttonStyle);\n          \n        for (let i = 0; i < attributes.length; i++) {\n          const attribute = attributes[i];\n          placeholder.attr('data-' + attribute.name, attribute.value);\n        }\n        \n        const component = placeholder.attr('data-component');\n        if (!SUPPORTED_COMPONENTS[component]) {\n          return all;\n        }\n        \n        placeholder.attr('value', this.getComponentTitle(component));\n        return $('<div>').append(placeholder).html();\n      });\n      \n    }\n    \n    restoreShortcodes(content) {\n      return content.replace(/<input [^>]+>/g, (match) => {\n        const input = $(match);\n        \n        if (input.attr('data-kunta-api-placeholder') === 'location_channel_component') {\n          const shortcodeAttributes = [];\n          const attributeNames = ['channel-id', 'component'];\n          \n          for (let i = 0; i < attributeNames.length; i++) {\n            const attributeName = attributeNames[i];\n            const attributeValue = input.attr('data-' + attributeName);\n            shortcodeAttributes.push([attributeName, '\"' + attributeValue + '\"'].join('='));\n          }\n          \n          return '[kunta_api_location_channel_component ' + shortcodeAttributes.join(' ') + ']';\n        }\n        \n        return match;\n      });\n    }\n    \n    openElementEditor(element) {\n      const placeholderAttr = element.attributes['data-kunta-api-placeholder'];\n      if (placeholderAttr && placeholderAttr.value === 'location_channel_component') {\n        const serviceLocationServiceChannelId = element.attributes['data-channel-id'].value;\n        this.editor.execCommand('kunta-api-service-location-channel-edit', '', {\n          serviceLocationServiceChannelId: serviceLocationServiceChannelId\n        });\n      }\n    }\n    \n    findServiceLocationServiceChannel(id, callback) {\n      $.post(ajaxurl, {\n        'action': 'kunta_api_load_service_location_service_channel',\n        'id': id\n      }, (response) => {\n        callback(null, JSON.parse(response));\n      })\n      .fail((response) => {\n        callback(response.responseText || response.statusText);\n      });\n    }\n      \n    onBeforeSetcontent(event) {\n      event.content = this.replaceShortcodes(event.content);\n    }\n    \n    onGetContent(event) {\n      event.content = this.restoreShortcodes(event.content);\n    }\n    \n    onDblClick(event) {\n      const element = event.target;\n      this.openElementEditor(element);\n    }\n\n    onServiceLocationChannelEdit(ui, options) {\n      this.findServiceLocationServiceChannel(options.serviceLocationServiceChannelId, (err, serviceLocationServiceChannel) => {\n        if (err) {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        } else {\n          const dialog = new ServiceLocationServiceChannelDialog(this.editor, serviceLocationServiceChannel);\n          dialog.open();\n        }\n      });\n    } \n    \n  }\n  \n  class ServiceLocationServiceChannelEmbed {\n    \n    constructor (editor) {\n      this.editor = editor;\n      this.displayLocale = 'fi';\n      this.searching = false;\n      this.pending = false;\n      this.addButton();\n    }\n    \n    addButton () {\n      this.editor.addButton('kunta_api_service_location_embed', {\n        title: 'Search Kunta API service location channels',\n        onclick: () => {\n          this.editor.windowManager.open({\n            title: 'Search Kunta API service location channels',\n            width: 768,\n            height: 500,\n            body: [\n              { type: 'textbox', name: 'kunta-api-service-query', label: 'Query', onKeyUp: (e) => {     \n                if (!this.searching) {\n                  this.searching = true;\n                  this.searchServiceLocationChannels(e.target.value, (response) => {\n                    this.searching = false;\n                    if (this.pending) {\n                      this.searchServiceLocationChannels(e.target.value, (innerResponse) => {\n                        this.handleResponse(innerResponse);\n                      });\n                    } else {\n                      this.handleResponse(response);\n                    }\n                  });\n                } else {\n                  this.pending = true;\n                }\n              }},\n              {type: 'label', classes: 'kunta-api-search-info', text: \"Kirjoita hakusana yllä olevaan hakukenttään\"},\n              {type: 'container', classes: 'kunta-api-search-results', minHeight: 400}\n            ],\n            onsubmit: (e) => {\n              let responseHtml = '';\n              let allEmbedsFromSameChannel = true;              \n              const componentsToEmbed = $('.service-component-embed-input:checked');\n              const firstServiceLocationChannelId = componentsToEmbed.first().attr('data-service-location-channel-id');\n              const serviceLocationChannelName = componentsToEmbed.first().attr('data-service-location-channel-name');\n              \n              componentsToEmbed.each(function () {\n                var component = $(this).attr('data-component-type');\n                var serviceLocationChannelId = $(this).attr('data-service-location-channel-id');\n                responseHtml += '[kunta_api_location_channel_component channel-id=\"'+ serviceLocationChannelId +'\" component=\"'+ component +'\"]';\n                if (serviceLocationChannelId !== firstServiceLocationChannelId) {\n                  allEmbedsFromSameChannel = false;\n                }\n              });\n\n              if (allEmbedsFromSameChannel) {\n                this.editor.windowManager.confirm(\"Merkitäänkö sivu palvelukanavan: \"+ serviceLocationChannelName + \" sivuksi?\", function(confirmed) {\n                  if (confirmed) {\n                    const pageId = $('#post_ID').val();\n                    this.markAsServiceLocationPage(firstServiceLocationChannelId, pageId);\n                  }\n                });\n              }\n\n              this.editor.insertContent(responseHtml);\n            }\n          });\n        }\n      });\n    }\n    \n    markAsServiceLocationPage(serviceLocationChannelId, pageId) {\n      $.post( ajaxurl, {\n        'action': 'kunta_api_mark_page_as_location_page',\n        'pageId': pageId,\n        'locationChannelId': serviceLocationChannelId\n      }, (response) => {\n      });\n    }\n    \n    searchServiceLocationChannels(query, callback) {\n      $('.mce-kunta-api-search-results').empty();\n      $('.mce-kunta-api-search-results').append($('<div>').addClass('mce-kunta-api-search-results-loader'));\n      $('.mce-kunta-api-search-info').text('Ladataan...');\n      $.post(ajaxurl, {\n        'action': 'kunta_api_search_service_location_channels',\n        'data': query\n      }, (response) => {\n        $('.mce-kunta-api-search-results-loader').remove();\n        callback(JSON.parse(response));\n      });\n    }\n    \n    getLocalizedValueAndType(values, locale, type) {\n      for (let i = 0; i < values.length; i++) {\n        if (locale === values[i].language && type === values[i].type) {\n          return values[i].value;\n        }\n      }\n      \n      return null;\n    }\n    \n    appendResult(result) {\n      const resultContainer = $('<div>').addClass('mce-kunta-api-search-result-row');\n      const name = this.getLocalizedValueAndType(result.names, this.displayLocale, 'Name');\n\n      resultContainer.append(\n        $('<p>')\n          .addClass('mce-kunta-api-search-result-title')\n          .text(name)\n      );\n      \n      Object.keys(SUPPORTED_COMPONENTS).forEach((component) => {\n        const options = SUPPORTED_COMPONENTS[component]; \n        resultContainer.append(\n          $('<p>')\n            .append($('<input>')\n            .addClass('service-component-embed-input')\n            .attr({\n              'type':'checkbox',\n              'data-service-location-channel-name': name,\n              'data-component-type': component,\n              'data-service-location-channel-id': result.id\n            }))\n            .append($('<span>').text(options.title))\n        );\n      });\n      \n      $('.mce-kunta-api-search-results').append(resultContainer);\n    }\n    \n    handleResponse(response) {\n      $('.mce-kunta-api-search-results').empty();\n\n      if (response.length === 0) {\n        $('.mce-kunta-api-search-info').text('Hakusanalla ei löytynyt yhtään palvelua');\n      } else {\n        $('.mce-kunta-api-search-info').text('Kirjoita hakusana yllä olevaan hakukenttään');\n      }\n\n      for (let i = 0; i < response.length; i++) {\n        this.appendResult(response[i]);\n      }\n\n    }\n    \n  }\n  \n  tinymce.PluginManager.add('kunta_api_service_location_embed', (editor, url) => {\n    new ServiceLocationServiceChannelEmbed(editor);\n    new ServiceLocationServiceChannelEditor(editor);\n  });\n  \n  window.ServiceLocationServiceChannelDialog = ServiceLocationServiceChannelDialog;\n  \n})(tinymce, jQuery);"]}
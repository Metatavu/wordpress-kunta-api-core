{"version":3,"sources":["../src/kunta-api-service-location-channel-embed/js/plugin.js"],"names":["tinymce","$","SUPPORTED_COMPONENTS","ServiceLocationServiceChannelDialog","editor","serviceChannel","on","onAfterDialogOpen","bind","getServiceLocationServiceChannelMetaform","viewModel","getServiceLocationChannelAdditionalDetailsMetaform","additionalDetailsToForm","then","formValues","dialog","openMetaformDialog","prepareViewModel","newFormValues","additionalDetailsFromForm","createLanguagesAutocomplete","find","languageCodes","createAreasAutocomplete","areaCodes","serviceLocationServiceChannel","addressSubtypes","j","addresses","length","address","subtype","i","push","existingLocationServiceChannel","result","JSON","parse","stringify","descriptions","emails","phoneNumbers","webPages","supportedLocales","forEach","locale","localeValues","setTypedLocalizedValue","localeAddresses","filter","street","trim","localeAddress","addressIndex","additionalInformations","streetAddress","type","country","additionalInformation","postalCode","postOfficeCode","streetNumber","foreignAddresses","foreign","foreignAddress","foreignAddressIndex","locationAbroad","setLocalizedTableValues","email","value","phoneNumber","prefixNumber","number","Object","assign","isFinnishServiceNumber","concat","webPage","url","map","languagesToForm","languages","areasToForm","areas","areaType","split","areasFromForm","name","getTypedLocalizedValue","names","shortDescription","description","visitAddresses","getLocalizedValue","getLocalizedEmails","getLocalizedPhoneNumbers","faxes","getLocalizedWebPages","data","onAddServiceHourClick","onEditServiceHourClick","onRemoveServiceHourClick","onEditAdditionalDetailsClick","redrawServiceHours","event","openServiceHourEditDialog","createdServiceHour","serviceHours","openAdditionalDetailsEditDialog","row","target","closest","index","serviceHour","updatedServiceHour","splice","window","AbstractServiceChannelEditorDialog","ServiceLocationServiceChannelEditor","buttonStyle","onBeforeSetcontent","onGetContent","onDblClick","addCommand","onServiceLocationChannelEdit","string","re","match","exec","title","content","replace","all","tag","attributesText","end","attributes","parseAttributes","placeholder","attr","css","attribute","component","getComponentTitle","append","html","input","shortcodeAttributes","attributeNames","attributeName","attributeValue","join","element","placeholderAttr","serviceLocationServiceChannelId","execCommand","id","callback","post","ajaxurl","response","fail","responseText","statusText","replaceShortcodes","restoreShortcodes","openElementEditor","ui","options","overlay","addClass","appendTo","findServiceLocationServiceChannel","err","tinyMCE","activeEditor","windowManager","alert","remove","open","ServiceLocationServiceChannelEmbed","displayLocale","searching","pending","addButton","onclick","width","height","body","label","onKeyUp","e","searchServiceLocationChannels","innerResponse","handleResponse","classes","text","minHeight","onsubmit","responseHtml","allEmbedsFromSameChannel","componentsToEmbed","firstServiceLocationChannelId","first","serviceLocationChannelName","each","serviceLocationChannelId","confirm","confirmed","pageId","val","markAsServiceLocationPage","insertContent","query","empty","values","language","resultContainer","getLocalizedValueAndType","keys","appendResult","PluginManager","add","jQuery"],"mappings":"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","file":"plugin.js","sourcesContent":["/* jshint esversion: 6 */\n/* global ajaxurl, tinymce, moment, Promise */\n((tinymce, $) => {\n  \n  const SUPPORTED_COMPONENTS = {\n    'name': {\n      'title': 'Palvelupisteen nimi'\n    },\n    'description': {\n      'title': 'Palvelupisteen kuvaus'\n    },\n    'email': {\n      'title': 'Palvelupisteen sähköpostiosoitteet'\n    },\n    'addresses': {\n      'title': 'Palvelupisteen osoitetiedot'\n    },\n    'fax': {\n      'title': 'Palvelupisteen faksi'\n    },\n    'phone': {\n      'title': 'Palvelupisteen puhelinnumerot'\n    },\n    'servicehours': {\n      'title': 'Palvelupisteen aukioloajat'\n    },\n    'webpages': {\n      'title': 'Palvelupisteen verkkosivustot'\n    }\n  };\n  \n  class ServiceLocationServiceChannelDialog extends window.AbstractServiceChannelEditorDialog {\n    \n    /**\n     * Constructs service location service channel dialog\n     * \n     * @param {Object} editor TinyMCE editor instance\n     * @param {Object} serviceChannel service channel\n     */\n    constructor(editor, serviceChannel) {\n      super(editor, serviceChannel, 'kunta_api_save_service_location_service_channel');\n      \n      this.on(\"afterDialogOpen\", this.onAfterDialogOpen.bind(this));\n    }\n    \n    /**\n     * Returns main form for service channel\n     * \n     * @returns {Object} metaform\n     */\n    getServiceChannelFormViewModel() {\n      return getServiceLocationServiceChannelMetaform();\n    }\n    \n    openAdditionalDetailsEditDialog() {\n      const viewModel = getServiceLocationChannelAdditionalDetailsMetaform();\n      this.additionalDetailsToForm(this.serviceChannel).then((formValues) => {\n        const dialog = this.openMetaformDialog(this.prepareViewModel(viewModel), formValues, (newFormValues) => {\n          this.additionalDetailsFromForm(newFormValues);\n        });\n        \n        this.createLanguagesAutocomplete(dialog.find('*[data-name=\"languages\"]'), formValues.languageCodes);\n        this.createAreasAutocomplete(dialog.find('*[data-name=\"areas\"]'), formValues.areaCodes);\n      });\n      \n    }\n    \n    validate(serviceLocationServiceChannel) {\n      const addressSubtypes = [];\n      \n      for (let j = 0; j < serviceLocationServiceChannel.addresses.length; j++) {\n        const address = serviceLocationServiceChannel.addresses[j];\n        if (address.subtype === \"Abroad\" || address.subtype === \"Single\") {\n          for (let i = 0; i < addressSubtypes.length; i++) {\n            if (addressSubtypes[i] !== address.subtype) {\n              return \"Toimipisteellä ei voi olla yhtäaikaa kotimaista ja ulkomaista osoitetta\"; \n            }\n          }\n        }\n        \n        addressSubtypes.push(address.subtype);\n      }\n      \n      return null;\n    }\n    \n    serviceChannelFromForm(existingLocationServiceChannel, formValues) {\n      const result = JSON.parse(JSON.stringify(existingLocationServiceChannel));\n      result.addresses = [];\n      result.descriptions = [];\n      result.emails = [];\n      result.phoneNumbers = [];\n      result.webPages = [];\n      \n      this.supportedLocales.forEach((locale) => {\n        const localeValues = formValues[locale];\n\n        this.setTypedLocalizedValue(result, 'names', localeValues, 'name', locale, 'Name');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'shortDescription', locale, 'Summary');\n        this.setTypedLocalizedValue(result, 'descriptions', localeValues, 'description', locale, 'Description');\n        \n        const localeAddresses = JSON.parse(localeValues.addresses).filter((address) => {\n          return !!address.street && !!address.street.trim();\n        });\n        \n        localeAddresses.forEach((localeAddress, addressIndex) => {\n          let address;\n          if (result.addresses.length - 1 < addressIndex) {\n            address = {\n              additionalInformations: [],\n              streetAddress: [],\n              subtype: 'Single',\n              type: 'Location',\n              country: 'FI'\n            };\n            \n            result.addresses.push(address);\n          } else {\n            address = result.addresses[addressIndex];\n          }\n          \n          if (localeAddress.additionalInformation) {\n            localeAddress.additionalInformation = localeAddress.additionalInformation.trim();\n          }\n          \n          if (localeAddress.additionalInformation) {\n            address.additionalInformations.push({\n              \"language\": locale,\n              \"value\": localeAddress.additionalInformation\n            });\n          }\n        \n          address.streetAddress.push({\n            \"language\": locale,\n            \"value\": localeAddress.street\n          });\n          \n          address.postalCode = localeAddress.postOfficeCode;\n          address.streetNumber = localeAddress.streetNumber;\n        });\n        \n        const foreignAddresses = JSON.parse(localeValues.foreignAddresses).filter((address) => {\n          return !!address.foreign;\n        });\n        \n        foreignAddresses.forEach((foreignAddress, foreignAddressIndex) => {\n          const addressIndex = localeAddresses.length + foreignAddressIndex;\n          \n          let address;\n          if (result.addresses.length - 1 < addressIndex) {\n            address = {\n              subtype: 'Abroad',\n              type: 'Location',\n              locationAbroad: []\n            };            \n            result.addresses.push(address);\n          } else {\n            address = result.addresses[addressIndex];\n          }\n          \n          address.locationAbroad.push({\n            \"language\": locale,\n            \"value\": foreignAddress.foreign\n          });\n        });\n        \n        this.setLocalizedTableValues(result, 'emails', localeValues, 'emails', locale, (email) => {\n          return !!email.value;\n        });\n        \n        this.setLocalizedTableValues(result, 'phoneNumbers', localeValues, 'phoneNumbers', locale, \n          (phoneNumber) => {\n            return phoneNumber.prefixNumber || phoneNumber.number;\n          }, \n          (phoneNumber) => {\n            return Object.assign(phoneNumber, {\n              \"type\": \"Phone\",\n              \"language\": locale,\n              \"isFinnishServiceNumber\": phoneNumber.isFinnishServiceNumber === \"true\"\n            });\n          });\n\n        this.setLocalizedTableValues(result, 'phoneNumbers', localeValues, 'faxes', locale, \n          (phoneNumber) => {\n            return phoneNumber.prefixNumber || phoneNumber.number;\n          }, \n          (phoneNumber) => {\n            return Object.assign(phoneNumber, {\n              \"type\": \"Fax\",\n              \"language\": locale,\n              \"number\": phoneNumber.number,\n              \"prefixNumber\": phoneNumber.prefixNumber,\n              \"isFinnishServiceNumber\": false\n            });\n          });\n\n        result.webPages = result.webPages.concat(\n          JSON.parse(localeValues.webPages)\n            .filter((webPage) => {\n              return !!webPage.url;\n            })\n            .map((webPage) => {\n              return Object.assign(webPage, {\n                \"language\": locale\n              });\n            }) \n        );\n      });\n\n      return result;\n    }\n\n\n    \n    additionalDetailsToForm(serviceLocationServiceChannel) {\n      return this.languagesToForm(serviceLocationServiceChannel.languages)\n        .then((languageCodes) => {\n          return {\n            languageCodes: languageCodes,\n            areaCodes: this.areasToForm(serviceLocationServiceChannel.areas),\n            areaType: serviceLocationServiceChannel.areaType\n          };\n        });\n    }\n    \n    additionalDetailsFromForm(newFormValues) {\n      this.serviceChannel.areaType = newFormValues.areaType;\n      this.serviceChannel.languages = (newFormValues.languages||'').split(',');\n      this.serviceChannel.areas = this.areasFromForm(newFormValues.areaType, newFormValues.areas);\n    }\n   \n    serviceChannelToForm(locale) {\n      const name = this.getTypedLocalizedValue(this.serviceChannel.names, locale, 'Name');\n      const shortDescription = this.getTypedLocalizedValue(this.serviceChannel.descriptions, locale, 'Summary');\n      const description = this.getTypedLocalizedValue(this.serviceChannel.descriptions, locale, 'Description');\n      const visitAddresses = this.serviceChannel.addresses.filter((address) => {\n        return address.subtype !== 'Abroad';\n      });\n      \n      const foreignAddresses = this.serviceChannel.addresses.filter((address) => {\n        return address.subtype === 'Abroad';\n      });\n      \n      const addresses = visitAddresses.map((address) => {\n        return {\n          street: this.getLocalizedValue(address.streetAddress, locale),\n          streetNumber: address.streetNumber,\n          postOfficeCode: address.postalCode,\n          additionalInformation: this.getLocalizedValue(address.additionalInformations, locale) \n        };\n      });\n\n      return {\n        name: name,\n        description: description,\n        shortDescription: shortDescription,\n        addresses: addresses,\n        emails: this.getLocalizedEmails(this.serviceChannel.emails, locale),\n        phoneNumbers: this.getLocalizedPhoneNumbers(this.serviceChannel.phoneNumbers, locale, \"Phone\"),\n        faxes: this.getLocalizedPhoneNumbers(this.serviceChannel.phoneNumbers, locale, \"Fax\"),\n        foreignAddresses: foreignAddresses.map((foreignAddress) => {\n          return {\n            foreign: this.getLocalizedValue(foreignAddress.locationAbroad, locale)\n          };\n        }),\n        webPages: this.getLocalizedWebPages(this.serviceChannel.webPages, locale)\n      };\n    }\n    \n    /**\n     * Method invoked after dialog open\n     * \n     * @param {Object} data event data\n     */\n    onAfterDialogOpen(data) {\n      const dialog = data.dialog;\n      \n      $(dialog).on('click', '.add-service-hour', this.onAddServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-service-hour', this.onEditServiceHourClick.bind(this));\n      $(dialog).on('click', '.remove-service-hour', this.onRemoveServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-additional-details', this.onEditAdditionalDetailsClick.bind(this));\n      \n      this.redrawServiceHours();\n    }\n    \n    onAddServiceHourClick(event) {\n      this.openServiceHourEditDialog(null, (createdServiceHour) => {\n        this.serviceChannel.serviceHours.push(createdServiceHour);\n        this.redrawServiceHours();\n      });\n    }\n    \n    onEditAdditionalDetailsClick() {\n      this.openAdditionalDetailsEditDialog(this.serviceChannel);\n    }\n    \n    onEditServiceHourClick(event) {\n      const row = $(event.target).closest('tr');\n      const index = row.index();\n      const serviceHour = this.serviceChannel.serviceHours[index];\n      \n      this.openServiceHourEditDialog(serviceHour, (updatedServiceHour) => {\n        this.serviceChannel.serviceHours.splice(index, 1, updatedServiceHour);\n        this.redrawServiceHours();\n      });\n    }\n    \n    onRemoveServiceHourClick(event) {\n      const row = $(event.target).closest('tr');\n      const index = row.index();\n      this.serviceChannel.serviceHours.splice(index, 1);\n      this.redrawServiceHours();\n    }\n    \n  }\n  \n  class ServiceLocationServiceChannelEditor {\n    \n    constructor (editor) {\n      this.buttonStyle = {\n        'color': '#555',\n        'width': '100%',\n        'border': '1px solid #ccc',\n        'background': '#f7f7f7',\n        'display': 'block',\n        'padding': '5px',\n        'margin-top': '5px',\n        'margin-bottom': '5px',\n        'cursor': 'pointer'\n      };\n      \n      this.editor = editor;\n      \n      this.editor.on('BeforeSetcontent', this.onBeforeSetcontent.bind(this));\n      this.editor.on('GetContent', this.onGetContent.bind(this));\n      this.editor.on('DblClick', this.onDblClick.bind(this));\n      this.editor.addCommand('kunta-api-service-location-channel-edit', this.onServiceLocationChannelEdit.bind(this));\n    }\n    \n    parseAttributes (string) {\n      const result = [];\n      const re = /([a-zA-Z-_]*)(\\=\\\")([a-zA-Z0-9-]*)(\\\")/g;\n      let match = null;\n      \n      do {\n        match = re.exec(string);\n        if (match && match.length > 3) {\n          result.push({\n            name: match[1],\n            value: match[3] \n          });\n        }\n      } while (match);\n\n      return result;\n    }\n    \n    getComponentTitle (name) {\n      return SUPPORTED_COMPONENTS[name].title;\n    }\n    \n    replaceShortcodes(content) {\n      return content.replace(/(\\[kunta_api_location_channel_component)([a-zA-Z0-9 -=]*)(\\])/g, (all, tag, attributesText, end) => {\n        const attributes = this.parseAttributes(attributesText);\n        const placeholder = $('<input>')\n          .attr({\n           'type': 'button',\n           'data-kunta-api-placeholder': 'location_channel_component'\n          })\n          .css(this.buttonStyle);\n          \n        for (let i = 0; i < attributes.length; i++) {\n          const attribute = attributes[i];\n          placeholder.attr('data-' + attribute.name, attribute.value);\n        }\n        \n        const component = placeholder.attr('data-component');\n        if (!SUPPORTED_COMPONENTS[component]) {\n          return all;\n        }\n        \n        placeholder.attr('value', this.getComponentTitle(component));\n        return $('<div>').append(placeholder).html();\n      });\n      \n    }\n    \n    restoreShortcodes(content) {\n      return content.replace(/<input [^>]+>/g, (match) => {\n        const input = $(match);\n        \n        if (input.attr('data-kunta-api-placeholder') === 'location_channel_component') {\n          const shortcodeAttributes = [];\n          const attributeNames = ['channel-id', 'component'];\n          \n          for (let i = 0; i < attributeNames.length; i++) {\n            const attributeName = attributeNames[i];\n            const attributeValue = input.attr('data-' + attributeName);\n            shortcodeAttributes.push([attributeName, '\"' + attributeValue + '\"'].join('='));\n          }\n          \n          return '[kunta_api_location_channel_component ' + shortcodeAttributes.join(' ') + ']';\n        }\n        \n        return match;\n      });\n    }\n    \n    openElementEditor(element) {\n      const placeholderAttr = element.attributes['data-kunta-api-placeholder'];\n      if (placeholderAttr && placeholderAttr.value === 'location_channel_component') {\n        const serviceLocationServiceChannelId = element.attributes['data-channel-id'].value;\n        this.editor.execCommand('kunta-api-service-location-channel-edit', '', {\n          serviceLocationServiceChannelId: serviceLocationServiceChannelId\n        });\n      }\n    }\n    \n    findServiceLocationServiceChannel(id, callback) {\n      $.post(ajaxurl, {\n        'action': 'kunta_api_load_service_location_service_channel',\n        'id': id\n      }, (response) => {\n        callback(null, JSON.parse(response));\n      })\n      .fail((response) => {\n        callback(response.responseText || response.statusText);\n      });\n    }\n      \n    onBeforeSetcontent(event) {\n      event.content = this.replaceShortcodes(event.content);\n    }\n    \n    onGetContent(event) {\n      event.content = this.restoreShortcodes(event.content);\n    }\n    \n    onDblClick(event) {\n      const element = event.target;\n      this.openElementEditor(element);\n    }\n\n    onServiceLocationChannelEdit(ui, options) {\n      const overlay = $('<div>')\n        .addClass('ui-widget-overlay')\n        .css('z-index', 99999)\n        .appendTo($('body'));\n\n      this.findServiceLocationServiceChannel(options.serviceLocationServiceChannelId, (err, serviceLocationServiceChannel) => {\n        if (err) {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        } else {\n          const dialog = new ServiceLocationServiceChannelDialog(this.editor, serviceLocationServiceChannel);\n          overlay.remove();\n          dialog.open();\n        }\n      });\n    } \n    \n  }\n  \n  class ServiceLocationServiceChannelEmbed {\n    \n    constructor (editor) {\n      this.editor = editor;\n      this.displayLocale = 'fi';\n      this.searching = false;\n      this.pending = false;\n      this.addButton();\n    }\n    \n    addButton () {\n      this.editor.addButton('kunta_api_service_location_embed', {\n        title: 'Search Kunta API service location channels',\n        onclick: () => {\n          this.editor.windowManager.open({\n            title: 'Search Kunta API service location channels',\n            width: 768,\n            height: 500,\n            body: [\n              { type: 'textbox', name: 'kunta-api-service-query', label: 'Query', onKeyUp: (e) => {     \n                if (!this.searching) {\n                  this.searching = true;\n                  this.searchServiceLocationChannels(e.target.value, (response) => {\n                    this.searching = false;\n                    if (this.pending) {\n                      this.searchServiceLocationChannels(e.target.value, (innerResponse) => {\n                        this.handleResponse(innerResponse);\n                      });\n                    } else {\n                      this.handleResponse(response);\n                    }\n                  });\n                } else {\n                  this.pending = true;\n                }\n              }},\n              {type: 'label', classes: 'kunta-api-search-info', text: \"Kirjoita hakusana yllä olevaan hakukenttään\"},\n              {type: 'container', classes: 'kunta-api-search-results', minHeight: 400}\n            ],\n            onsubmit: (e) => {\n              let responseHtml = '';\n              let allEmbedsFromSameChannel = true;              \n              const componentsToEmbed = $('.service-component-embed-input:checked');\n              const firstServiceLocationChannelId = componentsToEmbed.first().attr('data-service-location-channel-id');\n              const serviceLocationChannelName = componentsToEmbed.first().attr('data-service-location-channel-name');\n              \n              componentsToEmbed.each(function () {\n                var component = $(this).attr('data-component-type');\n                var serviceLocationChannelId = $(this).attr('data-service-location-channel-id');\n                responseHtml += '[kunta_api_location_channel_component channel-id=\"'+ serviceLocationChannelId +'\" component=\"'+ component +'\"]';\n                if (serviceLocationChannelId !== firstServiceLocationChannelId) {\n                  allEmbedsFromSameChannel = false;\n                }\n              });\n\n              if (allEmbedsFromSameChannel) {\n                this.editor.windowManager.confirm(\"Merkitäänkö sivu palvelukanavan: \"+ serviceLocationChannelName + \" sivuksi?\", function(confirmed) {\n                  if (confirmed) {\n                    const pageId = $('#post_ID').val();\n                    this.markAsServiceLocationPage(firstServiceLocationChannelId, pageId);\n                  }\n                });\n              }\n\n              this.editor.insertContent(responseHtml);\n            }\n          });\n        }\n      });\n    }\n    \n    markAsServiceLocationPage(serviceLocationChannelId, pageId) {\n      $.post( ajaxurl, {\n        'action': 'kunta_api_mark_page_as_location_page',\n        'pageId': pageId,\n        'locationChannelId': serviceLocationChannelId\n      }, (response) => {\n      });\n    }\n    \n    searchServiceLocationChannels(query, callback) {\n      $('.mce-kunta-api-search-results').empty();\n      $('.mce-kunta-api-search-results').append($('<div>').addClass('mce-kunta-api-search-results-loader'));\n      $('.mce-kunta-api-search-info').text('Ladataan...');\n      $.post(ajaxurl, {\n        'action': 'kunta_api_search_service_location_channels',\n        'data': query\n      }, (response) => {\n        $('.mce-kunta-api-search-results-loader').remove();\n        callback(JSON.parse(response));\n      });\n    }\n    \n    getLocalizedValueAndType(values, locale, type) {\n      for (let i = 0; i < values.length; i++) {\n        if (locale === values[i].language && type === values[i].type) {\n          return values[i].value;\n        }\n      }\n      \n      return null;\n    }\n    \n    appendResult(result) {\n      const resultContainer = $('<div>').addClass('mce-kunta-api-search-result-row');\n      const name = this.getLocalizedValueAndType(result.names, this.displayLocale, 'Name');\n\n      resultContainer.append(\n        $('<p>')\n          .addClass('mce-kunta-api-search-result-title')\n          .text(name)\n      );\n      \n      Object.keys(SUPPORTED_COMPONENTS).forEach((component) => {\n        const options = SUPPORTED_COMPONENTS[component]; \n        resultContainer.append(\n          $('<p>')\n            .append($('<input>')\n            .addClass('service-component-embed-input')\n            .attr({\n              'type':'checkbox',\n              'data-service-location-channel-name': name,\n              'data-component-type': component,\n              'data-service-location-channel-id': result.id\n            }))\n            .append($('<span>').text(options.title))\n        );\n      });\n      \n      $('.mce-kunta-api-search-results').append(resultContainer);\n    }\n    \n    handleResponse(response) {\n      $('.mce-kunta-api-search-results').empty();\n\n      if (response.length === 0) {\n        $('.mce-kunta-api-search-info').text('Hakusanalla ei löytynyt yhtään palvelua');\n      } else {\n        $('.mce-kunta-api-search-info').text('Kirjoita hakusana yllä olevaan hakukenttään');\n      }\n\n      for (let i = 0; i < response.length; i++) {\n        this.appendResult(response[i]);\n      }\n\n    }\n    \n  }\n  \n  tinymce.PluginManager.add('kunta_api_service_location_embed', (editor, url) => {\n    new ServiceLocationServiceChannelEmbed(editor);\n    new ServiceLocationServiceChannelEditor(editor);\n  });\n  \n  window.ServiceLocationServiceChannelDialog = ServiceLocationServiceChannelDialog;\n  \n})(tinymce, jQuery);"]}
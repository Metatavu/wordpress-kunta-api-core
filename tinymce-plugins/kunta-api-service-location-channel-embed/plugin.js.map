{"version":3,"sources":["../src/kunta-api-service-location-channel-embed/js/plugin.js"],"names":["tinymce","$","SUPPORTED_COMPONENTS","ServiceLocationServiceChannelDialog","editor","serviceLocationServiceChannel","supportedLocales","localeNames","serviceHourTypeNames","dayNames","listeners","locale","type","index","short","name","substring","serviceHour","getServiceHourTypeName","serviceHourType","result","isClosed","openingHour","length","openFrom","from","openTo","to","validFrom","validTo","formatDateWithTime","formatDateWithTimes","additionalInformation","getAnyLocalizedValue","openingHours","map","formatOpeningHour","join","dateTime","moment","format","date","time","formatDate","startTime","endTime","start","dailyOpeningTime","dayFrom","getDayName","dayTo","callback","post","ajaxurl","JSON","stringify","response","fail","responseText","statusText","viewModel","formValues","dialog","attr","title","dialogContents","addClass","html","mfRender","appendTo","modal","draggable","width","window","height","buttons","text","click","find","metaform","forEach","value","dialogTabs","tabId","append","getLocaleName","tabs","getServiceLocationServiceChannelMetaform","serviceLocationServiceChannelToForm","openLocalizedMetaformDialog","newFormValues","updatedChannel","translateServiceLocationServiceChannelFromForm","validationError","validate","showError","saveServiceLocationServiceChannel","err","removeClass","on","_onAddServiceHourClick","bind","_onEditServiceHourClick","_onRemoveServiceHourClick","_onEditAdditionalDetailsClick","redrawServiceHours","getServiceHourMetaform","serviceHourToForm","openMetaformDialog","prepareViewModel","updatedServiceHour","serviceHourFromForm","types","search","Promise","resolve","reject","codes","parse","getAdditionalDetailsMetaform","additionalDetailsToForm","then","additionalDetailsFromForm","metaformMultivalueAutocomplete","languageCodes","input","searchCodes","term","codeItem","code","label","getLocalizedValue","names","catch","console","error","areaCodes","areaCode","getCodeNameWithType","getCodeTypeName","municipality","contents","Ok","addressSubtypes","j","addresses","address","subtype","i","push","serviceHourTexts","serviceHours","formatServiceHour","empty","serviceHourText","row","values","language","sections","section","fields","field","localeVariableIndex","indexOf","splice","Object","assign","replace","validForNow","toTime","fromTime","isExtra","parseIsoDate","parseInt","day","serviceHourFromFormException","serviceHourFromFormStandard","serviceHourFromFormSpecial","existingLocationServiceChannel","descriptions","emails","phoneNumbers","localeValues","localeAddresses","filter","street","trim","localeAddress","addressIndex","additionalInformations","streetAddress","country","postalCode","postOfficeCode","streetNumber","foreignAddresses","foreign","foreignAddress","foreignAddressIndex","locationAbroad","concat","email","phoneNumber","prefixNumber","number","isFinnishServiceNumber","faxes","fax","webPages","webPage","url","description","shortDescription","open24h","validFromStr","validToStr","exceptionType","parts","split","hour","minute","Error","languageQuery","languages","languageQueryResult","languageMap","queryResult","areas","area","municipalities","getMunicipalityNameWithType","areaType","mucicipalitiesIndex","getTypedLocalizedValue","visitAddresses","string","Date","event","data","listener","callable","openServiceHourEditDialog","createdServiceHour","openAdditionalDetailsEditDialog","target","closest","ServiceLocationServiceChannelEditor","buttonStyle","onBeforeSetcontent","onGetContent","onDblClick","addCommand","onServiceLocationChannelEdit","re","match","exec","content","all","tag","attributesText","end","attributes","parseAttributes","placeholder","css","attribute","component","getComponentTitle","shortcodeAttributes","attributeNames","attributeName","attributeValue","element","placeholderAttr","serviceLocationServiceChannelId","execCommand","id","replaceShortcodes","restoreShortcodes","openElementEditor","ui","options","findServiceLocationServiceChannel","tinyMCE","activeEditor","windowManager","alert","open","ServiceLocationServiceChannelEmbed","displayLocale","searching","pending","addButton","onclick","body","onKeyUp","e","searchServiceLocationChannels","innerResponse","handleResponse","classes","minHeight","onsubmit","responseHtml","allEmbedsFromSameChannel","componentsToEmbed","firstServiceLocationChannelId","first","serviceLocationChannelName","each","serviceLocationChannelId","confirm","confirmed","pageId","val","markAsServiceLocationPage","insertContent","query","remove","resultContainer","getLocalizedValueAndType","keys","appendResult","PluginManager","add","jQuery"],"mappings":"wpBAAA,8CACA,CAAC,SAACA,OAAD,CAAUC,CAAV,CAAgB,CAEf,GAAMC,sBAAuB,CAC3B,OAAQ,CACN,QAAS,qBADH,CADmB,CAI3B,cAAe,CACb,QAAS,uBADI,CAJY,CAO3B,QAAS,CACP,QAAS,0CADF,CAPkB,CAU3B,YAAa,CACX,QAAS,6BADE,CAVc,CAa3B,MAAO,CACL,QAAS,sBADJ,CAboB,CAgB3B,QAAS,CACP,QAAS,+BADF,CAhBkB,CAmB3B,eAAgB,CACd,QAAS,4BADK,CAnBW,CAsB3B,WAAY,CACV,QAAS,+BADC,CAtBe,CAA7B,CAFe,GA6BTC,oCA7BS,YA+Bb;;;;;OAMA,6CAAYC,MAAZ,CAAoBC,6BAApB,CAAmD,2DACjD,KAAKA,6BAAL,CAAqCA,6BAArC,CACA,KAAKC,gBAAL,CAAwB,CAAC,IAAD,CAAO,IAAP,CAAa,IAAb,CAAxB,CACA,KAAKC,WAAL,CAAmB,CACjB,KAAM,OADW,CAEjB,KAAM,UAFW,CAGjB,KAAM,QAHW,CAAnB,CAMA,KAAKC,oBAAL,CAA4B,CAC1B,UAAW,cADe,CAE1B,WAAY,UAFc,CAG1B,YAAa,UAHa,CAA5B,CAMA,KAAKC,QAAL,CAAgB,CACd,EAAG,WADW,CAEd,EAAG,WAFW,CAGd,EAAG,SAHW,CAId,EAAG,aAJW,CAKd,EAAG,SALW,CAMd,EAAG,WANW,CAOd,EAAG,UAPW,CAAhB,CAUA,KAAKL,MAAL,CAAcA,MAAd,CACA,KAAKM,SAAL,CAAiB,EAAjB,CAEA;AACA;AACA;AACD,CApEY,oGAsECC,MAtED,CAsES,CACpB,MAAO,MAAKJ,WAAL,CAAiBI,MAAjB,CACR,CAxEY,sEA0EUC,IA1EV,CA0EgB,CAC3B,MAAO,MAAKJ,oBAAL,CAA0BI,IAA1B,CACR,CA5EY,8CA8EFC,KA9EE,CA8EKC,KA9EL,CA8EY,CACvB,GAAMC,MAAO,KAAKN,QAAL,CAAcI,KAAd,CAAb,CACA,GAAIC,KAAJ,CAAW,CACT,MAAOC,MAAKC,SAAL,CAAe,CAAf,CAAkB,CAAlB,CACR,CAED,MAAOD,KACR,CArFY,4DAuFKE,WAvFL,CAuFkB,gBAC7B,GAAML,MAAO,KAAKM,sBAAL,CAA4BD,YAAYE,eAAxC,CAAb,CACA,GAAIF,YAAYE,eAAZ,GAAgC,WAApC,CAAiD,CAC/C,GAAIC,YAAaR,IAAb,IAAJ,CAEA,GAAIK,YAAYI,QAAhB,CAA0B,CACxBD,QAAU,WACX,CAED,GAAME,aAAcL,YAAYK,WAAZ,EAA2BL,YAAYK,WAAZ,CAAwBC,MAAnD,CAA4DN,YAAYK,WAAZ,CAAwB,CAAxB,CAA5D,CAAyF,IAA7G,CACA,GAAME,UAAWF,YAAcA,YAAYG,IAA1B,CAAiC,IAAlD,CACA,GAAMC,QAASJ,YAAcA,YAAYK,EAA1B,CAA+B,IAA9C,CAEA,GAAIV,YAAYW,SAAZ,EAAyBX,YAAYY,OAAzC,CAAkD,CAChDT,YAAc,KAAKU,kBAAL,CAAwBb,YAAYW,SAApC,CAA+CJ,QAA/C,CAAd,OAA4E,KAAKM,kBAAL,CAAwBb,YAAYY,OAApC,CAA6CH,MAA7C,CAC7E,CAFD,IAEO,IAAIT,YAAYW,SAAhB,CAA2B,CAChCR,YAAc,KAAKW,mBAAL,CAAyBd,YAAYW,SAArC,CAAgDJ,QAAhD,CAA0DE,MAA1D,CACf,CAED,GAAMM,uBAAwB,KAAKC,oBAAL,CAA0BhB,YAAYe,qBAAtC,CAA9B,CACA,GAAIA,qBAAJ,CAA2B,CACzB,MAAUZ,OAAV,OAAsBY,qBACvB,CAED,MAAOZ,OACR,CAvBD,IAuBO,CACL,GAAIH,YAAYK,WAAZ,CAAwBC,MAAxB,GAAmC,CAAnC,EAAwC,CAACN,YAAYI,QAAzD,CAAmE,CACjE,UAAWT,IAAX,wBACD,CAED,GAAMsB,cAAejB,YAAYK,WAAZ,CAAwBa,GAAxB,CAA4B,SAACb,WAAD,CAAiB,CAChE,MAAO,OAAKc,iBAAL,CAAuBd,WAAvB,CACR,CAFoB,CAArB,CAIA,UAAWV,IAAX,MAAoBsB,aAAaG,IAAb,CAAkB,GAAlB,CACrB,CACF,CA3HY,sDA6HEC,QA7HF,CA6HY,CACvB,MAAOC,QAAOD,QAAP,EAAiB3B,MAAjB,CAAwB,IAAxB,EAA8B6B,MAA9B,CAAqC,KAArC,CACR,CA/HY,8CAiIFC,IAjIE,CAiII,CACf,MAAOF,QAAOE,IAAP,EAAa9B,MAAb,CAAoB,IAApB,EAA0B6B,MAA1B,CAAiC,IAAjC,CACR,CAnIY,8DAqIMC,IArIN,CAqIYC,IArIZ,CAqIkB,CAC7B,GAAMtB,QAAS,KAAKuB,UAAL,CAAgBF,IAAhB,CAAf,CACA,GAAIC,IAAJ,CAAU,CACR,MAAUtB,OAAV,KAAoBsB,IACrB,CAED,MAAOtB,OACR,CA5IY,gEA8IOqB,IA9IP,CA8IaG,SA9Ib,CA8IwBC,OA9IxB,CA8IiC,CAC5C,GAAMC,OAAQ,KAAKhB,kBAAL,CAAwBW,IAAxB,CAA8BG,SAA9B,CAAd,CACA,MAAOC,SAAaC,KAAb,OAAwBD,OAAxB,CAAoCC,KAC5C,CAjJY,4DAmJKC,gBAnJL,CAmJuB,CAClC,GAAIA,iBAAiBC,OAAjB,GAA6B,IAAjC,CAAuC,CACrC,MAAO,EACR,CAFD,IAEO,CACL,GAAI5B,QAAS,KAAK6B,UAAL,CAAgBF,iBAAiBC,OAAjC,CAA0C,IAA1C,CAAb,CAEA,GAAID,iBAAiBG,KAAjB,GAA2B,IAA3B,EAAmCH,iBAAiBG,KAAjB,GAA2BH,iBAAiBC,OAAnF,CAA4F,CAC1F5B,QAAU,MAAQ,KAAK6B,UAAL,CAAgBF,iBAAiBG,KAAjC,CAAwC,IAAxC,CACnB,CAED,GAAIH,iBAAiBtB,IAArB,CAA2B,CACzBL,QAAU,IAAM2B,iBAAiBtB,IAClC,CAED,GAAIsB,iBAAiBpB,EAArB,CAAyB,CACvBP,QAAU,MAAQ2B,iBAAiBpB,EACpC,CAED,MAAOP,OACR,CACF,CAvKY,4FAyKqBf,6BAzKrB,CAyKoD8C,QAzKpD,CAyK8D,CACzElD,EAAEmD,IAAF,CAAOC,OAAP,CAAgB,CACd,SAAU,iDADI,CAEd,gCAAiCC,KAAKC,SAAL,CAAe,KAAKlD,6BAApB,CAFnB,CAAhB,CAGG,SAACmD,QAAD,CAAc,CACfL,UACD,CALD,EAMCM,IAND,CAMM,SAACD,QAAD,CAAc,CAClBL,SAASK,SAASE,YAAT,EAAyBF,SAASG,UAAlC,EAAgD,wBAAzD,CACD,CARD,CASD,CAnLY,8DAqLMC,SArLN,CAqLiBC,UArLjB,CAqL6BV,QArL7B,CAqLuC,CAClD,GAAMW,QAAS7D,EAAE,OAAF,EACZ8D,IADY,CACP,CACJ,QAASH,UAAUI,KADf,CADO,CAAf,CAKA,GAAMC,gBAAiBhE,EAAE,OAAF,EACpBiE,QADoB,CACX,iBADW,EAEpBC,IAFoB,CAEfC,SAAS,CACbR,UAAWA,SADE,CAEbC,WAAYA,UAFC,CAAT,CAFe,EAMpBQ,QANoB,CAMXP,MANW,CAAvB,CAQA7D,EAAE6D,MAAF,EAAUA,MAAV,CAAiB,CACfQ,MAAO,IADQ,CAEfC,UAAW,KAFI,CAGfC,MAAOvE,EAAEwE,MAAF,EAAUD,KAAV,GAAoB,GAHZ,CAIfE,OAAQzE,EAAEwE,MAAF,EAAUC,MAAV,GAAqB,GAJd,CAKfC,QAAS,CAAC,CACRC,KAAM,UADE,CAERC,MAAO,gBAAM,CACX,GAAMhB,YAAa,EAAnB,CAEA5D,EAAE6D,MAAF,EAAUgB,IAAV,kBAAgCC,QAAhC,CAAyC,KAAzC,CAAgD,IAAhD,EAAsDC,OAAtD,CAA8D,SAACC,KAAD,CAAW,CACvEpB,WAAWoB,MAAMlE,IAAjB,EAAyBkE,MAAMA,KAChC,CAFD,EAIA9B,SAASU,UAAT,EACA5D,EAAE6D,MAAF,EAAUA,MAAV,CAAiB,OAAjB,CACD,CAXO,CAAD,CAYN,CACDc,KAAM,SADL,CAEDC,MAAO,gBAAM,CACX5E,EAAE6D,MAAF,EAAUA,MAAV,CAAiB,OAAjB,CACD,CAJA,CAZM,CALM,CAAjB,EAyBA7D,EAAE6D,MAAF,EAAUgB,IAAV,CAAe,eAAf,EAAgCC,QAAhC,GAEA,MAAOjB,OACR,CA/NY,gFAiOeF,SAjOf,CAiO0BC,UAjO1B,CAiOsCV,QAjOtC,CAiOgD,iBAC3D,GAAMW,QAAS7D,EAAE,OAAF,EACZ8D,IADY,CACP,CACJ,QAASH,UAAUI,KADf,CADO,CAAf,CAKA,GAAMC,gBAAiBhE,EAAE,OAAF,EACpBiE,QADoB,CACX,iBADW,EAEpBG,QAFoB,CAEXP,MAFW,CAAvB,CAIA,GAAMoB,YAAajF,EAAE,MAAF,EAAUoE,QAAV,CAAmBJ,cAAnB,CAAnB,CAEA,KAAK3D,gBAAL,CAAsB0E,OAAtB,CAA8B,SAACrE,MAAD,CAAY,CACxC,GAAMwE,qBAAsBxE,MAA5B,CAEAV,EAAE,MAAF,EACGoE,QADH,CACYa,UADZ,EAEGE,MAFH,CAEUnF,EAAE,KAAF,EAAS8D,IAAT,CAAc,MAAd,KAA0BoB,KAA1B,EAAmCP,IAAnC,CAAwC,OAAKS,aAAL,CAAmB1E,MAAnB,CAAxC,CAFV,EAIAV,EAAE,OAAF,EACG8D,IADH,CACQ,IADR,CACcoB,KADd,EAEGhB,IAFH,CAEQC,SAAS,CACbR,UAAWA,SADE,CAEbC,WAAYA,WAAWlD,MAAX,CAFC,CAAT,CAFR,EAMG0D,QANH,CAMYJ,cANZ,CAOD,CAdD,EAgBAA,eAAeqB,IAAf,GAEArF,EAAE6D,MAAF,EAAUA,MAAV,CAAiB,CACfQ,MAAO,IADQ,CAEfC,UAAW,KAFI,CAGfC,MAAOvE,EAAEwE,MAAF,EAAUD,KAAV,GAAoB,GAHZ,CAIfE,OAAQzE,EAAEwE,MAAF,EAAUC,MAAV,GAAqB,GAJd,CAKfC,QAAS,CAAC,CACRC,KAAM,UADE,CAERC,MAAO,gBAAM,CACX,GAAMhB,YAAa,EAAnB,CACA,OAAKvD,gBAAL,CAAsB0E,OAAtB,CAA8B,SAACrE,MAAD,CAAY,CACxCkD,WAAWlD,MAAX,EAAqB,EAArB,CACAV,EAAE6D,MAAF,EAAUgB,IAAV,gBAA8BnE,MAA9B,mBAAsDoE,QAAtD,CAA+D,KAA/D,CAAsE,IAAtE,EAA4EC,OAA5E,CAAoF,SAACC,KAAD,CAAW,CAC7FpB,WAAWlD,MAAX,EAAmBsE,MAAMlE,IAAzB,EAAiCkE,MAAMA,KACxC,CAFD,CAGD,CALD,EAOA9B,SAASU,UAAT,CACD,CAZO,CAAD,CAaN,CACDe,KAAM,SADL,CAEDC,MAAO,gBAAM,CACX5E,EAAE6D,MAAF,EAAUA,MAAV,CAAiB,OAAjB,CACD,CAJA,CAbM,CALM,CAAjB,EA0BA7D,EAAE6D,MAAF,EAAUgB,IAAV,CAAe,eAAf,EAAgCC,QAAhC,GAEA,MAAOjB,OACR,CA5RY,mCA8RN,iBACL,GAAMF,WAAY2B,0CAAlB,CACA,GAAM1B,YAAa,EAAnB,CACA,KAAKvD,gBAAL,CAAsB6B,GAAtB,CAA0B,SAACxB,MAAD,CAAY,CACpCkD,WAAWlD,MAAX,EAAqB,OAAK6E,mCAAL,CAAyC7E,MAAzC,CAAiD,OAAKN,6BAAtD,CACtB,CAFD,EAIA,GAAMyD,QAAS,KAAK2B,2BAAL,CAAiC7B,SAAjC,CAA4CC,UAA5C,CAAwD,SAAC6B,aAAD,CAAmB,CACxF5B,OAAOA,MAAP,CAAc,QAAd,EAAwBI,QAAxB,CAAiC,SAAjC,EAEA,GAAMyB,gBAAiB,OAAKC,8CAAL,CAAoD,OAAKvF,6BAAzD,CAAwFqF,aAAxF,CAAvB,CACA,GAAMG,iBAAkB,OAAKC,QAAL,CAAcH,cAAd,CAAxB,CAEA,GAAIE,kBAAoB,IAAxB,CAA8B,CAC5B,OAAKE,SAAL,CAAe,uBAAf,CAAqCF,eAArC,CACD,CAFD,IAEO,CACL,OAAKxF,6BAAL,CAAqCsF,cAArC,CAEA,OAAKK,iCAAL,CAAuC,OAAK3F,6BAA5C,CAA2E,SAAC4F,GAAD,CAAS,CAClFnC,OAAOA,MAAP,CAAc,QAAd,EAAwBoC,WAAxB,CAAoC,SAApC,EACA,GAAID,GAAJ,CAAS,CACP,OAAKF,SAAL,CAAe,oBAAf,CAAqCE,GAArC,CACD,CAFD,IAEO,CACLnC,OAAOA,MAAP,CAAc,OAAd,CACD,CACF,CAPD,CAQD,CACF,CApBc,CAAf,CAsBA7D,EAAE6D,MAAF,EAAUqC,EAAV,CAAa,OAAb,CAAsB,mBAAtB,CAA2C,KAAKC,sBAAL,CAA4BC,IAA5B,CAAiC,IAAjC,CAA3C,EACApG,EAAE6D,MAAF,EAAUqC,EAAV,CAAa,OAAb,CAAsB,oBAAtB,CAA4C,KAAKG,uBAAL,CAA6BD,IAA7B,CAAkC,IAAlC,CAA5C,EACApG,EAAE6D,MAAF,EAAUqC,EAAV,CAAa,OAAb,CAAsB,sBAAtB,CAA8C,KAAKI,yBAAL,CAA+BF,IAA/B,CAAoC,IAApC,CAA9C,EACApG,EAAE6D,MAAF,EAAUqC,EAAV,CAAa,OAAb,CAAsB,0BAAtB,CAAkD,KAAKK,6BAAL,CAAmCH,IAAnC,CAAwC,IAAxC,CAAlD,EAEA,KAAKI,kBAAL,EACD,CAjUY,4EAmUaxF,WAnUb,CAmU0BkC,QAnU1B,CAmUoC,iBAC/C,GAAMS,WAAY8C,wBAAlB,CACA,GAAM7C,YAAa,KAAK8C,iBAAL,CAAuB1F,WAAvB,CAAnB,CACA,GAAM6C,QAAS,KAAK8C,kBAAL,CAAwB,KAAKC,gBAAL,CAAsBjD,SAAtB,CAAxB,CAA0DC,UAA1D,CAAsE,SAAC6B,aAAD,CAAmB,CACtG,GAAMoB,oBAAqB,OAAKC,mBAAL,CAAyBrB,aAAzB,CAA3B,CACAvC,SAAS2D,kBAAT,CACD,CAHc,CAIhB,CA1UY,gDA4UDE,KA5UC,CA4UMC,MA5UN,CA4Uc,CACzB,MAAO,IAAIC,QAAJ,CAAY,SAACC,OAAD,CAAUC,MAAV,CAAqB,CACtCnH,EAAEmD,IAAF,CAAOC,OAAP,CAAgB,CACd,SAAU,wBADI,CAEd,QAAS2D,KAFK,CAGd,SAAUC,MAHI,CAAhB,CAIG,SAACzD,QAAD,CAAc,CACf,GAAM6D,OAAQ/D,KAAKgE,KAAL,CAAW9D,QAAX,CAAd,CACA2D,QAAQE,KAAR,CACD,CAPD,EAQC5D,IARD,CAQM,SAACD,QAAD,CAAc,CAClB4D,OAAO5D,SAASE,YAAT,EAAyBF,SAASG,UAAzC,CACD,CAVD,CAWD,CAZM,CAaR,CA1VY,yFA4VqB,iBAChC,GAAMC,WAAY2D,8BAAlB,CACA,KAAKC,uBAAL,CAA6B,KAAKnH,6BAAlC,EAAiEoH,IAAjE,CAAsE,SAAC5D,UAAD,CAAgB,CACpF,GAAMC,QAAS,OAAK8C,kBAAL,CAAwB,OAAKC,gBAAL,CAAsBjD,SAAtB,CAAxB,CAA0DC,UAA1D,CAAsE,SAAC6B,aAAD,CAAmB,CACtG,OAAKgC,yBAAL,CAA+BhC,aAA/B,CACD,CAFc,CAAf,CAIA5B,OAAOgB,IAAP,CAAY,0BAAZ,EACG6C,8BADH,CACkC,KADlC,CACyC9D,WAAW+D,aADpD,EAEGD,8BAFH,CAEkC,QAFlC,CAE4C,cAF5C,CAE4D,SAACE,KAAD,CAAQ1E,QAAR,CAAqB,CAC7E,OAAK2E,WAAL,CAAiB,UAAjB,CAA6BD,MAAME,IAAN,CAAa,GAA1C,EACGN,IADH,CACQ,SAACJ,KAAD,CAAW,CACflE,SAASkE,MAAMlF,GAAN,CAAU,SAAC6F,QAAD,CAAc,CAC/B,MAAO,CACL/C,MAAU+C,SAASpH,IAAnB,KAA2BoH,SAASC,IAD/B,CAELC,MAAO,OAAKC,iBAAL,CAAuBH,SAASI,KAAhC,CAAuC,IAAvC,CAFF,CAIR,CALQ,CAAT,CAMD,CARH,EASGC,KATH,CASS,SAACpC,GAAD,CAAS,CACdqC,QAAQC,KAAR,CAActC,GAAd,CACD,CAXH,CAYD,CAfH,EAiBAnC,OAAOgB,IAAP,CAAY,sBAAZ,EACG6C,8BADH,CACkC,KADlC,CACyC9D,WAAW2E,SADpD,EAEGb,8BAFH,CAEkC,QAFlC,CAE4C,cAF5C,CAE4D,SAACE,KAAD,CAAQ1E,QAAR,CAAqB,CAC7E,OAAK2E,WAAL,CAAiB,uDAAjB,CAA0ED,MAAME,IAAN,CAAa,GAAvF,EACGN,IADH,CACQ,SAACJ,KAAD,CAAW,CACflE,SAASkE,MAAMlF,GAAN,CAAU,SAACsG,QAAD,CAAc,CAC/B,MAAO,CACLxD,MAAUwD,SAAS7H,IAAnB,KAA2B6H,SAASR,IAD/B,CAELC,MAAO,OAAKQ,mBAAL,CAAyBD,QAAzB,CAFF,CAIR,CALQ,CAAT,CAMD,CARH,EASGJ,KATH,CASS,SAACpC,GAAD,CAAS,CACdqC,QAAQC,KAAR,CAActC,GAAd,CACD,CAXH,CAYD,CAfH,CAiBD,CAvCD,CAyCD,CAvYY,wDAyYGrF,IAzYH,CAyYS,CACnB,OAAQA,IAAR,EACC,IAAK,cAAL,CACE,MAAO,OAAP,CACF,IAAK,UAAL,CACE,MAAO,UAAP,CACF,IAAK,iBAAL,CACE,MAAO,mBAAP,CACF,IAAK,iBAAL,CACE,MAAO,4BAAP,CACF,IAAK,SAAL,CACE,MAAO,KAAP,CACF,IAAK,UAAL,CACE,MAAO,OAAP,CACF,IAAK,QAAL,CACE,MAAO,aAAP,CAdH,CAgBF,CA1ZY,gEA4ZOoH,QA5ZP,CA4ZiB,CAC5B,GAAMjH,MAAO,KAAKoH,iBAAL,CAAuBH,SAASI,KAAhC,CAAuC,IAAvC,CAAb,CACA,GAAMxH,MAAO,KAAK+H,eAAL,CAAqBX,SAASpH,IAA9B,CAAb,CACA,MAAUG,KAAV,MAAmBH,IAAnB,IACD,CAhaY,gFAkaegI,YAlaf,CAka6B,CACxC,GAAM7H,MAAO,KAAKoH,iBAAL,CAAuBS,aAAaR,KAApC,CAA2C,IAA3C,CAAb,CACA,GAAMxH,MAAO,KAAK+H,eAAL,CAAqB,cAArB,CAAb,CACA,MAAU5H,KAAV,MAAmBH,IAAnB,IACD,CAtaY,4CAwaHoD,KAxaG,CAwaIY,IAxaJ,CAwaU,CACrB,GAAMiE,UAAW5I,EAAE,OAAF,EACdiE,QADc,CACL,OADK,EAEdU,IAFc,CAETA,IAFS,CAAjB,CAIA,GAAMd,QAAS7D,EAAE,OAAF,EACZ8D,IADY,CACP,OADO,CACEC,KADF,EAEZoB,MAFY,CAELyD,QAFK,EAGZ/E,MAHY,CAGL,CACNQ,MAAO,IADD,CAENC,UAAW,KAFL,CAGNC,MAAO,GAHD,CAINE,OAAQ,GAJF,CAKNC,QAAS,CACPmE,GAAI,aAAM,CACR7I,EAAE6D,MAAF,EAAUA,MAAV,CAAkB,OAAlB,CACD,CAHM,CALH,CAHK,CAchB,CA3bY,0CA6bJzD,6BA7bI,CA6b2B,CACtC,GAAM0I,iBAAkB,EAAxB,CAEA,IAAK,GAAIC,GAAI,CAAb,CAAgBA,EAAI3I,8BAA8B4I,SAA9B,CAAwC1H,MAA5D,CAAoEyH,GAApE,CAAyE,CACvE,GAAME,SAAU7I,8BAA8B4I,SAA9B,CAAwCD,CAAxC,CAAhB,CACA,GAAIE,QAAQC,OAAR,GAAoB,QAApB,EAAgCD,QAAQC,OAAR,GAAoB,QAAxD,CAAkE,CAChE,IAAK,GAAIC,GAAI,CAAb,CAAgBA,EAAIL,gBAAgBxH,MAApC,CAA4C6H,GAA5C,CAAiD,CAC/C,GAAIL,gBAAgBK,CAAhB,IAAuBF,QAAQC,OAAnC,CAA4C,CAC1C,MAAO,+EACR,CACF,CACF,CAEDJ,gBAAgBM,IAAhB,CAAqBH,QAAQC,OAA7B,CACD,CAED,MAAO,KACR,CA9cY,+DAgdQ,iBACnB,GAAMG,kBAAmB,KAAKjJ,6BAAL,CAAmCkJ,YAAnC,CAAgDpH,GAAhD,CAAoD,SAAClB,WAAD,CAAiB,CAC5F,MAAO,QAAKuI,iBAAL,CAAuBvI,WAAvB,CACR,CAFwB,CAAzB,CAIAhB,EAAE,0BAAF,EAA8BwJ,KAA9B,GAEA,GAAIH,iBAAiB/H,MAArB,CAA6B,CAC3B+H,iBAAiBtE,OAAjB,CAAyB,SAAC0E,eAAD,CAAqB,CAC5C,GAAMC,KAAM1J,EAAE,MAAF,EAAUoE,QAAV,CAAmBpE,EAAE,0BAAF,CAAnB,CAAZ,CACAA,EAAE,MAAF,EAAUkE,IAAV,CAAeuF,eAAf,EAAgCrF,QAAhC,CAAyCsF,GAAzC,EACA1J,EAAE,MAAF,EAAUmF,MAAV,CAAiBnF,EAAE,KAAF,EAASiE,QAAT,CAAkB,4CAAlB,EAAgEC,IAAhE,CAAqE,QAArE,CAAjB,EAAiGE,QAAjG,CAA0GsF,GAA1G,EACA1J,EAAE,MAAF,EAAUmF,MAAV,CAAiBnF,EAAE,KAAF,EAASiE,QAAT,CAAkB,0CAAlB,EAA8DC,IAA9D,CAAmE,SAAnE,CAAjB,EAAgGE,QAAhG,CAAyGsF,GAAzG,CACD,CALD,CAMD,CAPD,IAOO,CACL1J,EAAE,MAAF,EACGmF,MADH,CACUnF,EAAE,MAAF,EAAUkE,IAAV,CAAe,gDAAf,CADV,EAEGE,QAFH,CAEYpE,EAAE,0BAAF,CAFZ,CAGD,CACF,CAneY,sEAqeU2J,MAreV,CAqekBjJ,MArelB,CAqe0BC,IAre1B,CAqegC,CAC3C,GAAI,CAACgJ,MAAL,CAAa,CACX,MAAO,KACR,CAED,IAAK,GAAIR,GAAI,CAAb,CAAgBA,EAAIQ,OAAOrI,MAA3B,CAAmC6H,GAAnC,CAAwC,CACtC,GAAIzI,SAAWiJ,OAAOR,CAAP,EAAUS,QAArB,EAAiCjJ,OAASgJ,OAAOR,CAAP,EAAUxI,IAAxD,CAA8D,CAC5D,MAAOgJ,QAAOR,CAAP,EAAUnE,KAClB,CACF,CAED,MAAO,KACR,CAjfY,4DAmfK2E,MAnfL,CAmfajJ,MAnfb,CAmfqB,CAChC,GAAI,CAACiJ,MAAL,CAAa,CACX,MAAO,KACR,CAED,IAAK,GAAIR,GAAI,CAAb,CAAgBA,EAAIQ,OAAOrI,MAA3B,CAAmC6H,GAAnC,CAAwC,CACtC,GAAIzI,SAAWiJ,OAAOR,CAAP,EAAUS,QAAzB,CAAmC,CACjC,MAAOD,QAAOR,CAAP,EAAUnE,KAClB,CACF,CAED,MAAO,KACR,CA/fY,kEAigBQ2E,MAjgBR,CAigBgB,CAC3B,IAAK,GAAIR,GAAI,CAAb,CAAgBA,EAAI,KAAK9I,gBAAL,CAAsBiB,MAA1C,CAAkD6H,GAAlD,CAAuD,CACrD,GAAMhI,QAAS,KAAK+G,iBAAL,CAAuByB,MAAvB,CAA+B,KAAKtJ,gBAAL,CAAsB8I,CAAtB,CAA/B,CAAf,CACA,GAAIhI,MAAJ,CAAY,CACV,MAAOA,OACR,CACF,CAED,MAAO,KACR,CA1gBY,0DA4gBIwC,SA5gBJ,CA4gBe,iBAC1B,CAACA,UAAUkG,QAAV,EAAoB,EAArB,EAAyB9E,OAAzB,CAAiC,SAAC+E,OAAD,CAAa,CAC5C,CAACA,QAAQC,MAAR,EAAgB,EAAjB,EAAqBhF,OAArB,CAA6B,SAACiF,KAAD,CAAQpJ,KAAR,CAAkB,CAC7C,GAAMqJ,qBAAsBD,MAAMlJ,IAAN,CAAWoJ,OAAX,CAAmB,UAAnB,CAA5B,CACA,GAAID,sBAAwB,CAAC,CAA7B,CAAgC,CAC9BH,QAAQC,MAAR,CAAeI,MAAf,CAAsBvJ,KAAtB,CAA6B,CAA7B,EAEA,OAAKP,gBAAL,CAAsB0E,OAAtB,CAA8B,SAACrE,MAAD,CAAY,CACxCoJ,QAAQC,MAAR,CAAeI,MAAf,CAAsBvJ,KAAtB,CAA6B,CAA7B,CAAgCwJ,OAAOC,MAAP,CAAc,EAAd,CAAkBL,KAAlB,CAAyB,CACvDlJ,KAAMkJ,MAAMlJ,IAAN,CAAWwJ,OAAX,CAAmB,aAAnB,CAAkC5J,MAAlC,CADiD,CAEvDqD,MAAOiG,MAAMjG,KAAN,CAAYuG,OAAZ,CAAoB,aAApB,CAAmC,OAAKlF,aAAL,CAAmB1E,MAAnB,CAAnC,CAFgD,CAAzB,CAAhC,CAID,CALD,CAMD,CACF,CAZD,CAaD,CAdD,EAgBA,MAAOiD,UACR,CA9hBY,kFAgiBgBC,UAhiBhB,CAgiB4B,CACvC,GAAM7B,uBAAwB,EAA9B,CACA,GAAMX,UAAWwC,WAAWjD,IAAX,GAAoB,gBAArC,CACA,GAAM4J,aAAc,KAApB,CACA,GAAMC,QAASpJ,SAAW,IAAX,CAAkBwC,+BAAjC,CACA,GAAM6G,UAAWrJ,SAAW,IAAX,CAAkBwC,iCAAnC,CACA,GAAMvC,aAAc,EAApB,CAEA,GAAImJ,QAAUC,QAAd,CAAwB,CACtBpJ,YAAY+H,IAAZ,CAAiB,CACfrG,QAAS,IADM,CAEfE,MAAO,IAFQ,CAGfzB,KAAMiJ,QAHS,CAIf/I,GAAI8I,MAJW,CAKfE,QAAS,KALM,CAAjB,CAOD,CAED,KAAKrK,gBAAL,CAAsB0E,OAAtB,CAA8B,SAACrE,MAAD,CAAY,CACxC,GAAMsE,OAAQpB,+CAA+ClD,MAA/C,CAAd,CACA,GAAIsE,KAAJ,CAAW,CACTjD,sBAAsBqH,IAAtB,CAA2B,CACzBQ,SAAUlJ,MADe,CAEzBsE,MAAOA,KAFkB,CAA3B,CAID,CACF,CARD,EAUA,MAAO,CACL9D,gBAAiB0C,WAAWjD,IADvB,CAELgB,UAAW,KAAKgJ,YAAL,CAAkB/G,iCAAlB,CAFN,CAGLhC,QAAS,KAAK+I,YAAL,CAAkB/G,+BAAlB,CAHJ,CAILxC,SAAUA,QAJL,CAKLmJ,YAAaA,WALR,CAMLxI,sBAAuBA,qBANlB,CAOLV,YAAaA,WAPR,CASR,CArkBY,gFAukBeuC,UAvkBf,CAukB2B,CACtC,GAAMxC,UAAW,KAAjB,CACA,GAAMmJ,aAAc3G,WAAcA,WAAWjD,IAAzB,mBAAiD,MAArE,CACA,GAAMoB,uBAAwB,EAA9B,CACA,GAAMuH,cAAejG,KAAKgE,KAAL,CAAWzD,WAAW,uBAAX,CAAX,CAArB,CACA,GAAMvC,aAAcuC,WAAW,kBAAX,EAAiC,EAAjC,CAAsC0F,aAAapH,GAAb,CAAiB,SAAClB,WAAD,CAAiB,CAC1F,MAAO,CACL+B,QAAS6H,SAAS5J,YAAY6J,GAArB,CADJ,CAEL5H,MAAO2H,SAAS5J,YAAY6J,GAArB,CAFF,CAGLrJ,KAAMR,YAAYQ,IAHb,CAILE,GAAIV,YAAYU,EAJX,CAKLgJ,QAAS,KALJ,CAOR,CARyD,CAA1D,CAUA,MAAO,CACLxJ,gBAAiB0C,WAAWjD,IADvB,CAELgB,UAAW4I,YAAc,IAAd,CAAqB,KAAKI,YAAL,CAAkB/G,WAAcA,WAAWjD,IAAzB,cAAlB,CAF3B,CAGLiB,QAAS2I,YAAc,IAAd,CAAqB,KAAKI,YAAL,CAAkB/G,WAAcA,WAAWjD,IAAzB,YAAlB,CAHzB,CAILS,SAAUA,QAJL,CAKLmJ,YAAaA,WALR,CAMLxI,sBAAuBA,qBANlB,CAOLV,YAAaA,WAPR,CASR,CA/lBY,8EAimBcuC,UAjmBd,CAimB0B,CACrC,GAAMxC,UAAW,KAAjB,CACA,GAAMmJ,aAAc3G,WAAcA,WAAWjD,IAAzB,mBAAiD,MAArE,CACA,GAAMoB,uBAAwB,EAA9B,CACA,GAAMV,aAAc,CAAC,CACnB0B,QAAS6H,SAAShH,WAAW,mBAAX,CAAT,CADU,CAEnBX,MAAO2H,SAAShH,WAAW,iBAAX,CAAT,CAFY,CAGnBpC,KAAMoC,WAAW,mBAAX,CAHa,CAInBlC,GAAIkC,WAAW,iBAAX,CAJe,CAKnB8G,QAAS,KALU,CAAD,CAApB,CAQA,MAAO,CACLxJ,gBAAiB0C,WAAWjD,IADvB,CAELgB,UAAW4I,YAAc,IAAd,CAAqB,KAAKI,YAAL,CAAkB/G,WAAcA,WAAWjD,IAAzB,cAAlB,CAF3B,CAGLiB,QAAS2I,YAAc,IAAd,CAAqB,KAAKI,YAAL,CAAkB/G,WAAcA,WAAWjD,IAAzB,YAAlB,CAHzB,CAILS,SAAUA,QAJL,CAKLmJ,YAAaA,WALR,CAMLxI,sBAAuBA,qBANlB,CAOLV,YAAaA,WAPR,CASR,CAtnBY,gEAwnBOuC,UAxnBP,CAwnBmB,CAC9B,GAAM1C,iBAAkB0C,WAAWjD,IAAnC,CACA,OAAQO,eAAR,EACE,IAAK,WAAL,CACE,MAAO,MAAK4J,4BAAL,CAAkClH,UAAlC,CAAP,CACF,IAAK,UAAL,CACE,MAAO,MAAKmH,2BAAL,CAAiCnH,UAAjC,CAAP,CACF,IAAK,SAAL,CACE,MAAO,MAAKoH,0BAAL,CAAgCpH,UAAhC,CAAP,CANJ,CAOC,CACF,CAloBY,sHAooBkCqH,8BApoBlC,CAooBkErH,UApoBlE,CAooB8E,CACzF,GAAMxD,+BAAgCiD,KAAKgE,KAAL,CAAWhE,KAAKC,SAAL,CAAe2H,8BAAf,CAAX,CAAtC,CACA7K,8BAA8B4I,SAA9B,CAA0C,EAA1C,CACA5I,8BAA8B8K,YAA9B,CAA6C,EAA7C,CACA9K,8BAA8B+K,MAA9B,CAAuC,EAAvC,CACA/K,8BAA8BgL,YAA9B,CAA6C,EAA7C,CAEA,KAAK/K,gBAAL,CAAsB0E,OAAtB,CAA8B,SAACrE,MAAD,CAAY,CACxC,GAAM2K,cAAezH,WAAWlD,MAAX,CAArB,CAEA,GAAM4K,iBAAkBjI,KAAKgE,KAAL,CAAWgE,aAAarC,SAAxB,EAAmCuC,MAAnC,CAA0C,SAACtC,OAAD,CAAa,CAC7E,MAAO,CAAC,CAACA,QAAQuC,MAAV,EAAoB,CAAC,CAACvC,QAAQuC,MAAR,CAAeC,IAAf,EAC9B,CAFuB,CAAxB,CAIAH,gBAAgBvG,OAAhB,CAAwB,SAAC2G,aAAD,CAAgBC,YAAhB,CAAiC,CACvD,GAAI1C,eAAJ,CACA,GAAI7I,8BAA8B4I,SAA9B,CAAwC1H,MAAxC,CAAiD,CAAjD,CAAqDqK,YAAzD,CAAuE,CACrE1C,QAAU,CACR2C,uBAAwB,EADhB,CAERC,cAAe,EAFP,CAGR3C,QAAS,QAHD,CAIRvI,KAAM,UAJE,CAKRmL,QAAS,IALD,CAAV,CAQA1L,8BAA8B4I,SAA9B,CAAwCI,IAAxC,CAA6CH,OAA7C,CACD,CAVD,IAUO,CACLA,QAAU7I,8BAA8B4I,SAA9B,CAAwC2C,YAAxC,CACX,CAED,GAAID,cAAc3J,qBAAlB,CAAyC,CACvC2J,cAAc3J,qBAAd,CAAsC2J,cAAc3J,qBAAd,CAAoC0J,IAApC,EACvC,CAED,GAAIC,cAAc3J,qBAAlB,CAAyC,CACvCkH,QAAQ2C,sBAAR,CAA+BxC,IAA/B,CAAoC,CAClC,WAAY1I,MADsB,CAElC,QAASgL,cAAc3J,qBAFW,CAApC,CAID,CAEDkH,QAAQ4C,aAAR,CAAsBzC,IAAtB,CAA2B,CACzB,WAAY1I,MADa,CAEzB,QAASgL,cAAcF,MAFE,CAA3B,EAKAvC,QAAQ8C,UAAR,CAAqBL,cAAcM,cAAnC,CACA/C,QAAQgD,YAAR,CAAuBP,cAAcO,YACtC,CAlCD,EAoCA,GAAMC,kBAAmB7I,KAAKgE,KAAL,CAAWgE,aAAaa,gBAAxB,EAA0CX,MAA1C,CAAiD,SAACtC,OAAD,CAAa,CACrF,MAAO,CAAC,CAACA,QAAQkD,OAClB,CAFwB,CAAzB,CAIAD,iBAAiBnH,OAAjB,CAAyB,SAACqH,cAAD,CAAiBC,mBAAjB,CAAyC,CAChE,GAAMV,cAAeL,gBAAgBhK,MAAhB,CAAyB+K,mBAA9C,CAEA,GAAIpD,eAAJ,CACA,GAAI7I,8BAA8B4I,SAA9B,CAAwC1H,MAAxC,CAAiD,CAAjD,CAAqDqK,YAAzD,CAAuE,CACrE1C,QAAU,CACRC,QAAS,QADD,CAERvI,KAAM,UAFE,CAGR2L,eAAgB,EAHR,CAAV,CAKAlM,8BAA8B4I,SAA9B,CAAwCI,IAAxC,CAA6CH,OAA7C,CACD,CAPD,IAOO,CACLA,QAAU7I,8BAA8B4I,SAA9B,CAAwC2C,YAAxC,CACX,CAED1C,QAAQqD,cAAR,CAAuBlD,IAAvB,CAA4B,CAC1B,WAAY1I,MADc,CAE1B,QAAS0L,eAAeD,OAFE,CAA5B,CAID,CAnBD,EAqBA/L,8BAA8B+K,MAA9B,CAAuC/K,8BAA8B+K,MAA9B,CAAqCoB,MAArC,CACrClJ,KAAKgE,KAAL,CAAWgE,aAAaF,MAAxB,EACGI,MADH,CACU,SAACiB,KAAD,CAAW,CACjB,MAAO,CAAC,CAACA,MAAMA,KAChB,CAHH,EAIGtK,GAJH,CAIO,SAACsK,KAAD,CAAW,CACd,MAAO,CACL,WAAY9L,MADP,CAEL,QAAS8L,MAAMA,KAFV,CAIR,CATH,CADqC,CAAvC,CAaApM,8BAA8BgL,YAA9B,CAA6ChL,8BAA8BgL,YAA9B,CAA2CmB,MAA3C,CAC3ClJ,KAAKgE,KAAL,CAAWgE,aAAaD,YAAxB,EACGG,MADH,CACU,SAACkB,WAAD,CAAiB,CACvB,MAAO,CAAC,CAACA,YAAYC,YAAd,EAA8B,CAAC,CAACD,YAAYE,MACpD,CAHH,EAIGzK,GAJH,CAIO,SAACuK,WAAD,CAAiB,CACpB,MAAOrC,QAAOC,MAAP,CAAcoC,WAAd,CAA2B,CAChC,OAAQ,OADwB,CAEhC,WAAY/L,MAFoB,CAGhC,yBAA0B+L,YAAYG,sBAAZ,GAAuC,MAHjC,CAA3B,CAKR,CAVH,CAD2C,CAA7C,CAcAxM,8BAA8BgL,YAA9B,CAA6ChL,8BAA8BgL,YAA9B,CAA2CmB,MAA3C,CAC3ClJ,KAAKgE,KAAL,CAAWgE,aAAawB,KAAxB,EACGtB,MADH,CACU,SAACuB,GAAD,CAAS,CACf,MAAO,CAAC,CAACA,IAAIJ,YAAN,EAAsB,CAAC,CAACI,IAAIH,MACpC,CAHH,EAIGzK,GAJH,CAIO,SAAC4K,GAAD,CAAS,CACZ,MAAO,CACL,OAAQ,KADH,CAEL,WAAYpM,MAFP,CAGL,SAAUoM,IAAIH,MAHT,CAIL,eAAgBG,IAAIJ,YAJf,CAKL,yBAA0B,KALrB,CAOR,CAZH,CAD2C,CAA7C,CAgBAtM,8BAA8B2M,QAA9B,CAAyC3M,8BAA8B2M,QAA9B,CAAuCR,MAAvC,CACvClJ,KAAKgE,KAAL,CAAWgE,aAAa0B,QAAxB,EACGxB,MADH,CACU,SAACyB,OAAD,CAAa,CACnB,MAAO,CAAC,CAACA,QAAQC,GAClB,CAHH,EAIG/K,GAJH,CAIO,SAAC8K,OAAD,CAAa,CAChB,MAAO5C,QAAOC,MAAP,CAAc2C,OAAd,CAAuB,CAC5B,WAAYtM,MADgB,CAAvB,CAGR,CARH,CADuC,CAAzC,CAYA,GAAI2K,aAAa6B,WAAjB,CAA8B,CAC5B7B,aAAa6B,WAAb,CAA2B7B,aAAa6B,WAAb,CAAyBzB,IAAzB,EAC5B,CAED,GAAIJ,aAAa6B,WAAjB,CAA8B,CAC5B9M,8BAA8B8K,YAA9B,CAA2C9B,IAA3C,CAAgD,CAC9C,WAAY1I,MADkC,CAE9C,QAAS2K,aAAa6B,WAFwB,CAG9C,OAAQ,aAHsC,CAAhD,CAKD,CAED,GAAI7B,aAAa8B,gBAAjB,CAAmC,CACjC9B,aAAa8B,gBAAb,CAAgC9B,aAAa8B,gBAAb,CAA8B1B,IAA9B,EACjC,CAED,GAAIJ,aAAa8B,gBAAjB,CAAmC,CACjC/M,8BAA8B8K,YAA9B,CAA2C9B,IAA3C,CAAgD,CAC9C,WAAY1I,MADkC,CAE9C,QAAS2K,aAAa8B,gBAFwB,CAG9C,OAAQ,kBAHsC,CAAhD,CAKD,CACF,CAlJD,EAoJA,MAAO/M,8BACR,CAhyBY,4DAkyBKY,WAlyBL,CAkyBkB,iBAC7B,GAAI,CAACA,WAAL,CAAkB,CAChB,MAAO,EACR,CAED,GAAML,MAAOK,YAAYE,eAAzB,CACA,GAAMqJ,aAAcvJ,YAAYuJ,WAAZ,CAA0B,MAA1B,CAAmC,OAAvD,CACA,GAAM5I,WAAYX,YAAYuJ,WAAZ,EAA2B,CAACvJ,YAAYW,SAAxC,CAAoD,IAApD,CAA2DW,OAAOtB,YAAYW,SAAnB,CAA7E,CACA,GAAMC,SAAUZ,YAAYuJ,WAAZ,EAA2B,CAACvJ,YAAYY,OAAxC,CAAkD,IAAlD,CAAyDU,OAAOtB,YAAYY,OAAnB,CAAzE,CACA,GAAMwL,SAAUpM,YAAYK,WAAZ,CAAwBC,MAAxB,GAAmC,CAAnC,EAAwC,CAACN,YAAYI,QAArE,CACA,GAAMiM,cAAe1L,UAAYA,UAAUY,MAAV,EAAZ,CAAiC,IAAtD,CACA,GAAM+K,YAAa1L,QAAUA,QAAQW,MAAR,EAAV,CAA6B,IAAhD,CACA,GAAMlB,aAAcL,YAAYK,WAAZ,EAA2BL,YAAYK,WAAZ,CAAwBC,MAAnD,CAA4DN,YAAYK,WAAZ,CAAwB,CAAxB,CAA5D,CAAyF,IAA7G,CACA,GAAMY,cAAe,EAArB,CAEA,CAACjB,YAAYK,WAAZ,EAAyB,EAA1B,EAA8B0D,OAA9B,CAAsC,SAAC1D,WAAD,CAAiB,CACrD,IAAK,GAAIwJ,KAAMxJ,YAAY0B,OAA3B,CAAoC8H,KAAOxJ,YAAY4B,KAAvD,CAA8D4H,KAA9D,CAAqE,CACnE5I,aAAamH,IAAb,CAAkB,CAChByB,IAAKA,GADW,CAEhBrJ,KAAMH,YAAYG,IAFF,CAGhBE,GAAIL,YAAYK,EAHA,CAAlB,CAKD,EACF,CARD,EAUA,OAAQf,IAAR,EACE,IAAK,UAAL,CACE,MAAO,CACL,OAAQA,IADH,CAEL,uBAAwB4J,WAFnB,CAGL,qBAAsB8C,YAHjB,CAIL,mBAAoBC,UAJf,CAKL,mBAAoBF,OALf,CAML,wBAAyBnL,YANpB,CAAP,CAQF,IAAK,SAAL,CACE,MAAO,CACL,OAAQtB,IADH,CAEL,sBAAuB4J,WAFlB,CAGL,oBAAqB8C,YAHhB,CAIL,kBAAmBC,UAJd,CAKL,oBAAqBjM,YAAcA,YAAY0B,OAA1B,CAAoC,IALpD,CAML,oBAAqB1B,YAAcA,YAAYG,IAA1B,CAAiC,IANjD,CAOL,kBAAmBH,YAAcA,YAAY4B,KAA1B,CAAkC,IAPhD,CAQL,kBAAmB5B,YAAcA,YAAYK,EAA1B,CAA+B,IAR7C,CAAP,CAUF,IAAK,WAAL,CACE,GAAMH,UAAWF,YAAcA,YAAYG,IAA1B,CAAiC,IAAlD,CACA,GAAMC,QAASJ,YAAcA,YAAYK,EAA1B,CAA+B,IAA9C,CACA,GAAM6L,eAAgB,CAAC3L,OAAD,CAAW,CAACL,QAAD,EAAa,CAACE,MAAd,CAAuB,gBAAvB,CAA0C,QAArD,CAAgE,OAAtF,CAEA,GAAIE,WAAaJ,QAAjB,CAA2B,CACzB,GAAMiM,OAAQjM,SAASkM,KAAT,CAAe,GAAf,CAAd,CACA9L,UAAU+L,IAAV,CAAe9C,SAAS4C,MAAM,CAAN,CAAT,CAAf,EACA7L,UAAUgM,MAAV,CAAiB/C,SAAS4C,MAAM,CAAN,CAAT,CAAjB,CACD,CAED,GAAI5L,SAAWH,MAAf,CAAuB,CACrB,GAAM+L,QAAQ/L,OAAOgM,KAAP,CAAa,GAAb,CAAd,CACA7L,QAAQ8L,IAAR,CAAa9C,SAAS4C,OAAM,CAAN,CAAT,CAAb,EACA5L,QAAQ+L,MAAR,CAAe/C,SAAS4C,OAAM,CAAN,CAAT,CAAf,CACD,CAED,GAAMrM,QAAS,CACb,OAAQR,IADK,CAEb,iBAAkB4M,aAFL,CAGb,sBAAuB5L,UAAYA,UAAUY,MAAV,EAAZ,CAAiC,IAH3C,CAIb,oBAAqBX,QAAUA,QAAQW,MAAR,EAAV,CAA6B,IAJrC,CAKb,sBAAuBhB,QALV,CAMb,oBAAqBE,MANR,CAAf,CASA,KAAKpB,gBAAL,CAAsB0E,OAAtB,CAA8B,SAACrE,MAAD,CAAY,CACxCS,2CAA2CT,MAA3C,EAAuD,OAAKwH,iBAAL,CAAuBlH,YAAYe,qBAAnC,CAA0DrB,MAA1D,CACxD,CAFD,EAIA,MAAOS,OAAP,CACF,QACE,KAAM,IAAIyM,MAAJ,8BAAuCjN,IAAvC,CAAN,CACF,MAtDF,CAwDD,CAn3BY,wEAq3BWP,6BAr3BX,CAq3B0C,iBACrD,GAAMyN,eAAgBzN,8BAA8B0N,SAA9B,CAAwC5L,GAAxC,CAA4C,SAAC0H,QAAD,CAAc,CAC9E,cAAeA,QAChB,CAFqB,EAEnBxH,IAFmB,CAEd,GAFc,CAAtB,CAIA,MAAO,MAAKyF,WAAL,CAAiB,UAAjB,MAAkCgG,aAAlC,MACJrG,IADI,CACC,SAACuG,mBAAD,CAAyB,CAC7B,GAAMC,aAAc,EAApB,CACAD,oBAAoBhJ,OAApB,CAA4B,SAACkJ,WAAD,CAAiB,CAC3CD,YAAYC,YAAYjG,IAAxB,EAAgC,OAAKE,iBAAL,CAAuB+F,YAAY9F,KAAnC,CAA0C,IAA1C,CACjC,CAFD,EAIA,GAAMR,eAAgBvH,8BAA8B0N,SAA9B,CAAwC5L,GAAxC,CAA4C,SAAC0H,QAAD,CAAc,CAC9E,MAAO,CACL5E,MAAO4E,QADF,CAEL3B,MAAO+F,YAAYpE,QAAZ,GAAyBA,QAF3B,CAIR,CALqB,CAAtB,CAOA,GAAMrB,WAAY,EAAlB,CACAnI,8BAA8B8N,KAA9B,CAAoCnJ,OAApC,CAA4C,SAACoJ,IAAD,CAAU,CACpD,GAAIA,KAAKxN,IAAL,GAAc,cAAlB,CAAkC,CAChC4H,UAAUa,IAAV,CAAe,CACbpE,MAAUmJ,KAAKxN,IAAf,KAAuBwN,KAAKnG,IADf,CAEbC,MAAO,OAAKQ,mBAAL,CAAyB0F,IAAzB,CAFM,CAAf,CAID,CALD,IAKO,CACLA,KAAKC,cAAL,CAAoBrJ,OAApB,CAA4B,SAAC4D,YAAD,CAAkB,CAC5CJ,UAAUa,IAAV,CAAe,CACbpE,sBAAuB2D,aAAaX,IADvB,CAEbC,MAAO,OAAKoG,2BAAL,CAAiC1F,YAAjC,CAFM,CAAf,CAID,CALD,CAMD,CACF,CAdD,EAgBA,MAAO,CACLhB,cAAeA,aADV,CAELY,UAAWA,SAFN,CAGL+F,SAAUlO,8BAA8BkO,QAHnC,CAKR,CApCI,CAqCR,CA/5BY,4EAk6Ba7I,aAl6Bb,CAk6B4B,CACvC,KAAKrF,6BAAL,CAAmCkO,QAAnC,CAA8C7I,cAAc6I,QAA5D,CACA,KAAKlO,6BAAL,CAAmC0N,SAAnC,CAA+C,CAACrI,cAAcqI,SAAd,EAAyB,EAA1B,EAA8BL,KAA9B,CAAoC,GAApC,CAA/C,CAEA,GAAIhI,cAAc6I,QAAd,GAA2B,UAA/B,CAA2C,CACzC,GAAIC,qBAAsB,CAAC,CAA3B,CACA,GAAML,OAAQ,EAAd,CAEA,CAACzI,cAAcyI,KAAd,EAAqB,EAAtB,EAA0BT,KAA1B,CAAgC,GAAhC,EAAqC1I,OAArC,CAA6C,SAACoJ,IAAD,CAAU,CACrD,GAAMX,OAAQW,KAAKV,KAAL,CAAW,GAAX,CAAd,CACA,GAAM9M,MAAO6M,MAAM,CAAN,CAAb,CACA,GAAMxF,MAAOwF,MAAM,CAAN,CAAb,CAEA,GAAI7M,OAAS,cAAb,CAA6B,CAC3B,GAAI4N,oBAAsB,CAAC,CAA3B,CAA8B,CAC5BL,MAAMK,mBAAN,EAA2BH,cAA3B,CAA0ChF,IAA1C,CAA+C,CAC7CpB,KAAMA,IADuC,CAA/C,CAGD,CAJD,IAIO,CACLuG,oBAAsBL,MAAM9E,IAAN,CAAW,CAC/B,OAAQ,cADuB,CAE/B,iBAAkB,CAAC,CACjBpB,KAAMA,IADW,CAAD,CAFa,CAAX,EAKjB,CACN,CACF,CAbD,IAaO,CACLkG,MAAM9E,IAAN,CAAW,CACTzI,KAAMA,IADG,CAETqH,KAAMA,IAFG,CAAX,CAID,CACF,CAxBD,EA0BA,KAAK5H,6BAAL,CAAmC8N,KAAnC,CAA2CA,KAC5C,CACF,CAt8BY,gGAw8BuBxN,MAx8BvB,CAw8B+BN,6BAx8B/B,CAw8B8D,kBACzE,GAAMU,MAAO,KAAK0N,sBAAL,CAA4BpO,8BAA8B+H,KAA1D,CAAiEzH,MAAjE,CAAyE,MAAzE,CAAb,CACA,GAAMyM,kBAAmB,KAAKqB,sBAAL,CAA4BpO,8BAA8B8K,YAA1D,CAAwExK,MAAxE,CAAgF,kBAAhF,CAAzB,CACA,GAAMwM,aAAc,KAAKsB,sBAAL,CAA4BpO,8BAA8B8K,YAA1D,CAAwExK,MAAxE,CAAgF,aAAhF,CAApB,CACA,GAAM+N,gBAAiBrO,8BAA8B4I,SAA9B,CAAwCuC,MAAxC,CAA+C,SAACtC,OAAD,CAAa,CACjF,MAAOA,SAAQC,OAAR,GAAoB,QAC5B,CAFsB,CAAvB,CAIA,GAAMgD,kBAAmB9L,8BAA8B4I,SAA9B,CAAwCuC,MAAxC,CAA+C,SAACtC,OAAD,CAAa,CACnF,MAAOA,SAAQC,OAAR,GAAoB,QAC5B,CAFwB,CAAzB,CAIA,GAAMiC,QAAS/K,8BAA8B+K,MAA9B,CAAqCI,MAArC,CAA4C,SAACiB,KAAD,CAAW,CACpE,MAAO9L,UAAW8L,MAAM5C,QACzB,CAFc,CAAf,CAIA,GAAMiD,OAAQzM,8BAA8BgL,YAA9B,CAA2CG,MAA3C,CAAkD,SAACkB,WAAD,CAAiB,CAC/E,MAAOA,aAAY9L,IAAZ,GAAqB,KAArB,EAA8BD,SAAW+L,YAAY7C,QAC7D,CAFa,CAAd,CAIA,GAAMwB,cAAehL,8BAA8BgL,YAA9B,CAA2CG,MAA3C,CAAkD,SAACkB,WAAD,CAAiB,CACtF,MAAOA,aAAY9L,IAAZ,GAAqB,OAArB,EAAgCD,SAAW+L,YAAY7C,QAC/D,CAFoB,CAArB,CAIA,GAAMmD,UAAW3M,8BAA8B2M,QAA9B,CAAuCxB,MAAvC,CAA8C,SAACyB,OAAD,CAAa,CAC1E,MAAOtM,UAAWsM,QAAQpD,QAC3B,CAFgB,CAAjB,CAIA,GAAMZ,WAAYyF,eAAevM,GAAf,CAAmB,SAAC+G,OAAD,CAAa,CAChD,MAAO,CACLuC,OAAQ,QAAKtD,iBAAL,CAAuBe,QAAQ4C,aAA/B,CAA8CnL,MAA9C,CADH,CAELuL,aAAchD,QAAQgD,YAFjB,CAGLD,eAAgB/C,QAAQ8C,UAHnB,CAILhK,sBAAuB,QAAKmG,iBAAL,CAAuBe,QAAQ2C,sBAA/B,CAAuDlL,MAAvD,CAJlB,CAMR,CAPiB,CAAlB,CASA,MAAO,CACLI,KAAMA,IADD,CAELoM,YAAaA,WAFR,CAGLC,iBAAkBA,gBAHb,CAILnE,UAAWA,SAJN,CAKLmC,OAAQA,OAAOjJ,GAAP,CAAW,SAACsK,KAAD,CAAW,CAC5B,MAAO,CACLA,MAAOA,MAAMxH,KADR,CAGR,CAJO,CALH,CAULoG,aAAcA,aAAalJ,GAAb,CAAiB,SAACuK,WAAD,CAAiB,CAC9C,MAAOrC,QAAOC,MAAP,CAAcoC,WAAd,CAA2B,CAChCG,uBAAwBH,YAAYG,sBAAZ,CAAqC,MAArC,CAA8C,OADtC,CAA3B,CAGR,CAJa,CAVT,CAeLC,MAAOA,KAfF,CAgBLX,iBAAkBA,iBAAiBhK,GAAjB,CAAqB,SAACkK,cAAD,CAAoB,CACzD,MAAO,CACLD,QAAS,QAAKjE,iBAAL,CAAuBkE,eAAeE,cAAtC,CAAsD5L,MAAtD,CADJ,CAGR,CAJiB,CAhBb,CAqBLqM,SAAUA,QArBL,CAuBR,CApgCY,kDAsgCA2B,MAtgCA,CAsgCQ,CACnB,GAAI,CAACA,MAAL,CAAa,CACX,MAAO,KACR,CAED,MAAO,IAAIC,KAAJ,CAASA,KAAKtH,KAAL,CAAWqH,MAAX,CAAT,CACR,CA5gCY,wCA8gCJE,KA9gCI,CA8gCGC,IA9gCH,CA8gCS,CACpB,KAAKpO,SAAL,CAAesE,OAAf,CAAuB,SAAC+J,QAAD,CAAc,CACnC,GAAIA,SAASF,KAAT,GAAmBA,KAAvB,CAA8B,CAC5BE,SAASC,QAAT,CAAkBF,MAAM,EAAxB,CACD,CACF,CAJD,CAKD,CAphCY,8BAshCTD,KAthCS,CAshCFG,QAthCE,CAshCQ,CACnB,KAAKtO,SAAL,CAAe2I,IAAf,CAAoB,CAClBwF,MAAOA,KADW,CAElBG,SAAUA,QAFQ,CAApB,CAID,CA3hCY,sEA6hCUH,KA7hCV,CA6hCiB,kBAC5B,KAAKI,yBAAL,CAA+B,IAA/B,CAAqC,SAACC,kBAAD,CAAwB,CAC3D,QAAK7O,6BAAL,CAAmCkJ,YAAnC,CAAgDF,IAAhD,CAAqD6F,kBAArD,EACA,QAAKzI,kBAAL,EACD,CAHD,CAID,CAliCY,qFAoiCmB,CAC9B,KAAK0I,+BAAL,CAAqC,KAAK9O,6BAA1C,CACD,CAtiCY,wEAwiCWwO,KAxiCX,CAwiCkB,kBAC7B,GAAMlF,KAAM1J,EAAE4O,MAAMO,MAAR,EAAgBC,OAAhB,CAAwB,IAAxB,CAAZ,CACA,GAAMxO,OAAQ8I,IAAI9I,KAAJ,EAAd,CACA,GAAMI,aAAc,KAAKZ,6BAAL,CAAmCkJ,YAAnC,CAAgD1I,KAAhD,CAApB,CAEA,KAAKoO,yBAAL,CAA+BhO,WAA/B,CAA4C,SAAC6F,kBAAD,CAAwB,CAClE,QAAKzG,6BAAL,CAAmCkJ,YAAnC,CAAgDa,MAAhD,CAAuDvJ,KAAvD,CAA8D,CAA9D,CAAiEiG,kBAAjE,EACA,QAAKL,kBAAL,EACD,CAHD,CAID,CAjjCY,4EAmjCaoI,KAnjCb,CAmjCoB,CAC/B,GAAMlF,KAAM1J,EAAE4O,MAAMO,MAAR,EAAgBC,OAAhB,CAAwB,IAAxB,CAAZ,CACA,GAAMxO,OAAQ8I,IAAI9I,KAAJ,EAAd,CACA,KAAKR,6BAAL,CAAmCkJ,YAAnC,CAAgDa,MAAhD,CAAuDvJ,KAAvD,CAA8D,CAA9D,EACA,KAAK4F,kBAAL,EACD,CAxjCY,qDA4jCT6I,oCA5jCS,YA8jCb,6CAAalP,MAAb,CAAqB,2DACnB,KAAKmP,WAAL,CAAmB,CACjB,QAAS,MADQ,CAEjB,QAAS,MAFQ,CAGjB,SAAU,gBAHO,CAIjB,aAAc,SAJG,CAKjB,UAAW,OALM,CAMjB,UAAW,KANM,CAOjB,aAAc,KAPG,CAQjB,gBAAiB,KARA,CASjB,SAAU,SATO,CAAnB,CAYA,KAAKnP,MAAL,CAAcA,MAAd,CAEA,KAAKA,MAAL,CAAY+F,EAAZ,CAAe,kBAAf,CAAmC,KAAKqJ,kBAAL,CAAwBnJ,IAAxB,CAA6B,IAA7B,CAAnC,EACA,KAAKjG,MAAL,CAAY+F,EAAZ,CAAe,YAAf,CAA6B,KAAKsJ,YAAL,CAAkBpJ,IAAlB,CAAuB,IAAvB,CAA7B,EACA,KAAKjG,MAAL,CAAY+F,EAAZ,CAAe,UAAf,CAA2B,KAAKuJ,UAAL,CAAgBrJ,IAAhB,CAAqB,IAArB,CAA3B,EACA,KAAKjG,MAAL,CAAYuP,UAAZ,CAAuB,yCAAvB,CAAkE,KAAKC,4BAAL,CAAkCvJ,IAAlC,CAAuC,IAAvC,CAAlE,CACD,CAjlCY,wGAmlCIsI,MAnlCJ,CAmlCY,CACvB,GAAMvN,QAAS,EAAf,CACA,GAAMyO,IAAK,yCAAX,CACA,GAAIC,OAAQ,IAAZ,CAEA,EAAG,CACDA,MAAQD,GAAGE,IAAH,CAAQpB,MAAR,CAAR,CACA,GAAImB,OAASA,MAAMvO,MAAN,CAAe,CAA5B,CAA+B,CAC7BH,OAAOiI,IAAP,CAAY,CACVtI,KAAM+O,MAAM,CAAN,CADI,CAEV7K,MAAO6K,MAAM,CAAN,CAFG,CAAZ,CAID,CACF,CARD,MAQSA,KART,EAUA,MAAO1O,OACR,CAnmCY,4DAqmCML,IArmCN,CAqmCY,CACvB,MAAOb,sBAAqBa,IAArB,EAA2BiD,KACnC,CAvmCY,4DAymCKgM,OAzmCL,CAymCc,kBACzB,MAAOA,SAAQzF,OAAR,CAAgB,gEAAhB,CAAkF,SAAC0F,GAAD,CAAMC,GAAN,CAAWC,cAAX,CAA2BC,GAA3B,CAAmC,CAC1H,GAAMC,YAAa,QAAKC,eAAL,CAAqBH,cAArB,CAAnB,CACA,GAAMI,aAActQ,EAAE,SAAF,EACjB8D,IADiB,CACZ,CACL,OAAQ,QADH,CAEL,6BAA8B,4BAFzB,CADY,EAKjByM,GALiB,CAKb,QAAKjB,WALQ,CAApB,CAOA,IAAK,GAAInG,GAAI,CAAb,CAAgBA,EAAIiH,WAAW9O,MAA/B,CAAuC6H,GAAvC,CAA4C,CAC1C,GAAMqH,WAAYJ,WAAWjH,CAAX,CAAlB,CACAmH,YAAYxM,IAAZ,CAAiB,QAAU0M,UAAU1P,IAArC,CAA2C0P,UAAUxL,KAArD,CACD,CAED,GAAMyL,WAAYH,YAAYxM,IAAZ,CAAiB,gBAAjB,CAAlB,CACA,GAAI,CAAC7D,qBAAqBwQ,SAArB,CAAL,CAAsC,CACpC,MAAOT,IACR,CAEDM,YAAYxM,IAAZ,CAAiB,OAAjB,CAA0B,QAAK4M,iBAAL,CAAuBD,SAAvB,CAA1B,EACA,MAAOzQ,GAAE,OAAF,EAAWmF,MAAX,CAAkBmL,WAAlB,EAA+BpM,IAA/B,EACR,CArBM,CAuBR,CAjoCY,4DAmoCK6L,OAnoCL,CAmoCc,CACzB,MAAOA,SAAQzF,OAAR,CAAgB,gBAAhB,CAAkC,SAACuF,KAAD,CAAW,CAClD,GAAMjI,OAAQ5H,EAAE6P,KAAF,CAAd,CAEA,GAAIjI,MAAM9D,IAAN,CAAW,4BAAX,IAA6C,4BAAjD,CAA+E,CAC7E,GAAM6M,qBAAsB,EAA5B,CACA,GAAMC,gBAAiB,CAAC,YAAD,CAAe,WAAf,CAAvB,CAEA,IAAK,GAAIzH,GAAI,CAAb,CAAgBA,EAAIyH,eAAetP,MAAnC,CAA2C6H,GAA3C,CAAgD,CAC9C,GAAM0H,eAAgBD,eAAezH,CAAf,CAAtB,CACA,GAAM2H,gBAAiBlJ,MAAM9D,IAAN,CAAW,QAAU+M,aAArB,CAAvB,CACAF,oBAAoBvH,IAApB,CAAyB,CAACyH,aAAD,CAAgB,IAAMC,cAAN,CAAuB,GAAvC,EAA4C1O,IAA5C,CAAiD,GAAjD,CAAzB,CACD,CAED,MAAO,yCAA2CuO,oBAAoBvO,IAApB,CAAyB,GAAzB,CAA3C,CAA2E,GACnF,CAED,MAAOyN,MACR,CAjBM,CAkBR,CAtpCY,4DAwpCKkB,OAxpCL,CAwpCc,CACzB,GAAMC,iBAAkBD,QAAQX,UAAR,CAAmB,4BAAnB,CAAxB,CACA,GAAIY,eAAJ,CAAqB,CACnB,GAAMC,iCAAkCF,QAAQX,UAAR,CAAmB,iBAAnB,EAAsCpL,KAA9E,CACA,KAAK7E,MAAL,CAAY+Q,WAAZ,CAAwB,yCAAxB,CAAmE,EAAnE,CAAuE,CACrED,gCAAiCA,+BADoC,CAAvE,CAGD,CACF,CAhqCY,4FAkqCqBE,EAlqCrB,CAkqCyBjO,QAlqCzB,CAkqCmC,CAC9ClD,EAAEmD,IAAF,CAAOC,OAAP,CAAgB,CACd,SAAU,iDADI,CAEd,kCAAmC+N,EAFrB,CAAhB,CAGG,SAAC5N,QAAD,CAAc,CACfL,SAAS,IAAT,CAAeG,KAAKgE,KAAL,CAAW9D,QAAX,CAAf,CACD,CALD,EAMCC,IAND,CAMM,SAACD,QAAD,CAAc,CAClBL,SAASK,SAASE,YAAT,EAAyBF,SAASG,UAA3C,CACD,CARD,CASD,CA5qCY,8DA8qCMkL,KA9qCN,CA8qCa,CACxBA,MAAMmB,OAAN,CAAgB,KAAKqB,iBAAL,CAAuBxC,MAAMmB,OAA7B,CACjB,CAhrCY,kDAkrCAnB,KAlrCA,CAkrCO,CAClBA,MAAMmB,OAAN,CAAgB,KAAKsB,iBAAL,CAAuBzC,MAAMmB,OAA7B,CACjB,CAprCY,8CAsrCFnB,KAtrCE,CAsrCK,CAChB,GAAMmC,SAAUnC,MAAMO,MAAtB,CACA,KAAKmC,iBAAL,CAAuBP,OAAvB,CACD,CAzrCY,kFA2rCgBQ,EA3rChB,CA2rCoBC,OA3rCpB,CA2rC6B,kBACxC,KAAKC,iCAAL,CAAuCD,QAAQP,+BAA/C,CAAgF,SAACjL,GAAD,CAAM5F,6BAAN,CAAwC,CACtH,GAAI4F,GAAJ,CAAS,CACP0L,QAAQC,YAAR,CAAqBC,aAArB,CAAmCC,KAAnC,CAAyC7L,GAAzC,CACD,CAFD,IAEO,CACL,GAAMnC,QAAS,GAAI3D,oCAAJ,CAAwC,QAAKC,MAA7C,CAAqDC,6BAArD,CAAf,CACAyD,OAAOiO,IAAP,EACD,CACF,CAPD,CAQD,CApsCY,qDAwsCTC,mCAxsCS,YA0sCb,4CAAa5R,MAAb,CAAqB,0DACnB,KAAKA,MAAL,CAAcA,MAAd,CACA,KAAK6R,aAAL,CAAqB,IAArB,CACA,KAAKC,SAAL,CAAiB,KAAjB,CACA,KAAKC,OAAL,CAAe,KAAf,CACA,KAAKC,SAAL,EACD,CAhtCY,4FAktCA,kBACX,KAAKhS,MAAL,CAAYgS,SAAZ,CAAsB,kCAAtB,CAA0D,CACxDpO,MAAO,4CADiD,CAExDqO,QAAS,kBAAM,CACb,QAAKjS,MAAL,CAAYyR,aAAZ,CAA0BE,IAA1B,CAA+B,CAC7B/N,MAAO,4CADsB,CAE7BQ,MAAO,GAFsB,CAG7BE,OAAQ,GAHqB,CAI7B4N,KAAM,CACJ,CAAE1R,KAAM,SAAR,CAAmBG,KAAM,yBAAzB,CAAoDmH,MAAO,OAA3D,CAAoEqK,QAAS,iBAACC,CAAD,CAAO,CAClF,GAAI,CAAC,QAAKN,SAAV,CAAqB,CACnB,QAAKA,SAAL,CAAiB,IAAjB,CACA,QAAKO,6BAAL,CAAmCD,EAAEpD,MAAF,CAASnK,KAA5C,CAAmD,SAACzB,QAAD,CAAc,CAC/D,QAAK0O,SAAL,CAAiB,KAAjB,CACA,GAAI,QAAKC,OAAT,CAAkB,CAChB,QAAKM,6BAAL,CAAmCD,EAAEpD,MAAF,CAASnK,KAA5C,CAAmD,SAACyN,aAAD,CAAmB,CACpE,QAAKC,cAAL,CAAoBD,aAApB,CACD,CAFD,CAGD,CAJD,IAIO,CACL,QAAKC,cAAL,CAAoBnP,QAApB,CACD,CACF,CATD,CAUD,CAZD,IAYO,CACL,QAAK2O,OAAL,CAAe,IAChB,CACF,CAhBD,CADI,CAkBJ,CAACvR,KAAM,OAAP,CAAgBgS,QAAS,uBAAzB,CAAkDhO,KAAM,sDAAxD,CAlBI,CAmBJ,CAAChE,KAAM,WAAP,CAAoBgS,QAAS,0BAA7B,CAAyDC,UAAW,GAApE,CAnBI,CAJuB,CAyB7BC,SAAU,kBAACN,CAAD,CAAO,CACf,GAAIO,cAAe,EAAnB,CACA,GAAIC,0BAA2B,IAA/B,CACA,GAAMC,mBAAoBhT,EAAE,wCAAF,CAA1B,CACA,GAAMiT,+BAAgCD,kBAAkBE,KAAlB,GAA0BpP,IAA1B,CAA+B,kCAA/B,CAAtC,CACA,GAAMqP,4BAA6BH,kBAAkBE,KAAlB,GAA0BpP,IAA1B,CAA+B,oCAA/B,CAAnC,CAEAkP,kBAAkBI,IAAlB,CAAuB,UAAY,CACjC,GAAI3C,WAAYzQ,EAAE,IAAF,EAAQ8D,IAAR,CAAa,qBAAb,CAAhB,CACA,GAAIuP,0BAA2BrT,EAAE,IAAF,EAAQ8D,IAAR,CAAa,kCAAb,CAA/B,CACAgP,cAAgB,qDAAsDO,wBAAtD,CAAgF,eAAhF,CAAiG5C,SAAjG,CAA4G,IAA5H,CACA,GAAI4C,2BAA6BJ,6BAAjC,CAAgE,CAC9DF,yBAA2B,KAC5B,CACF,CAPD,EASA,GAAIA,wBAAJ,CAA8B,CAC5B,QAAK5S,MAAL,CAAYyR,aAAZ,CAA0B0B,OAA1B,CAAkC,6CAAqCH,0BAArC,CAAkE,WAApG,CAAiH,SAASI,SAAT,CAAoB,CACnI,GAAIA,SAAJ,CAAe,CACb,GAAMC,QAASxT,EAAE,UAAF,EAAcyT,GAAd,EAAf,CACA,KAAKC,yBAAL,CAA+BT,6BAA/B,CAA8DO,MAA9D,CACD,CACF,CALD,CAMD,CAED,QAAKrT,MAAL,CAAYwT,aAAZ,CAA0Bb,YAA1B,CACD,CAnD4B,CAA/B,CAqDD,CAxDuD,CAA1D,CA0DD,CA7wCY,4EA+wCaO,wBA/wCb,CA+wCuCG,MA/wCvC,CA+wC+C,CAC1DxT,EAAEmD,IAAF,CAAQC,OAAR,CAAiB,CACf,SAAU,sCADK,CAEf,SAAUoQ,MAFK,CAGf,oBAAqBH,wBAHN,CAAjB,CAIG,SAAC9P,QAAD,CAAc,CAChB,CALD,CAMD,CAtxCY,oFAwxCiBqQ,KAxxCjB,CAwxCwB1Q,QAxxCxB,CAwxCkC,CAC7ClD,EAAE,+BAAF,EAAmCwJ,KAAnC,GACAxJ,EAAE,+BAAF,EAAmCmF,MAAnC,CAA0CnF,EAAE,OAAF,EAAWiE,QAAX,CAAoB,qCAApB,CAA1C,EACAjE,EAAE,4BAAF,EAAgC2E,IAAhC,CAAqC,aAArC,EACA3E,EAAEmD,IAAF,CAAOC,OAAP,CAAgB,CACd,SAAU,4CADI,CAEd,OAAQwQ,KAFM,CAAhB,CAGG,SAACrQ,QAAD,CAAc,CACfvD,EAAE,sCAAF,EAA0C6T,MAA1C,GACA3Q,SAASG,KAAKgE,KAAL,CAAW9D,QAAX,CAAT,CACD,CAND,CAOD,CAnyCY,0EAqyCYoG,MAryCZ,CAqyCoBjJ,MAryCpB,CAqyC4BC,IAryC5B,CAqyCkC,CAC7C,IAAK,GAAIwI,GAAI,CAAb,CAAgBA,EAAIQ,OAAOrI,MAA3B,CAAmC6H,GAAnC,CAAwC,CACtC,GAAIzI,SAAWiJ,OAAOR,CAAP,EAAUS,QAArB,EAAiCjJ,OAASgJ,OAAOR,CAAP,EAAUxI,IAAxD,CAA8D,CAC5D,MAAOgJ,QAAOR,CAAP,EAAUnE,KAClB,CACF,CAED,MAAO,KACR,CA7yCY,kDA+yCA7D,MA/yCA,CA+yCQ,CACnB,GAAM2S,iBAAkB9T,EAAE,OAAF,EAAWiE,QAAX,CAAoB,iCAApB,CAAxB,CACA,GAAMnD,MAAO,KAAKiT,wBAAL,CAA8B5S,OAAOgH,KAArC,CAA4C,KAAK6J,aAAjD,CAAgE,MAAhE,CAAb,CAEA8B,gBAAgB3O,MAAhB,CACEnF,EAAE,KAAF,EACGiE,QADH,CACY,mCADZ,EAEGU,IAFH,CAEQ7D,IAFR,CADF,EAMAsJ,OAAO4J,IAAP,CAAY/T,oBAAZ,EAAkC8E,OAAlC,CAA0C,SAAC0L,SAAD,CAAe,CACvD,GAAMe,SAAUvR,qBAAqBwQ,SAArB,CAAhB,CACAqD,gBAAgB3O,MAAhB,CACEnF,EAAE,KAAF,EACGmF,MADH,CACUnF,EAAE,SAAF,EACPiE,QADO,CACE,+BADF,EAEPH,IAFO,CAEF,CACJ,OAAO,UADH,CAEJ,qCAAsChD,IAFlC,CAGJ,sBAAuB2P,SAHnB,CAIJ,mCAAoCtP,OAAOgQ,EAJvC,CAFE,CADV,EASGhM,MATH,CASUnF,EAAE,QAAF,EAAY2E,IAAZ,CAAiB6M,QAAQzN,KAAzB,CATV,CADF,CAYD,CAdD,EAgBA/D,EAAE,+BAAF,EAAmCmF,MAAnC,CAA0C2O,eAA1C,CACD,CA10CY,sDA40CEvQ,QA50CF,CA40CY,CACvBvD,EAAE,+BAAF,EAAmCwJ,KAAnC,GAEA,GAAIjG,SAASjC,MAAT,GAAoB,CAAxB,CAA2B,CACzBtB,EAAE,4BAAF,EAAgC2E,IAAhC,CAAqC,kDAArC,CACD,CAFD,IAEO,CACL3E,EAAE,4BAAF,EAAgC2E,IAAhC,CAAqC,sDAArC,CACD,CAED,IAAK,GAAIwE,GAAI,CAAb,CAAgBA,EAAI5F,SAASjC,MAA7B,CAAqC6H,GAArC,CAA0C,CACxC,KAAK8K,YAAL,CAAkB1Q,SAAS4F,CAAT,CAAlB,CACD,CAEF,CAz1CY,iDA61CfpJ,QAAQmU,aAAR,CAAsBC,GAAtB,CAA0B,kCAA1B,CAA8D,SAAChU,MAAD,CAAS8M,GAAT,CAAiB,CAC7E,GAAI8E,mCAAJ,CAAuC5R,MAAvC,EACA,GAAIkP,oCAAJ,CAAwClP,MAAxC,CACD,CAHD,CAKD,CAl2CD,EAk2CGJ,OAl2CH,CAk2CYqU,MAl2CZ","file":"plugin.js","sourcesContent":["/* global ajaxurl, tinymce, moment, Promise */\n((tinymce, $) => {\n  \n  const SUPPORTED_COMPONENTS = {\n    'name': {\n      'title': 'Palvelupisteen nimi'\n    },\n    'description': {\n      'title': 'Palvelupisteen kuvaus'\n    },\n    'email': {\n      'title': 'Palvelupisteen sähköpostiosoitteet'\n    },\n    'addresses': {\n      'title': 'Palvelupisteen osoitetiedot'\n    },\n    'fax': {\n      'title': 'Palvelupisteen faksi'\n    },\n    'phone': {\n      'title': 'Palvelupisteen puhelinnumerot'\n    },\n    'servicehours': {\n      'title': 'Palvelupisteen aukioloajat'\n    },\n    'webpages': {\n      'title': 'Palvelupisteen verkkosivustot'\n    }\n  };\n  \n  class ServiceLocationServiceChannelDialog {\n    \n    /**\n     * Constructs service location service channel dialog\n     * \n     * @param {type} editor TinyMCE editor instance\n     * @param {type} serviceLocationServiceChannel\n     */\n    constructor(editor, serviceLocationServiceChannel) {\n      this.serviceLocationServiceChannel = serviceLocationServiceChannel;\n      this.supportedLocales = ['fi', 'en', 'sv'];\n      this.localeNames = {\n        'fi': 'Suomi',\n        'en': 'Englanti',\n        'sv': 'Ruotsi'\n      };\n      \n      this.serviceHourTypeNames = {\n        'Special': 'Päivystys',\n        'Standard': 'Normaali',\n        'Exception': 'Poikkeus'\n      };\n      \n      this.dayNames = {\n        0: 'Sunnuntai',\n        1: 'Maanantai',\n        2: 'Tiistai',\n        3: 'Keskiviikko',\n        4: 'Torstai',\n        5: 'Perjantai',\n        6: 'Lauantai'\n      };\n      \n      this.editor = editor;\n      this.listeners = [];\n      \n      // TODO: Kielet, joilla palvelupisteessä palvellaan\n      // TODO: Phone Numbers\n      // TODO: Web Pages\n    }\n    \n    getLocaleName(locale) {\n      return this.localeNames[locale];\n    }\n    \n    getServiceHourTypeName(type) {\n      return this.serviceHourTypeNames[type];\n    }\n    \n    getDayName(index, short) {\n      const name = this.dayNames[index];\n      if (short) {\n        return name.substring(0, 2);\n      }\n      \n      return name;\n    }\n    \n    formatServiceHour(serviceHour) {\n      const type = this.getServiceHourTypeName(serviceHour.serviceHourType);\n      if (serviceHour.serviceHourType === 'Exception') {\n        let result = `(${type})`;\n        \n        if (serviceHour.isClosed) {\n          result += ' Suljettu';\n        }\n        \n        const openingHour = serviceHour.openingHour && serviceHour.openingHour.length ? serviceHour.openingHour[0] : null;\n        const openFrom = openingHour ? openingHour.from : null;\n        const openTo = openingHour ? openingHour.to : null;\n        \n        if (serviceHour.validFrom && serviceHour.validTo) {\n          result += ` ${this.formatDateWithTime(serviceHour.validFrom, openFrom)} - ${this.formatDateWithTime(serviceHour.validTo, openTo)}`;\n        } else if (serviceHour.validFrom) {\n          result += ` ${this.formatDateWithTimes(serviceHour.validFrom, openFrom, openTo)}`;\n        }\n        \n        const additionalInformation = this.getAnyLocalizedValue(serviceHour.additionalInformation);\n        if (additionalInformation) {\n          return `${result} - ${additionalInformation}`;\n        }\n        \n        return result;\n      } else {\n        if (serviceHour.openingHour.length === 0 && !serviceHour.isClosed) {\n          return `(${type}) Aina avoinna (24/7)`;\n        }\n        \n        const openingHours = serviceHour.openingHour.map((openingHour) => {\n          return this.formatOpeningHour(openingHour);\n        });\n\n        return `(${type}) ${openingHours.join(',')}`;\n      }\n    }\n    \n    formatDateTime(dateTime) {\n      return moment(dateTime).locale('fi').format('lll');\n    }\n    \n    formatDate(date) {\n      return moment(date).locale('fi').format('ll');\n    }\n    \n    formatDateWithTime(date, time) {\n      const result = this.formatDate(date);\n      if (time) {\n        return `${result} ${time}`;\n      }\n      \n      return result;\n    }\n    \n    formatDateWithTimes(date, startTime, endTime) {\n      const start = this.formatDateWithTime(date, startTime);\n      return endTime ? `${start} - ${endTime}` : start;\n    }\n    \n    formatOpeningHour(dailyOpeningTime) {\n      if (dailyOpeningTime.dayFrom === null) {\n        return '';\n      } else {\n        let result = this.getDayName(dailyOpeningTime.dayFrom, true);\n\n        if (dailyOpeningTime.dayTo !== null && dailyOpeningTime.dayTo !== dailyOpeningTime.dayFrom) {\n          result += ' - ' + this.getDayName(dailyOpeningTime.dayTo, true);\n        }\n\n        if (dailyOpeningTime.from) {\n          result += ' ' + dailyOpeningTime.from;\n        }\n\n        if (dailyOpeningTime.to) {\n          result += ' - ' + dailyOpeningTime.to;\n        }\n\n        return result;\n      }\n    }\n    \n    saveServiceLocationServiceChannel(serviceLocationServiceChannel, callback) {\n      $.post(ajaxurl, {\n        'action': 'kunta_api_save_service_location_service_channel',\n        'serviceLocationServiceChannel': JSON.stringify(this.serviceLocationServiceChannel)\n      }, (response) => {\n        callback();\n      })\n      .fail((response) => {\n        callback(response.responseText || response.statusText || \"Unknown error occurred\");\n      });\n    }\n    \n    openMetaformDialog(viewModel, formValues, callback) {\n      const dialog = $('<div>')\n        .attr({\n          'title': viewModel.title\n        });\n      \n      const dialogContents = $('<div>')\n        .addClass('container-fluid')\n        .html(mfRender({\n          viewModel: viewModel,\n          formValues: formValues\n        }))\n        .appendTo(dialog);\n      \n      $(dialog).dialog({\n        modal: true,\n        draggable: false,\n        width: $(window).width() * 0.9,\n        height: $(window).height() * 0.9,\n        buttons: [{\n          text: \"Tallenna\",\n          click: () => {\n            const formValues = {};\n            \n            $(dialog).find(`form.metaform`).metaform('val', true).forEach((value) => {\n              formValues[value.name] = value.value;\n            });\n            \n            callback(formValues);\n            $(dialog).dialog(\"close\");\n          }\n        }, {\n          text: \"Peruuta\",\n          click: () => {\n            $(dialog).dialog(\"close\");\n          }\n        }]\n      });\n       \n      $(dialog).find('form.metaform').metaform();\n      \n      return dialog;\n    }\n    \n    openLocalizedMetaformDialog(viewModel, formValues, callback) {\n      const dialog = $('<div>')\n        .attr({\n          'title': viewModel.title\n        });\n      \n      const dialogContents = $('<div>')\n        .addClass('container-fluid')\n        .appendTo(dialog);\n      \n      const dialogTabs = $('<ul>').appendTo(dialogContents);\n     \n      this.supportedLocales.forEach((locale) => {\n        const tabId = `locale-tab-${locale}`;\n        \n        $('<li>')\n          .appendTo(dialogTabs)\n          .append($('<a>').attr('href', `#${tabId}`).text(this.getLocaleName(locale)));\n\n        $('<div>')\n          .attr('id', tabId)\n          .html(mfRender({\n            viewModel: viewModel,\n            formValues: formValues[locale]\n          }))\n          .appendTo(dialogContents);\n      });\n      \n      dialogContents.tabs();\n      \n      $(dialog).dialog({\n        modal: true,\n        draggable: false,\n        width: $(window).width() * 0.9,\n        height: $(window).height() * 0.9,\n        buttons: [{\n          text: \"Tallenna\",\n          click: () => {\n            const formValues = {};\n            this.supportedLocales.forEach((locale) => {\n              formValues[locale] = {};\n              $(dialog).find(`#locale-tab-${locale} form.metaform`).metaform('val', true).forEach((value) => {\n                formValues[locale][value.name] = value.value;\n              });\n            });\n            \n            callback(formValues);\n          }\n        }, {\n          text: \"Peruuta\",\n          click: () => {\n            $(dialog).dialog(\"close\");\n          }\n        }]\n      });\n       \n      $(dialog).find('form.metaform').metaform();\n      \n      return dialog;\n    }\n    \n    open() {\n      const viewModel = getServiceLocationServiceChannelMetaform();\n      const formValues = {};\n      this.supportedLocales.map((locale) => {\n        formValues[locale] = this.serviceLocationServiceChannelToForm(locale, this.serviceLocationServiceChannel);\n      });\n      \n      const dialog = this.openLocalizedMetaformDialog(viewModel, formValues, (newFormValues) => {\n        dialog.dialog(\"widget\").addClass('loading');\n        \n        const updatedChannel = this.translateServiceLocationServiceChannelFromForm(this.serviceLocationServiceChannel, newFormValues);\n        const validationError = this.validate(updatedChannel);\n        \n        if (validationError !== null) {\n          this.showError('Virheellinen syöte', validationError);\n        } else {\n          this.serviceLocationServiceChannel = updatedChannel;\n          \n          this.saveServiceLocationServiceChannel(this.serviceLocationServiceChannel, (err) => {\n            dialog.dialog(\"widget\").removeClass('loading');\n            if (err) {\n              this.showError('Virhe tallentaessa', err);\n            } else {\n              dialog.dialog('close'); \n            }\n          });\n        }\n      });\n      \n      $(dialog).on('click', '.add-service-hour', this._onAddServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-service-hour', this._onEditServiceHourClick.bind(this));\n      $(dialog).on('click', '.remove-service-hour', this._onRemoveServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-additional-details', this._onEditAdditionalDetailsClick.bind(this));\n      \n      this.redrawServiceHours();\n    }\n    \n    openServiceHourEditDialog(serviceHour, callback) {\n      const viewModel = getServiceHourMetaform();\n      const formValues = this.serviceHourToForm(serviceHour);\n      const dialog = this.openMetaformDialog(this.prepareViewModel(viewModel), formValues, (newFormValues) => {\n        const updatedServiceHour = this.serviceHourFromForm(newFormValues);\n        callback(updatedServiceHour);\n      });\n    }\n    \n    searchCodes(types, search) {\n      return new Promise((resolve, reject) => {\n        $.post(ajaxurl, {\n          'action': 'kunta_api_search_codes',\n          'types': types,\n          'search': search\n        }, (response) => {\n          const codes = JSON.parse(response);\n          resolve(codes);\n        })\n        .fail((response) => {\n          reject(response.responseText || response.statusText);\n        });\n      });\n    }\n    \n    openAdditionalDetailsEditDialog() {\n      const viewModel = getAdditionalDetailsMetaform();\n      this.additionalDetailsToForm(this.serviceLocationServiceChannel).then((formValues) => {\n        const dialog = this.openMetaformDialog(this.prepareViewModel(viewModel), formValues, (newFormValues) => {\n          this.additionalDetailsFromForm(newFormValues);\n        });\n\n        dialog.find('*[data-name=\"languages\"]')\n          .metaformMultivalueAutocomplete('val', formValues.languageCodes)\n          .metaformMultivalueAutocomplete('option', 'customSource', (input, callback) => {\n            this.searchCodes(\"Language\", input.term + '*')\n              .then((codes) => {\n                callback(codes.map((codeItem) => {\n                  return {\n                    value: `${codeItem.type}:${codeItem.code}`,\n                    label: this.getLocalizedValue(codeItem.names, 'fi')\n                  };\n                }));\n              })\n              .catch((err) => {\n                console.error(err);\n              });\n          });\n\n        dialog.find('*[data-name=\"areas\"]')\n          .metaformMultivalueAutocomplete('val', formValues.areaCodes)\n          .metaformMultivalueAutocomplete('option', 'customSource', (input, callback) => {\n            this.searchCodes(\"Municipality,Province,HospitalRegions,BusinessRegions\", input.term + '*')\n              .then((codes) => {\n                callback(codes.map((areaCode) => {\n                  return {\n                    value: `${areaCode.type}:${areaCode.code}`,\n                    label: this.getCodeNameWithType(areaCode)\n                  };\n                }));\n              })\n              .catch((err) => {\n                console.error(err);\n              });\n          });\n      \n      });\n      \n    }\n    \n    getCodeTypeName(type) {\n       switch (type) {\n        case 'Municipality':\n          return 'kunta';\n        case 'Province':\n          return 'maakunta';\n        case 'HospitalRegions':\n          return 'sairaanhoitopiiri';\n        case 'BusinessRegions':\n          return 'yrityspalvelujen seutualue';\n        case 'Country':\n          return 'maa';\n        case 'Language':\n          return 'kieli';\n        case 'Postal':\n          return 'postinumero';\n      }\n    }\n    \n    getCodeNameWithType(codeItem) {\n      const name = this.getLocalizedValue(codeItem.names, 'fi');\n      const type = this.getCodeTypeName(codeItem.type);\n      return `${name} (${type})`;\n    }\n    \n    getMunicipalityNameWithType(municipality) {\n      const name = this.getLocalizedValue(municipality.names, 'fi');\n      const type = this.getCodeTypeName('Municipality');\n      return `${name} (${type})`;\n    }\n    \n    showError(title, text) {\n      const contents = $('<div>')\n        .addClass('error')\n        .text(text);\n      \n      const dialog = $('<div>')\n        .attr('title', title)\n        .append(contents)\n        .dialog({\n          modal: true,\n          draggable: false,\n          width: 600,\n          height: 350,\n          buttons: {\n            Ok: () => {\n              $(dialog).dialog( \"close\" );\n            }\n          }\n        });\n    }\n    \n    validate(serviceLocationServiceChannel) {\n      const addressSubtypes = [];\n      \n      for (let j = 0; j < serviceLocationServiceChannel.addresses.length; j++) {\n        const address = serviceLocationServiceChannel.addresses[j];\n        if (address.subtype === \"Abroad\" || address.subtype === \"Single\") {\n          for (let i = 0; i < addressSubtypes.length; i++) {\n            if (addressSubtypes[i] !== address.subtype) {\n              return \"Toimipisteellä ei voi olla yhtäaikaa kotimaista ja ulkomaista osoitetta\"; \n            }\n          }\n        }\n        \n        addressSubtypes.push(address.subtype);\n      }\n      \n      return null;\n    }\n    \n    redrawServiceHours() {\n      const serviceHourTexts = this.serviceLocationServiceChannel.serviceHours.map((serviceHour) => {\n        return this.formatServiceHour(serviceHour);\n      });\n      \n      $('table.serviceHours tbody').empty();\n      \n      if (serviceHourTexts.length) {\n        serviceHourTexts.forEach((serviceHourText) => {\n          const row = $('<tr>').appendTo($('table.serviceHours tbody'));\n          $('<td>').html(serviceHourText).appendTo(row);\n          $('<td>').append($('<a>').addClass('btn btn-sm btn-warning remove-service-hour').html('Poista')).appendTo(row);\n          $('<td>').append($('<a>').addClass('btn btn-sm btn-success edit-service-hour').html('Muokkaa')).appendTo(row);\n        });\n      } else {\n        $('<tr>')\n          .append($('<td>').html('Palveluaikoja ei ole vielä määritelty'))\n          .appendTo($('table.serviceHours tbody'));\n      }\n    }\n    \n    getTypedLocalizedValue(values, locale, type) {\n      if (!values) {\n        return null;\n      }\n      \n      for (let i = 0; i < values.length; i++) {\n        if (locale === values[i].language && type === values[i].type) {\n          return values[i].value;\n        }\n      }\n      \n      return null;\n    }\n    \n    getLocalizedValue(values, locale) {\n      if (!values) {\n        return null;\n      }\n      \n      for (let i = 0; i < values.length; i++) {\n        if (locale === values[i].language) {\n          return values[i].value;\n        }\n      }\n      \n      return null;\n    }\n    \n    getAnyLocalizedValue(values) {\n      for (let i = 0; i < this.supportedLocales.length; i++) {\n        const result = this.getLocalizedValue(values, this.supportedLocales[i]);\n        if (result) {\n          return result;\n        }\n      }\n      \n      return null;\n    }\n    \n    prepareViewModel(viewModel) {\n      (viewModel.sections||[]).forEach((section) => {\n        (section.fields||[]).forEach((field, index) => {\n          const localeVariableIndex = field.name.indexOf('{LOCALE}');\n          if (localeVariableIndex !== -1) {\n            section.fields.splice(index, 1);\n            \n            this.supportedLocales.forEach((locale) => {\n              section.fields.splice(index, 0, Object.assign({}, field, {\n                name: field.name.replace(/\\{LOCALE\\}/g, locale),\n                title: field.title.replace(/\\{LOCALE\\}/g, this.getLocaleName(locale))\n              }));   \n            });\n          }\n        });\n      });\n      \n      return viewModel;\n    }\n    \n    serviceHourFromFormException(formValues) {\n      const additionalInformation = [];\n      const isClosed = formValues.type === 'closed-all-day';\n      const validForNow = false;\n      const toTime = isClosed ? null : formValues[`Exception-to-time`];\n      const fromTime = isClosed ? null : formValues[`Exception-from-time`];\n      const openingHour = [];\n      \n      if (toTime || fromTime) {\n        openingHour.push({\n          dayFrom: null,\n          dayTo: null,\n          from: fromTime,\n          to: toTime,\n          isExtra: false\n        });\n      }\n      \n      this.supportedLocales.forEach((locale) => {\n        const value = formValues[`Exception-additional-information-${locale}`];\n        if (value) {\n          additionalInformation.push({\n            language: locale,\n            value: value\n          });  \n        }\n      });\n      \n      return {\n        serviceHourType: formValues.type,\n        validFrom: this.parseIsoDate(formValues[`Exception-from-date`]),\n        validTo: this.parseIsoDate(formValues[`Exception-to-date`]),\n        isClosed: isClosed,\n        validForNow: validForNow,\n        additionalInformation: additionalInformation,\n        openingHour: openingHour\n      };\n    }\n    \n    serviceHourFromFormStandard(formValues) {\n      const isClosed = false;\n      const validForNow = formValues[`${formValues.type}-validForNow`] === \"true\";\n      const additionalInformation = [];\n      const serviceHours = JSON.parse(formValues['Standard-openinghours']);\n      const openingHour = formValues['Standard-open24h'] ? [] : serviceHours.map((serviceHour) => {\n        return {\n          dayFrom: parseInt(serviceHour.day),\n          dayTo: parseInt(serviceHour.day),\n          from: serviceHour.from,\n          to: serviceHour.to,\n          isExtra: false\n        };\n      });\n      \n      return {\n        serviceHourType: formValues.type,\n        validFrom: validForNow ? null : this.parseIsoDate(formValues[`${formValues.type}-validFrom`]),\n        validTo: validForNow ? null : this.parseIsoDate(formValues[`${formValues.type}-validTo`]),\n        isClosed: isClosed,\n        validForNow: validForNow,\n        additionalInformation: additionalInformation,\n        openingHour: openingHour\n      };\n    }\n    \n    serviceHourFromFormSpecial(formValues) {\n      const isClosed = false;\n      const validForNow = formValues[`${formValues.type}-validForNow`] === \"true\";\n      const additionalInformation = [];\n      const openingHour = [{\n        dayFrom: parseInt(formValues['Special-from-date']),\n        dayTo: parseInt(formValues['Special-to-date']),\n        from: formValues['Special-from-time'],\n        to: formValues['Special-to-time'],\n        isExtra: false\n      }];\n    \n      return {\n        serviceHourType: formValues.type,\n        validFrom: validForNow ? null : this.parseIsoDate(formValues[`${formValues.type}-validFrom`]),\n        validTo: validForNow ? null : this.parseIsoDate(formValues[`${formValues.type}-validTo`]),\n        isClosed: isClosed,\n        validForNow: validForNow,\n        additionalInformation: additionalInformation,\n        openingHour: openingHour\n      };\n    }\n    \n    serviceHourFromForm(formValues) {\n      const serviceHourType = formValues.type;\n      switch (serviceHourType) {\n        case \"Exception\":\n          return this.serviceHourFromFormException(formValues);\n        case \"Standard\":\n          return this.serviceHourFromFormStandard(formValues);\n        case \"Special\":\n          return this.serviceHourFromFormSpecial(formValues);\n      };\n    }\n    \n    translateServiceLocationServiceChannelFromForm(existingLocationServiceChannel, formValues) {\n      const serviceLocationServiceChannel = JSON.parse(JSON.stringify(existingLocationServiceChannel));\n      serviceLocationServiceChannel.addresses = [];\n      serviceLocationServiceChannel.descriptions = [];\n      serviceLocationServiceChannel.emails = [];\n      serviceLocationServiceChannel.phoneNumbers = [];\n      \n      this.supportedLocales.forEach((locale) => {\n        const localeValues = formValues[locale];\n        \n        const localeAddresses = JSON.parse(localeValues.addresses).filter((address) => {\n          return !!address.street && !!address.street.trim();\n        });\n        \n        localeAddresses.forEach((localeAddress, addressIndex) => {\n          let address;\n          if (serviceLocationServiceChannel.addresses.length - 1 < addressIndex) {\n            address = {\n              additionalInformations: [],\n              streetAddress: [],\n              subtype: 'Single',\n              type: 'Location',\n              country: 'FI'\n            };\n            \n            serviceLocationServiceChannel.addresses.push(address);\n          } else {\n            address = serviceLocationServiceChannel.addresses[addressIndex];\n          }\n          \n          if (localeAddress.additionalInformation) {\n            localeAddress.additionalInformation = localeAddress.additionalInformation.trim();\n          }\n          \n          if (localeAddress.additionalInformation) {\n            address.additionalInformations.push({\n              \"language\": locale,\n              \"value\": localeAddress.additionalInformation\n            });\n          }\n        \n          address.streetAddress.push({\n            \"language\": locale,\n            \"value\": localeAddress.street\n          });\n          \n          address.postalCode = localeAddress.postOfficeCode;\n          address.streetNumber = localeAddress.streetNumber;\n        });\n        \n        const foreignAddresses = JSON.parse(localeValues.foreignAddresses).filter((address) => {\n          return !!address.foreign;\n        });\n        \n        foreignAddresses.forEach((foreignAddress, foreignAddressIndex) => {\n          const addressIndex = localeAddresses.length + foreignAddressIndex;\n          \n          let address;\n          if (serviceLocationServiceChannel.addresses.length - 1 < addressIndex) {\n            address = {\n              subtype: 'Abroad',\n              type: 'Location',\n              locationAbroad: []\n            };            \n            serviceLocationServiceChannel.addresses.push(address);\n          } else {\n            address = serviceLocationServiceChannel.addresses[addressIndex];\n          }\n          \n          address.locationAbroad.push({\n            \"language\": locale,\n            \"value\": foreignAddress.foreign\n          });\n        });\n        \n        serviceLocationServiceChannel.emails = serviceLocationServiceChannel.emails.concat(\n          JSON.parse(localeValues.emails)\n            .filter((email) => {\n              return !!email.email;\n            })\n            .map((email) => {\n              return {\n                \"language\": locale,\n                \"value\": email.email\n              };\n            })\n        );\n\n        serviceLocationServiceChannel.phoneNumbers = serviceLocationServiceChannel.phoneNumbers.concat(\n          JSON.parse(localeValues.phoneNumbers)\n            .filter((phoneNumber) => {\n              return !!phoneNumber.prefixNumber && !!phoneNumber.number;\n            })\n            .map((phoneNumber) => {\n              return Object.assign(phoneNumber, {\n                \"type\": \"Phone\",\n                \"language\": locale,\n                \"isFinnishServiceNumber\": phoneNumber.isFinnishServiceNumber === \"true\"\n              });\n            })\n        );\n\n        serviceLocationServiceChannel.phoneNumbers = serviceLocationServiceChannel.phoneNumbers.concat(\n          JSON.parse(localeValues.faxes)\n            .filter((fax) => {\n              return !!fax.prefixNumber && !!fax.number;\n            })\n            .map((fax) => {\n              return {\n                \"type\": \"Fax\",\n                \"language\": locale,\n                \"number\": fax.number,\n                \"prefixNumber\": fax.prefixNumber,\n                \"isFinnishServiceNumber\": false\n              };\n            })\n        );\n\n        serviceLocationServiceChannel.webPages = serviceLocationServiceChannel.webPages.concat(\n          JSON.parse(localeValues.webPages)\n            .filter((webPage) => {\n              return !!webPage.url;\n            })\n            .map((webPage) => {\n              return Object.assign(webPage, {\n                \"language\": locale\n              });\n            })\n        );\n        \n        if (localeValues.description) {\n          localeValues.description = localeValues.description.trim();\n        }\n        \n        if (localeValues.description) {\n          serviceLocationServiceChannel.descriptions.push({\n            \"language\": locale,\n            \"value\": localeValues.description,\n            \"type\": \"Description\"\n          });\n        }\n        \n        if (localeValues.shortDescription) {\n          localeValues.shortDescription = localeValues.shortDescription.trim();\n        }\n      \n        if (localeValues.shortDescription) {\n          serviceLocationServiceChannel.descriptions.push({\n            \"language\": locale,\n            \"value\": localeValues.shortDescription,\n            \"type\": \"ShortDescription\"\n          });\n        }\n      });\n      \n      return serviceLocationServiceChannel;\n    }\n    \n    serviceHourToForm(serviceHour) {\n      if (!serviceHour) {\n        return {};\n      }\n      \n      const type = serviceHour.serviceHourType;\n      const validForNow = serviceHour.validForNow ? \"true\" : \"false\";\n      const validFrom = serviceHour.validForNow || !serviceHour.validFrom ? null : moment(serviceHour.validFrom);\n      const validTo = serviceHour.validForNow || !serviceHour.validTo ? null : moment(serviceHour.validTo);\n      const open24h = serviceHour.openingHour.length === 0 && !serviceHour.isClosed;\n      const validFromStr = validFrom ? validFrom.format() : null;\n      const validToStr = validTo ? validTo.format() : null;\n      const openingHour = serviceHour.openingHour && serviceHour.openingHour.length ? serviceHour.openingHour[0] : null;\n      const openingHours = [];\n          \n      (serviceHour.openingHour||[]).forEach((openingHour) => {\n        for (let day = openingHour.dayFrom; day <= openingHour.dayTo; day++) {\n          openingHours.push({\n            day: day,\n            from: openingHour.from,\n            to: openingHour.to\n          });\n        };\n      });\n      \n      switch (type) {\n        case 'Standard':\n          return {\n            'type': type,\n            'Standard-validForNow': validForNow,\n            'Standard-validFrom': validFromStr,\n            'Standard-validTo': validToStr,\n            'Standard-open24h': open24h,\n            'Standard-openinghours': openingHours\n          };\n        case 'Special':\n          return {\n            'type': type,\n            'Special-validForNow': validForNow,\n            'Special-validFrom': validFromStr,\n            'Special-validTo': validToStr,\n            'Special-from-date': openingHour ? openingHour.dayFrom : null,\n            'Special-from-time': openingHour ? openingHour.from : null,\n            'Special-to-date': openingHour ? openingHour.dayTo : null,\n            'Special-to-time': openingHour ? openingHour.to : null\n          };\n        case 'Exception':\n          const openFrom = openingHour ? openingHour.from : null;\n          const openTo = openingHour ? openingHour.to : null;\n          const exceptionType = !validTo ? !openFrom && !openTo ? 'closed-all-day' : 'single' : 'range';\n          \n          if (validFrom && openFrom) {\n            const parts = openFrom.split(':');\n            validFrom.hour(parseInt(parts[0]));\n            validFrom.minute(parseInt(parts[1]));\n          }\n          \n          if (validTo && openTo) {\n            const parts = openTo.split(':');\n            validTo.hour(parseInt(parts[0]));\n            validTo.minute(parseInt(parts[1]));\n          }\n          \n          const result = {\n            'type': type,\n            'Exception-type': exceptionType,\n            'Exception-from-date': validFrom ? validFrom.format() : null,\n            'Exception-to-date': validTo ? validTo.format() : null,\n            'Exception-from-time': openFrom,\n            'Exception-to-time': openTo\n          };\n          \n          this.supportedLocales.forEach((locale) => {\n            result[`Exception-additional-information-${locale}`] = this.getLocalizedValue(serviceHour.additionalInformation, locale);\n          });\n          \n          return result;\n        default:\n          throw new Error(`Unknown service hour type ${type}`);\n        break;\n      }\n    }\n    \n    additionalDetailsToForm(serviceLocationServiceChannel) {\n      const languageQuery = serviceLocationServiceChannel.languages.map((language) => {\n        return `code:${language}`;\n      }).join(' ');\n      \n      return this.searchCodes(\"Language\", `+(${languageQuery})`)\n        .then((languageQueryResult) => {\n          const languageMap = {};\n          languageQueryResult.forEach((queryResult) => {\n            languageMap[queryResult.code] = this.getLocalizedValue(queryResult.names, 'fi');\n          });\n  \n          const languageCodes = serviceLocationServiceChannel.languages.map((language) => {\n            return {\n              value: language,\n              label: languageMap[language] || language\n            };\n          });\n          \n          const areaCodes = [];\n          serviceLocationServiceChannel.areas.forEach((area) => {\n            if (area.type !== 'Municipality') {\n              areaCodes.push({\n                value: `${area.type}:${area.code}`,\n                label: this.getCodeNameWithType(area)\n              });\n            } else {\n              area.municipalities.forEach((municipality) => {\n                areaCodes.push({\n                  value: `Municipality:${municipality.code}`,\n                  label: this.getMunicipalityNameWithType(municipality)\n                });\n              });\n            }\n          });\n          \n          return {\n            languageCodes: languageCodes,\n            areaCodes: areaCodes,\n            areaType: serviceLocationServiceChannel.areaType\n          };\n        });\n    }\n    \n    \n    additionalDetailsFromForm(newFormValues) {\n      this.serviceLocationServiceChannel.areaType = newFormValues.areaType;\n      this.serviceLocationServiceChannel.languages = (newFormValues.languages||'').split(',');\n      \n      if (newFormValues.areaType === 'AreaType') {\n        let mucicipalitiesIndex = -1;\n        const areas = [];\n        \n        (newFormValues.areas||'').split(',').forEach((area) => {\n          const parts = area.split(':');\n          const type = parts[0];\n          const code = parts[1];\n          \n          if (type === 'Municipality') {\n            if (mucicipalitiesIndex > -1) {\n              areas[mucicipalitiesIndex].municipalities.push({\n                code: code\n              });\n            } else {\n              mucicipalitiesIndex = areas.push({\n                'type': 'Municipality',\n                'municipalities': [{\n                  code: code\n                }]\n              }) - 1;\n            }\n          } else {\n            areas.push({\n              type: type,\n              code: code\n            });\n          }\n        });\n        \n        this.serviceLocationServiceChannel.areas = areas;\n      }\n    }\n   \n    serviceLocationServiceChannelToForm(locale, serviceLocationServiceChannel) {\n      const name = this.getTypedLocalizedValue(serviceLocationServiceChannel.names, locale, 'Name');\n      const shortDescription = this.getTypedLocalizedValue(serviceLocationServiceChannel.descriptions, locale, 'ShortDescription');\n      const description = this.getTypedLocalizedValue(serviceLocationServiceChannel.descriptions, locale, 'Description');\n      const visitAddresses = serviceLocationServiceChannel.addresses.filter((address) => {\n        return address.subtype !== 'Abroad';\n      });\n      \n      const foreignAddresses = serviceLocationServiceChannel.addresses.filter((address) => {\n        return address.subtype === 'Abroad';\n      });\n      \n      const emails = serviceLocationServiceChannel.emails.filter((email) => {\n        return locale === email.language;\n      });\n      \n      const faxes = serviceLocationServiceChannel.phoneNumbers.filter((phoneNumber) => {\n        return phoneNumber.type === 'Fax' && locale === phoneNumber.language;\n      });\n      \n      const phoneNumbers = serviceLocationServiceChannel.phoneNumbers.filter((phoneNumber) => {\n        return phoneNumber.type === 'Phone' && locale === phoneNumber.language;\n      });\n      \n      const webPages = serviceLocationServiceChannel.webPages.filter((webPage) => {\n        return locale === webPage.language;\n      });\n      \n      const addresses = visitAddresses.map((address) => {\n        return {\n          street: this.getLocalizedValue(address.streetAddress, locale),\n          streetNumber: address.streetNumber,\n          postOfficeCode: address.postalCode,\n          additionalInformation: this.getLocalizedValue(address.additionalInformations, locale) \n        };\n      });\n      \n      return {\n        name: name,\n        description: description,\n        shortDescription: shortDescription,\n        addresses: addresses,\n        emails: emails.map((email) => {\n          return {\n            email: email.value\n          };\n        }),\n        phoneNumbers: phoneNumbers.map((phoneNumber) => {\n          return Object.assign(phoneNumber, {\n            isFinnishServiceNumber: phoneNumber.isFinnishServiceNumber ? 'true' : 'false'\n          });\n        }),\n        faxes: faxes,\n        foreignAddresses: foreignAddresses.map((foreignAddress) => {\n          return {\n            foreign: this.getLocalizedValue(foreignAddress.locationAbroad, locale)\n          };\n        }),\n        webPages: webPages\n      };\n    }\n    \n    parseIsoDate(string) {\n      if (!string) {\n        return null;\n      }\n      \n      return new Date(Date.parse(string));\n    }\n    \n    trigger (event, data) {\n      this.listeners.forEach((listener) => {\n        if (listener.event === event) {\n          listener.callable(data||{});\n        }\n      });\n    }\n    \n    on (event, callable) {\n      this.listeners.push({\n        event: event,\n        callable: callable\n      });\n    }\n    \n    _onAddServiceHourClick(event) {\n      this.openServiceHourEditDialog(null, (createdServiceHour) => {\n        this.serviceLocationServiceChannel.serviceHours.push(createdServiceHour);\n        this.redrawServiceHours();\n      });\n    }\n    \n    _onEditAdditionalDetailsClick() {\n      this.openAdditionalDetailsEditDialog(this.serviceLocationServiceChannel);\n    }\n    \n    _onEditServiceHourClick(event) {\n      const row = $(event.target).closest('tr');\n      const index = row.index();\n      const serviceHour = this.serviceLocationServiceChannel.serviceHours[index];\n      \n      this.openServiceHourEditDialog(serviceHour, (updatedServiceHour) => {\n        this.serviceLocationServiceChannel.serviceHours.splice(index, 1, updatedServiceHour);\n        this.redrawServiceHours();\n      });\n    }\n    \n    _onRemoveServiceHourClick(event) {\n      const row = $(event.target).closest('tr');\n      const index = row.index();\n      this.serviceLocationServiceChannel.serviceHours.splice(index, 1);\n      this.redrawServiceHours();\n    }\n    \n  }\n  \n  class ServiceLocationServiceChannelEditor {\n    \n    constructor (editor) {\n      this.buttonStyle = {\n        'color': '#555',\n        'width': '100%',\n        'border': '1px solid #ccc',\n        'background': '#f7f7f7',\n        'display': 'block',\n        'padding': '5px',\n        'margin-top': '5px',\n        'margin-bottom': '5px',\n        'cursor': 'pointer'\n      };\n      \n      this.editor = editor;\n      \n      this.editor.on('BeforeSetcontent', this.onBeforeSetcontent.bind(this));\n      this.editor.on('GetContent', this.onGetContent.bind(this));\n      this.editor.on('DblClick', this.onDblClick.bind(this));\n      this.editor.addCommand('kunta-api-service-location-channel-edit', this.onServiceLocationChannelEdit.bind(this));\n    }\n    \n    parseAttributes (string) {\n      const result = [];\n      const re = /([a-zA-Z-_]*)(\\=\\\")([a-zA-Z0-9-]*)(\\\")/g;\n      let match = null;\n      \n      do {\n        match = re.exec(string);\n        if (match && match.length > 3) {\n          result.push({\n            name: match[1],\n            value: match[3] \n          });\n        }\n      } while (match);\n\n      return result;\n    }\n    \n    getComponentTitle (name) {\n      return SUPPORTED_COMPONENTS[name].title;\n    }\n    \n    replaceShortcodes(content) {\n      return content.replace(/(\\[kunta_api_location_channel_component)([a-zA-Z0-9 -=]*)(\\])/g, (all, tag, attributesText, end) => {\n        const attributes = this.parseAttributes(attributesText);\n        const placeholder = $('<input>')\n          .attr({\n           'type': 'button',\n           'data-kunta-api-placeholder': 'location_channel_component'\n          })\n          .css(this.buttonStyle);\n          \n        for (let i = 0; i < attributes.length; i++) {\n          const attribute = attributes[i];\n          placeholder.attr('data-' + attribute.name, attribute.value);\n        }\n        \n        const component = placeholder.attr('data-component');\n        if (!SUPPORTED_COMPONENTS[component]) {\n          return all;\n        }\n        \n        placeholder.attr('value', this.getComponentTitle(component));\n        return $('<div>').append(placeholder).html();\n      });\n      \n    }\n    \n    restoreShortcodes(content) {\n      return content.replace(/<input [^>]+>/g, (match) => {\n        const input = $(match);\n        \n        if (input.attr('data-kunta-api-placeholder') === 'location_channel_component') {\n          const shortcodeAttributes = [];\n          const attributeNames = ['channel-id', 'component'];\n          \n          for (let i = 0; i < attributeNames.length; i++) {\n            const attributeName = attributeNames[i];\n            const attributeValue = input.attr('data-' + attributeName);\n            shortcodeAttributes.push([attributeName, '\"' + attributeValue + '\"'].join('='));\n          }\n          \n          return '[kunta_api_location_channel_component ' + shortcodeAttributes.join(' ') + ']';\n        }\n        \n        return match;\n      });\n    }\n    \n    openElementEditor(element) {\n      const placeholderAttr = element.attributes['data-kunta-api-placeholder'];\n      if (placeholderAttr) {\n        const serviceLocationServiceChannelId = element.attributes['data-channel-id'].value;\n        this.editor.execCommand('kunta-api-service-location-channel-edit', '', {\n          serviceLocationServiceChannelId: serviceLocationServiceChannelId\n        });\n      }\n    }\n    \n    findServiceLocationServiceChannel(id, callback) {\n      $.post(ajaxurl, {\n        'action': 'kunta_api_load_service_location_service_channel',\n        'serviceLocationServiceChannelId': id\n      }, (response) => {\n        callback(null, JSON.parse(response));\n      })\n      .fail((response) => {\n        callback(response.responseText || response.statusText);\n      });\n    }\n      \n    onBeforeSetcontent(event) {\n      event.content = this.replaceShortcodes(event.content);\n    }\n    \n    onGetContent(event) {\n      event.content = this.restoreShortcodes(event.content);\n    }\n    \n    onDblClick(event) {\n      const element = event.target;\n      this.openElementEditor(element);\n    }\n\n    onServiceLocationChannelEdit(ui, options) {\n      this.findServiceLocationServiceChannel(options.serviceLocationServiceChannelId, (err, serviceLocationServiceChannel) => {\n        if (err) {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        } else {\n          const dialog = new ServiceLocationServiceChannelDialog(this.editor, serviceLocationServiceChannel);\n          dialog.open();\n        }\n      });\n    } \n    \n  }\n  \n  class ServiceLocationServiceChannelEmbed {\n    \n    constructor (editor) {\n      this.editor = editor;\n      this.displayLocale = 'fi';\n      this.searching = false;\n      this.pending = false;\n      this.addButton();\n    }\n    \n    addButton () {\n      this.editor.addButton('kunta_api_service_location_embed', {\n        title: 'Search Kunta API service location channels',\n        onclick: () => {\n          this.editor.windowManager.open({\n            title: 'Search Kunta API service location channels',\n            width: 768,\n            height: 500,\n            body: [\n              { type: 'textbox', name: 'kunta-api-service-query', label: 'Query', onKeyUp: (e) => {     \n                if (!this.searching) {\n                  this.searching = true;\n                  this.searchServiceLocationChannels(e.target.value, (response) => {\n                    this.searching = false;\n                    if (this.pending) {\n                      this.searchServiceLocationChannels(e.target.value, (innerResponse) => {\n                        this.handleResponse(innerResponse);\n                      });\n                    } else {\n                      this.handleResponse(response);\n                    }\n                  });\n                } else {\n                  this.pending = true;\n                }\n              }},\n              {type: 'label', classes: 'kunta-api-search-info', text: \"Kirjoita hakusana yllä olevaan hakukenttään\"},\n              {type: 'container', classes: 'kunta-api-search-results', minHeight: 400}\n            ],\n            onsubmit: (e) => {\n              let responseHtml = '';\n              let allEmbedsFromSameChannel = true;              \n              const componentsToEmbed = $('.service-component-embed-input:checked');\n              const firstServiceLocationChannelId = componentsToEmbed.first().attr('data-service-location-channel-id');\n              const serviceLocationChannelName = componentsToEmbed.first().attr('data-service-location-channel-name');\n              \n              componentsToEmbed.each(function () {\n                var component = $(this).attr('data-component-type');\n                var serviceLocationChannelId = $(this).attr('data-service-location-channel-id');\n                responseHtml += '[kunta_api_location_channel_component channel-id=\"'+ serviceLocationChannelId +'\" component=\"'+ component +'\"]';\n                if (serviceLocationChannelId !== firstServiceLocationChannelId) {\n                  allEmbedsFromSameChannel = false;\n                }\n              });\n\n              if (allEmbedsFromSameChannel) {\n                this.editor.windowManager.confirm(\"Merkitäänkö sivu palvelukanavan: \"+ serviceLocationChannelName + \" sivuksi?\", function(confirmed) {\n                  if (confirmed) {\n                    const pageId = $('#post_ID').val();\n                    this.markAsServiceLocationPage(firstServiceLocationChannelId, pageId);\n                  }\n                });\n              }\n\n              this.editor.insertContent(responseHtml);\n            }\n          });\n        }\n      });\n    }\n    \n    markAsServiceLocationPage(serviceLocationChannelId, pageId) {\n      $.post( ajaxurl, {\n        'action': 'kunta_api_mark_page_as_location_page',\n        'pageId': pageId,\n        'locationChannelId': serviceLocationChannelId\n      }, (response) => {\n      });\n    }\n    \n    searchServiceLocationChannels(query, callback) {\n      $('.mce-kunta-api-search-results').empty();\n      $('.mce-kunta-api-search-results').append($('<div>').addClass('mce-kunta-api-search-results-loader'));\n      $('.mce-kunta-api-search-info').text('Ladataan...');\n      $.post(ajaxurl, {\n        'action': 'kunta_api_search_service_location_channels',\n        'data': query\n      }, (response) => {\n        $('.mce-kunta-api-search-results-loader').remove();\n        callback(JSON.parse(response));\n      });\n    }\n    \n    getLocalizedValueAndType(values, locale, type) {\n      for (let i = 0; i < values.length; i++) {\n        if (locale === values[i].language && type === values[i].type) {\n          return values[i].value;\n        }\n      }\n      \n      return null;\n    }\n    \n    appendResult(result) {\n      const resultContainer = $('<div>').addClass('mce-kunta-api-search-result-row');\n      const name = this.getLocalizedValueAndType(result.names, this.displayLocale, 'Name');\n\n      resultContainer.append(\n        $('<p>')\n          .addClass('mce-kunta-api-search-result-title')\n          .text(name)\n      );\n      \n      Object.keys(SUPPORTED_COMPONENTS).forEach((component) => {\n        const options = SUPPORTED_COMPONENTS[component]; \n        resultContainer.append(\n          $('<p>')\n            .append($('<input>')\n            .addClass('service-component-embed-input')\n            .attr({\n              'type':'checkbox',\n              'data-service-location-channel-name': name,\n              'data-component-type': component,\n              'data-service-location-channel-id': result.id\n            }))\n            .append($('<span>').text(options.title))\n        );\n      });\n      \n      $('.mce-kunta-api-search-results').append(resultContainer);\n    }\n    \n    handleResponse(response) {\n      $('.mce-kunta-api-search-results').empty();\n\n      if (response.length === 0) {\n        $('.mce-kunta-api-search-info').text('Hakusanalla ei löytynyt yhtään palvelua');\n      } else {\n        $('.mce-kunta-api-search-info').text('Kirjoita hakusana yllä olevaan hakukenttään');\n      }\n\n      for (let i = 0; i < response.length; i++) {\n        this.appendResult(response[i]);\n      }\n\n    }\n    \n  }\n  \n  tinymce.PluginManager.add('kunta_api_service_location_embed', (editor, url) => {\n    new ServiceLocationServiceChannelEmbed(editor);\n    new ServiceLocationServiceChannelEditor(editor);\n  });\n  \n})(tinymce, jQuery);"]}
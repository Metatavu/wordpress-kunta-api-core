{"version":3,"sources":["../src/kunta-api-service-location-channel-embed/js/plugin.js"],"names":["tinymce","$","SUPPORTED_COMPONENTS","ServiceLocationServiceChannelDialog","editor","serviceChannel","on","onAfterDialogOpen","bind","updatedChannel","Promise","resolve","reject","post","ajaxurl","JSON","stringify","response","fail","responseText","statusText","getServiceLocationServiceChannelMetaform","viewModel","getServiceLocationChannelAdditionalDetailsMetaform","additionalDetailsToForm","then","formValues","dialog","openMetaformDialog","prepareViewModel","newFormValues","additionalDetailsFromForm","createLanguagesAutocomplete","find","languageCodes","createAreasAutocomplete","areaCodes","serviceLocationServiceChannel","addressSubtypes","j","addresses","length","address","subtype","i","push","existingLocationServiceChannel","parse","descriptions","emails","phoneNumbers","supportedLocales","forEach","locale","localeValues","localeAddresses","filter","street","trim","localeAddress","addressIndex","additionalInformations","streetAddress","type","country","additionalInformation","postalCode","postOfficeCode","streetNumber","foreignAddresses","foreign","foreignAddress","foreignAddressIndex","locationAbroad","concat","email","map","phoneNumber","prefixNumber","number","Object","assign","isFinnishServiceNumber","faxes","fax","webPages","webPage","url","description","shortDescription","languagesToForm","languages","areasToForm","areas","areaType","split","areasFromForm","name","getTypedLocalizedValue","names","visitAddresses","language","getLocalizedWebPages","getLocalizedValue","value","data","onAddServiceHourClick","onEditServiceHourClick","onRemoveServiceHourClick","onEditAdditionalDetailsClick","redrawServiceHours","event","openServiceHourEditDialog","createdServiceHour","serviceHours","openAdditionalDetailsEditDialog","row","target","closest","index","serviceHour","updatedServiceHour","splice","window","AbstractServiceChannelEditorDialog","ServiceLocationServiceChannelEditor","buttonStyle","onBeforeSetcontent","onGetContent","onDblClick","addCommand","onServiceLocationChannelEdit","string","result","re","match","exec","title","content","replace","all","tag","attributesText","end","attributes","parseAttributes","placeholder","attr","css","attribute","component","getComponentTitle","append","html","input","shortcodeAttributes","attributeNames","attributeName","attributeValue","join","element","placeholderAttr","serviceLocationServiceChannelId","execCommand","id","callback","replaceShortcodes","restoreShortcodes","openElementEditor","ui","options","findServiceLocationServiceChannel","err","tinyMCE","activeEditor","windowManager","alert","open","ServiceLocationServiceChannelEmbed","displayLocale","searching","pending","addButton","onclick","width","height","body","label","onKeyUp","e","searchServiceLocationChannels","innerResponse","handleResponse","classes","text","minHeight","onsubmit","responseHtml","allEmbedsFromSameChannel","componentsToEmbed","firstServiceLocationChannelId","first","serviceLocationChannelName","each","serviceLocationChannelId","confirm","confirmed","pageId","val","markAsServiceLocationPage","insertContent","query","empty","addClass","remove","values","resultContainer","getLocalizedValueAndType","keys","appendResult","PluginManager","add","jQuery"],"mappings":"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","file":"plugin.js","sourcesContent":["/* jshint esversion: 6 */\n/* global ajaxurl, tinymce, moment, Promise */\n((tinymce, $) => {\n  \n  const SUPPORTED_COMPONENTS = {\n    'name': {\n      'title': 'Palvelupisteen nimi'\n    },\n    'description': {\n      'title': 'Palvelupisteen kuvaus'\n    },\n    'email': {\n      'title': 'Palvelupisteen sähköpostiosoitteet'\n    },\n    'addresses': {\n      'title': 'Palvelupisteen osoitetiedot'\n    },\n    'fax': {\n      'title': 'Palvelupisteen faksi'\n    },\n    'phone': {\n      'title': 'Palvelupisteen puhelinnumerot'\n    },\n    'servicehours': {\n      'title': 'Palvelupisteen aukioloajat'\n    },\n    'webpages': {\n      'title': 'Palvelupisteen verkkosivustot'\n    }\n  };\n  \n  class ServiceLocationServiceChannelDialog extends window.AbstractServiceChannelEditorDialog {\n    \n    /**\n     * Constructs service location service channel dialog\n     * \n     * @param {Object} editor TinyMCE editor instance\n     * @param {Object} serviceChannel service channel\n     */\n    constructor(editor, serviceChannel) {\n      super(editor, serviceChannel);\n      \n      this.on(\"afterDialogOpen\", this.onAfterDialogOpen.bind(this));\n    }\n    \n    /**\n     * Saves the channel\n     * \n     * @param updatedChannel channel data\n     * @returns {Promise} promise for save result\n     */\n    saveChannel(updatedChannel) {\n      return new Promise((resolve, reject) => {\n        $.post(ajaxurl, {\n          'action': 'kunta_api_save_service_location_service_channel',\n          'serviceLocationServiceChannel': JSON.stringify(updatedChannel)\n        }, (response) => {\n          resolve();\n        })\n        .fail((response) => {\n          reject(response.responseText || response.statusText || \"Unknown error occurred\");\n        });\n      });\n    }\n    \n    /**\n     * Returns main form for service channel\n     * \n     * @returns {Object} metaform\n     */\n    getServiceChannelFormViewModel() {\n      return getServiceLocationServiceChannelMetaform();\n    }\n    \n    openAdditionalDetailsEditDialog() {\n      const viewModel = getServiceLocationChannelAdditionalDetailsMetaform();\n      this.additionalDetailsToForm(this.serviceChannel).then((formValues) => {\n        const dialog = this.openMetaformDialog(this.prepareViewModel(viewModel), formValues, (newFormValues) => {\n          this.additionalDetailsFromForm(newFormValues);\n        });\n        \n        this.createLanguagesAutocomplete(dialog.find('*[data-name=\"languages\"]'), formValues.languageCodes);\n        this.createAreasAutocomplete(dialog.find('*[data-name=\"areas\"]'), formValues.areaCodes);\n      });\n      \n    }\n    \n    validate(serviceLocationServiceChannel) {\n      const addressSubtypes = [];\n      \n      for (let j = 0; j < serviceLocationServiceChannel.addresses.length; j++) {\n        const address = serviceLocationServiceChannel.addresses[j];\n        if (address.subtype === \"Abroad\" || address.subtype === \"Single\") {\n          for (let i = 0; i < addressSubtypes.length; i++) {\n            if (addressSubtypes[i] !== address.subtype) {\n              return \"Toimipisteellä ei voi olla yhtäaikaa kotimaista ja ulkomaista osoitetta\"; \n            }\n          }\n        }\n        \n        addressSubtypes.push(address.subtype);\n      }\n      \n      return null;\n    }\n    \n    serviceChannelFromForm(existingLocationServiceChannel, formValues) {\n      const serviceLocationServiceChannel = JSON.parse(JSON.stringify(existingLocationServiceChannel));\n      serviceLocationServiceChannel.addresses = [];\n      serviceLocationServiceChannel.descriptions = [];\n      serviceLocationServiceChannel.emails = [];\n      serviceLocationServiceChannel.phoneNumbers = [];\n      \n      this.supportedLocales.forEach((locale) => {\n        const localeValues = formValues[locale];\n        \n        const localeAddresses = JSON.parse(localeValues.addresses).filter((address) => {\n          return !!address.street && !!address.street.trim();\n        });\n        \n        localeAddresses.forEach((localeAddress, addressIndex) => {\n          let address;\n          if (serviceLocationServiceChannel.addresses.length - 1 < addressIndex) {\n            address = {\n              additionalInformations: [],\n              streetAddress: [],\n              subtype: 'Single',\n              type: 'Location',\n              country: 'FI'\n            };\n            \n            serviceLocationServiceChannel.addresses.push(address);\n          } else {\n            address = serviceLocationServiceChannel.addresses[addressIndex];\n          }\n          \n          if (localeAddress.additionalInformation) {\n            localeAddress.additionalInformation = localeAddress.additionalInformation.trim();\n          }\n          \n          if (localeAddress.additionalInformation) {\n            address.additionalInformations.push({\n              \"language\": locale,\n              \"value\": localeAddress.additionalInformation\n            });\n          }\n        \n          address.streetAddress.push({\n            \"language\": locale,\n            \"value\": localeAddress.street\n          });\n          \n          address.postalCode = localeAddress.postOfficeCode;\n          address.streetNumber = localeAddress.streetNumber;\n        });\n        \n        const foreignAddresses = JSON.parse(localeValues.foreignAddresses).filter((address) => {\n          return !!address.foreign;\n        });\n        \n        foreignAddresses.forEach((foreignAddress, foreignAddressIndex) => {\n          const addressIndex = localeAddresses.length + foreignAddressIndex;\n          \n          let address;\n          if (serviceLocationServiceChannel.addresses.length - 1 < addressIndex) {\n            address = {\n              subtype: 'Abroad',\n              type: 'Location',\n              locationAbroad: []\n            };            \n            serviceLocationServiceChannel.addresses.push(address);\n          } else {\n            address = serviceLocationServiceChannel.addresses[addressIndex];\n          }\n          \n          address.locationAbroad.push({\n            \"language\": locale,\n            \"value\": foreignAddress.foreign\n          });\n        });\n        \n        serviceLocationServiceChannel.emails = serviceLocationServiceChannel.emails.concat(\n          JSON.parse(localeValues.emails)\n            .filter((email) => {\n              return !!email.email;\n            })\n            .map((email) => {\n              return {\n                \"language\": locale,\n                \"value\": email.email\n              };\n            })\n        );\n\n        serviceLocationServiceChannel.phoneNumbers = serviceLocationServiceChannel.phoneNumbers.concat(\n          JSON.parse(localeValues.phoneNumbers)\n            .filter((phoneNumber) => {\n              return !!phoneNumber.prefixNumber && !!phoneNumber.number;\n            })\n            .map((phoneNumber) => {\n              return Object.assign(phoneNumber, {\n                \"type\": \"Phone\",\n                \"language\": locale,\n                \"isFinnishServiceNumber\": phoneNumber.isFinnishServiceNumber === \"true\"\n              });\n            })\n        );\n\n        serviceLocationServiceChannel.phoneNumbers = serviceLocationServiceChannel.phoneNumbers.concat(\n          JSON.parse(localeValues.faxes)\n            .filter((fax) => {\n              return !!fax.prefixNumber && !!fax.number;\n            })\n            .map((fax) => {\n              return {\n                \"type\": \"Fax\",\n                \"language\": locale,\n                \"number\": fax.number,\n                \"prefixNumber\": fax.prefixNumber,\n                \"isFinnishServiceNumber\": false\n              };\n            })\n        );\n\n        serviceLocationServiceChannel.webPages = serviceLocationServiceChannel.webPages.concat(\n          JSON.parse(localeValues.webPages)\n            .filter((webPage) => {\n              return !!webPage.url;\n            })\n            .map((webPage) => {\n              return Object.assign(webPage, {\n                \"language\": locale\n              });\n            })\n        );\n        \n        if (localeValues.description) {\n          localeValues.description = localeValues.description.trim();\n        }\n        \n        if (localeValues.description) {\n          serviceLocationServiceChannel.descriptions.push({\n            \"language\": locale,\n            \"value\": localeValues.description,\n            \"type\": \"Description\"\n          });\n        }\n        \n        if (localeValues.shortDescription) {\n          localeValues.shortDescription = localeValues.shortDescription.trim();\n        }\n      \n        if (localeValues.shortDescription) {\n          serviceLocationServiceChannel.descriptions.push({\n            \"language\": locale,\n            \"value\": localeValues.shortDescription,\n            \"type\": \"ShortDescription\"\n          });\n        }\n      });\n      \n      return serviceLocationServiceChannel;\n    }\n    \n    additionalDetailsToForm(serviceLocationServiceChannel) {\n      return this.languagesToForm(serviceLocationServiceChannel.languages)\n        .then((languageCodes) => {\n          return {\n            languageCodes: languageCodes,\n            areaCodes: this.areasToForm(serviceLocationServiceChannel.areas),\n            areaType: serviceLocationServiceChannel.areaType\n          };\n        });\n    }\n    \n    additionalDetailsFromForm(newFormValues) {\n      this.serviceChannel.areaType = newFormValues.areaType;\n      this.serviceChannel.languages = (newFormValues.languages||'').split(',');\n      this.serviceChannel.areas = this.areasFromForm(newFormValues.areaType, newFormValues.areas);\n    }\n   \n    serviceChannelToForm(locale) {\n      const name = this.getTypedLocalizedValue(this.serviceChannel.names, locale, 'Name');\n      const shortDescription = this.getTypedLocalizedValue(this.serviceChannel.descriptions, locale, 'ShortDescription');\n      const description = this.getTypedLocalizedValue(this.serviceChannel.descriptions, locale, 'Description');\n      const visitAddresses = this.serviceChannel.addresses.filter((address) => {\n        return address.subtype !== 'Abroad';\n      });\n      \n      const foreignAddresses = this.serviceChannel.addresses.filter((address) => {\n        return address.subtype === 'Abroad';\n      });\n      \n      const emails = this.serviceChannel.emails.filter((email) => {\n        return locale === email.language;\n      });\n      \n      const faxes = this.serviceChannel.phoneNumbers.filter((phoneNumber) => {\n        return phoneNumber.type === 'Fax' && locale === phoneNumber.language;\n      });\n      \n      const phoneNumbers = this.serviceChannel.phoneNumbers.filter((phoneNumber) => {\n        return phoneNumber.type === 'Phone' && locale === phoneNumber.language;\n      });\n      \n      const webPages = this.getLocalizedWebPages(this.serviceChannel.webPages, locale);\n      \n      const addresses = visitAddresses.map((address) => {\n        return {\n          street: this.getLocalizedValue(address.streetAddress, locale),\n          streetNumber: address.streetNumber,\n          postOfficeCode: address.postalCode,\n          additionalInformation: this.getLocalizedValue(address.additionalInformations, locale) \n        };\n      });\n      \n      return {\n        name: name,\n        description: description,\n        shortDescription: shortDescription,\n        addresses: addresses,\n        emails: emails.map((email) => {\n          return {\n            email: email.value\n          };\n        }),\n        phoneNumbers: phoneNumbers.map((phoneNumber) => {\n          return Object.assign(phoneNumber, {\n            isFinnishServiceNumber: phoneNumber.isFinnishServiceNumber ? 'true' : 'false'\n          });\n        }),\n        faxes: faxes,\n        foreignAddresses: foreignAddresses.map((foreignAddress) => {\n          return {\n            foreign: this.getLocalizedValue(foreignAddress.locationAbroad, locale)\n          };\n        }),\n        webPages: webPages\n      };\n    }\n    \n    /**\n     * Method invoked after dialog open\n     * \n     * @param {Object} data event data\n     */\n    onAfterDialogOpen(data) {\n      const dialog = data.dialog;\n      \n      $(dialog).on('click', '.add-service-hour', this.onAddServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-service-hour', this.onEditServiceHourClick.bind(this));\n      $(dialog).on('click', '.remove-service-hour', this.onRemoveServiceHourClick.bind(this));\n      $(dialog).on('click', '.edit-additional-details', this.onEditAdditionalDetailsClick.bind(this));\n      \n      this.redrawServiceHours();\n    }\n    \n    onAddServiceHourClick(event) {\n      this.openServiceHourEditDialog(null, (createdServiceHour) => {\n        this.serviceChannel.serviceHours.push(createdServiceHour);\n        this.redrawServiceHours();\n      });\n    }\n    \n    onEditAdditionalDetailsClick() {\n      this.openAdditionalDetailsEditDialog(this.serviceChannel);\n    }\n    \n    onEditServiceHourClick(event) {\n      const row = $(event.target).closest('tr');\n      const index = row.index();\n      const serviceHour = this.serviceChannel.serviceHours[index];\n      \n      this.openServiceHourEditDialog(serviceHour, (updatedServiceHour) => {\n        this.serviceChannel.serviceHours.splice(index, 1, updatedServiceHour);\n        this.redrawServiceHours();\n      });\n    }\n    \n    onRemoveServiceHourClick(event) {\n      const row = $(event.target).closest('tr');\n      const index = row.index();\n      this.serviceChannel.serviceHours.splice(index, 1);\n      this.redrawServiceHours();\n    }\n    \n  }\n  \n  class ServiceLocationServiceChannelEditor {\n    \n    constructor (editor) {\n      this.buttonStyle = {\n        'color': '#555',\n        'width': '100%',\n        'border': '1px solid #ccc',\n        'background': '#f7f7f7',\n        'display': 'block',\n        'padding': '5px',\n        'margin-top': '5px',\n        'margin-bottom': '5px',\n        'cursor': 'pointer'\n      };\n      \n      this.editor = editor;\n      \n      this.editor.on('BeforeSetcontent', this.onBeforeSetcontent.bind(this));\n      this.editor.on('GetContent', this.onGetContent.bind(this));\n      this.editor.on('DblClick', this.onDblClick.bind(this));\n      this.editor.addCommand('kunta-api-service-location-channel-edit', this.onServiceLocationChannelEdit.bind(this));\n    }\n    \n    parseAttributes (string) {\n      const result = [];\n      const re = /([a-zA-Z-_]*)(\\=\\\")([a-zA-Z0-9-]*)(\\\")/g;\n      let match = null;\n      \n      do {\n        match = re.exec(string);\n        if (match && match.length > 3) {\n          result.push({\n            name: match[1],\n            value: match[3] \n          });\n        }\n      } while (match);\n\n      return result;\n    }\n    \n    getComponentTitle (name) {\n      return SUPPORTED_COMPONENTS[name].title;\n    }\n    \n    replaceShortcodes(content) {\n      return content.replace(/(\\[kunta_api_location_channel_component)([a-zA-Z0-9 -=]*)(\\])/g, (all, tag, attributesText, end) => {\n        const attributes = this.parseAttributes(attributesText);\n        const placeholder = $('<input>')\n          .attr({\n           'type': 'button',\n           'data-kunta-api-placeholder': 'location_channel_component'\n          })\n          .css(this.buttonStyle);\n          \n        for (let i = 0; i < attributes.length; i++) {\n          const attribute = attributes[i];\n          placeholder.attr('data-' + attribute.name, attribute.value);\n        }\n        \n        const component = placeholder.attr('data-component');\n        if (!SUPPORTED_COMPONENTS[component]) {\n          return all;\n        }\n        \n        placeholder.attr('value', this.getComponentTitle(component));\n        return $('<div>').append(placeholder).html();\n      });\n      \n    }\n    \n    restoreShortcodes(content) {\n      return content.replace(/<input [^>]+>/g, (match) => {\n        const input = $(match);\n        \n        if (input.attr('data-kunta-api-placeholder') === 'location_channel_component') {\n          const shortcodeAttributes = [];\n          const attributeNames = ['channel-id', 'component'];\n          \n          for (let i = 0; i < attributeNames.length; i++) {\n            const attributeName = attributeNames[i];\n            const attributeValue = input.attr('data-' + attributeName);\n            shortcodeAttributes.push([attributeName, '\"' + attributeValue + '\"'].join('='));\n          }\n          \n          return '[kunta_api_location_channel_component ' + shortcodeAttributes.join(' ') + ']';\n        }\n        \n        return match;\n      });\n    }\n    \n    openElementEditor(element) {\n      const placeholderAttr = element.attributes['data-kunta-api-placeholder'];\n      if (placeholderAttr && placeholderAttr.value === 'location_channel_component') {\n        const serviceLocationServiceChannelId = element.attributes['data-channel-id'].value;\n        this.editor.execCommand('kunta-api-service-location-channel-edit', '', {\n          serviceLocationServiceChannelId: serviceLocationServiceChannelId\n        });\n      }\n    }\n    \n    findServiceLocationServiceChannel(id, callback) {\n      $.post(ajaxurl, {\n        'action': 'kunta_api_load_service_location_service_channel',\n        'serviceLocationServiceChannelId': id\n      }, (response) => {\n        callback(null, JSON.parse(response));\n      })\n      .fail((response) => {\n        callback(response.responseText || response.statusText);\n      });\n    }\n      \n    onBeforeSetcontent(event) {\n      event.content = this.replaceShortcodes(event.content);\n    }\n    \n    onGetContent(event) {\n      event.content = this.restoreShortcodes(event.content);\n    }\n    \n    onDblClick(event) {\n      const element = event.target;\n      this.openElementEditor(element);\n    }\n\n    onServiceLocationChannelEdit(ui, options) {\n      this.findServiceLocationServiceChannel(options.serviceLocationServiceChannelId, (err, serviceLocationServiceChannel) => {\n        if (err) {\n          tinyMCE.activeEditor.windowManager.alert(err);\n        } else {\n          const dialog = new ServiceLocationServiceChannelDialog(this.editor, serviceLocationServiceChannel);\n          dialog.open();\n        }\n      });\n    } \n    \n  }\n  \n  class ServiceLocationServiceChannelEmbed {\n    \n    constructor (editor) {\n      this.editor = editor;\n      this.displayLocale = 'fi';\n      this.searching = false;\n      this.pending = false;\n      this.addButton();\n    }\n    \n    addButton () {\n      this.editor.addButton('kunta_api_service_location_embed', {\n        title: 'Search Kunta API service location channels',\n        onclick: () => {\n          this.editor.windowManager.open({\n            title: 'Search Kunta API service location channels',\n            width: 768,\n            height: 500,\n            body: [\n              { type: 'textbox', name: 'kunta-api-service-query', label: 'Query', onKeyUp: (e) => {     \n                if (!this.searching) {\n                  this.searching = true;\n                  this.searchServiceLocationChannels(e.target.value, (response) => {\n                    this.searching = false;\n                    if (this.pending) {\n                      this.searchServiceLocationChannels(e.target.value, (innerResponse) => {\n                        this.handleResponse(innerResponse);\n                      });\n                    } else {\n                      this.handleResponse(response);\n                    }\n                  });\n                } else {\n                  this.pending = true;\n                }\n              }},\n              {type: 'label', classes: 'kunta-api-search-info', text: \"Kirjoita hakusana yllä olevaan hakukenttään\"},\n              {type: 'container', classes: 'kunta-api-search-results', minHeight: 400}\n            ],\n            onsubmit: (e) => {\n              let responseHtml = '';\n              let allEmbedsFromSameChannel = true;              \n              const componentsToEmbed = $('.service-component-embed-input:checked');\n              const firstServiceLocationChannelId = componentsToEmbed.first().attr('data-service-location-channel-id');\n              const serviceLocationChannelName = componentsToEmbed.first().attr('data-service-location-channel-name');\n              \n              componentsToEmbed.each(function () {\n                var component = $(this).attr('data-component-type');\n                var serviceLocationChannelId = $(this).attr('data-service-location-channel-id');\n                responseHtml += '[kunta_api_location_channel_component channel-id=\"'+ serviceLocationChannelId +'\" component=\"'+ component +'\"]';\n                if (serviceLocationChannelId !== firstServiceLocationChannelId) {\n                  allEmbedsFromSameChannel = false;\n                }\n              });\n\n              if (allEmbedsFromSameChannel) {\n                this.editor.windowManager.confirm(\"Merkitäänkö sivu palvelukanavan: \"+ serviceLocationChannelName + \" sivuksi?\", function(confirmed) {\n                  if (confirmed) {\n                    const pageId = $('#post_ID').val();\n                    this.markAsServiceLocationPage(firstServiceLocationChannelId, pageId);\n                  }\n                });\n              }\n\n              this.editor.insertContent(responseHtml);\n            }\n          });\n        }\n      });\n    }\n    \n    markAsServiceLocationPage(serviceLocationChannelId, pageId) {\n      $.post( ajaxurl, {\n        'action': 'kunta_api_mark_page_as_location_page',\n        'pageId': pageId,\n        'locationChannelId': serviceLocationChannelId\n      }, (response) => {\n      });\n    }\n    \n    searchServiceLocationChannels(query, callback) {\n      $('.mce-kunta-api-search-results').empty();\n      $('.mce-kunta-api-search-results').append($('<div>').addClass('mce-kunta-api-search-results-loader'));\n      $('.mce-kunta-api-search-info').text('Ladataan...');\n      $.post(ajaxurl, {\n        'action': 'kunta_api_search_service_location_channels',\n        'data': query\n      }, (response) => {\n        $('.mce-kunta-api-search-results-loader').remove();\n        callback(JSON.parse(response));\n      });\n    }\n    \n    getLocalizedValueAndType(values, locale, type) {\n      for (let i = 0; i < values.length; i++) {\n        if (locale === values[i].language && type === values[i].type) {\n          return values[i].value;\n        }\n      }\n      \n      return null;\n    }\n    \n    appendResult(result) {\n      const resultContainer = $('<div>').addClass('mce-kunta-api-search-result-row');\n      const name = this.getLocalizedValueAndType(result.names, this.displayLocale, 'Name');\n\n      resultContainer.append(\n        $('<p>')\n          .addClass('mce-kunta-api-search-result-title')\n          .text(name)\n      );\n      \n      Object.keys(SUPPORTED_COMPONENTS).forEach((component) => {\n        const options = SUPPORTED_COMPONENTS[component]; \n        resultContainer.append(\n          $('<p>')\n            .append($('<input>')\n            .addClass('service-component-embed-input')\n            .attr({\n              'type':'checkbox',\n              'data-service-location-channel-name': name,\n              'data-component-type': component,\n              'data-service-location-channel-id': result.id\n            }))\n            .append($('<span>').text(options.title))\n        );\n      });\n      \n      $('.mce-kunta-api-search-results').append(resultContainer);\n    }\n    \n    handleResponse(response) {\n      $('.mce-kunta-api-search-results').empty();\n\n      if (response.length === 0) {\n        $('.mce-kunta-api-search-info').text('Hakusanalla ei löytynyt yhtään palvelua');\n      } else {\n        $('.mce-kunta-api-search-info').text('Kirjoita hakusana yllä olevaan hakukenttään');\n      }\n\n      for (let i = 0; i < response.length; i++) {\n        this.appendResult(response[i]);\n      }\n\n    }\n    \n  }\n  \n  tinymce.PluginManager.add('kunta_api_service_location_embed', (editor, url) => {\n    new ServiceLocationServiceChannelEmbed(editor);\n    new ServiceLocationServiceChannelEditor(editor);\n  });\n  \n})(tinymce, jQuery);"]}
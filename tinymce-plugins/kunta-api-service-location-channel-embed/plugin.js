'use strict';var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if('value'in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called')}return call&&(typeof call==='object'||typeof call==='function')?call:self}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function')}}/* global ajaxurl, tinymce */(function(tinymce,$){var SUPPORTED_COMPONENTS={'name':{'title':'Palvelupisteen nimi'},'description':{'title':'Palvelupisteen kuvaus'},'email':{'title':'Palvelupisteen s\xE4hk\xF6postiosoitteet'},'addresses':{'title':'Palvelupisteen osoitetiedot'},'fax':{'title':'Palvelupisteen faksi'},'phone':{'title':'Palvelupisteen puhelinnumerot'},'servicehours':{'title':'Palvelupisteen aukioloajat'},'webpages':{'title':'Palvelupisteen verkkosivustot'}};var AbstractEditor=function(){function AbstractEditor(dialog,tab){_classCallCheck(this,AbstractEditor);this.dialog=dialog;this.tab=tab}_createClass(AbstractEditor,[{key:'getLocalizedValue',value:function getLocalizedValue(localized,locale){for(var i=0;i<localized.length;i++){if(localized[i].language===locale){return localized[i].value}}return null}},{key:'commitValue',value:function commitValue(locale,values){}}]);return AbstractEditor}();var LocalizedValueEditor=function(_AbstractEditor){_inherits(LocalizedValueEditor,_AbstractEditor);function LocalizedValueEditor(dialog,tab,locale,name,title,multiline){_classCallCheck(this,LocalizedValueEditor);var _this=_possibleConstructorReturn(this,(LocalizedValueEditor.__proto__||Object.getPrototypeOf(LocalizedValueEditor)).call(this,dialog,tab));_this.locale=locale;_this.name=name;_this.title=title;_this.multiline=multiline;return _this}_createClass(LocalizedValueEditor,[{key:'getEditorFields',value:function getEditorFields(values){var value=this.getLocalizedValue(values,this.locale);return[{name:this.name+'.'+this.locale,label:this.title+' ('+this.locale+')',type:'textbox',multiline:this.multiline,value:value}]}},{key:'commitLocalizedValue',value:function commitLocalizedValue(targetList,values,name,type){var _this2=this;var newValue=values[name+'.'+this.locale];var valueUpdated=false;targetList.forEach(function(targetItem,index){if(targetItem.language===_this2.locale&&(!type||type===targetItem.type)){if(newValue){targetItem.value=newValue}else{targetList.splice(index,1)}valueUpdated=true}});if(newValue&&!valueUpdated){var newItem={value:newValue,language:this.locale};if(type){newItem.type=type}targetList.push(newItem)}}}]);return LocalizedValueEditor}(AbstractEditor);;var ServiceLocationServiceChannelNameEditor=function(_LocalizedValueEditor){_inherits(ServiceLocationServiceChannelNameEditor,_LocalizedValueEditor);function ServiceLocationServiceChannelNameEditor(dialog,tab,locale,serviceLocationServiceChannel){_classCallCheck(this,ServiceLocationServiceChannelNameEditor);var _this3=_possibleConstructorReturn(this,(ServiceLocationServiceChannelNameEditor.__proto__||Object.getPrototypeOf(ServiceLocationServiceChannelNameEditor)).call(this,dialog,tab,locale,'name','Nimi',false));_this3.serviceLocationServiceChannel=serviceLocationServiceChannel;return _this3}_createClass(ServiceLocationServiceChannelNameEditor,[{key:'getEditorFields',value:function getEditorFields(){return _get(ServiceLocationServiceChannelNameEditor.prototype.__proto__||Object.getPrototypeOf(ServiceLocationServiceChannelNameEditor.prototype),'getEditorFields',this).call(this,this.serviceLocationServiceChannel.names)}},{key:'commitValue',value:function commitValue(values){_get(ServiceLocationServiceChannelNameEditor.prototype.__proto__||Object.getPrototypeOf(ServiceLocationServiceChannelNameEditor.prototype),'commitLocalizedValue',this).call(this,this.serviceLocationServiceChannel.names,values,'name')}}]);return ServiceLocationServiceChannelNameEditor}(LocalizedValueEditor);;var AbstractServiceLocationServiceChannelDescriptionEditor=function(_LocalizedValueEditor2){_inherits(AbstractServiceLocationServiceChannelDescriptionEditor,_LocalizedValueEditor2);function AbstractServiceLocationServiceChannelDescriptionEditor(dialog,tab,locale,name,title,descriptionType,serviceLocationServiceChannel){_classCallCheck(this,AbstractServiceLocationServiceChannelDescriptionEditor);var _this4=_possibleConstructorReturn(this,(AbstractServiceLocationServiceChannelDescriptionEditor.__proto__||Object.getPrototypeOf(AbstractServiceLocationServiceChannelDescriptionEditor)).call(this,dialog,tab,locale,name,title,true));_this4.serviceLocationServiceChannel=serviceLocationServiceChannel;_this4.descriptionType=descriptionType;return _this4}_createClass(AbstractServiceLocationServiceChannelDescriptionEditor,[{key:'getEditorFields',value:function getEditorFields(){var _this5=this;return _get(AbstractServiceLocationServiceChannelDescriptionEditor.prototype.__proto__||Object.getPrototypeOf(AbstractServiceLocationServiceChannelDescriptionEditor.prototype),'getEditorFields',this).call(this,this.serviceLocationServiceChannel.descriptions.filter(function(description){return description.type===_this5.descriptionType}))}}]);return AbstractServiceLocationServiceChannelDescriptionEditor}(LocalizedValueEditor);;var ServiceLocationServiceChannelShortDescriptionEditor=function(_AbstractServiceLocat){_inherits(ServiceLocationServiceChannelShortDescriptionEditor,_AbstractServiceLocat);function ServiceLocationServiceChannelShortDescriptionEditor(dialog,tab,locale,serviceLocationServiceChannel){_classCallCheck(this,ServiceLocationServiceChannelShortDescriptionEditor);var _this6=_possibleConstructorReturn(this,(ServiceLocationServiceChannelShortDescriptionEditor.__proto__||Object.getPrototypeOf(ServiceLocationServiceChannelShortDescriptionEditor)).call(this,dialog,tab,locale,'short-description','Tiivistelm\xE4','ShortDescription'));_this6.serviceLocationServiceChannel=serviceLocationServiceChannel;return _this6}_createClass(ServiceLocationServiceChannelShortDescriptionEditor,[{key:'commitValue',value:function commitValue(values){_get(ServiceLocationServiceChannelShortDescriptionEditor.prototype.__proto__||Object.getPrototypeOf(ServiceLocationServiceChannelShortDescriptionEditor.prototype),'commitLocalizedValue',this).call(this,this.serviceLocationServiceChannel.descriptions,values,'short-description','ShortDescription')}}]);return ServiceLocationServiceChannelShortDescriptionEditor}(AbstractServiceLocationServiceChannelDescriptionEditor);;var ServiceLocationServiceChannelDescriptionEditor=function(_AbstractServiceLocat2){_inherits(ServiceLocationServiceChannelDescriptionEditor,_AbstractServiceLocat2);function ServiceLocationServiceChannelDescriptionEditor(dialog,tab,locale,serviceLocationServiceChannel){_classCallCheck(this,ServiceLocationServiceChannelDescriptionEditor);var _this7=_possibleConstructorReturn(this,(ServiceLocationServiceChannelDescriptionEditor.__proto__||Object.getPrototypeOf(ServiceLocationServiceChannelDescriptionEditor)).call(this,dialog,tab,locale,'description','Kuvaus','Description'));_this7.serviceLocationServiceChannel=serviceLocationServiceChannel;return _this7}_createClass(ServiceLocationServiceChannelDescriptionEditor,[{key:'commitValue',value:function commitValue(values){_get(ServiceLocationServiceChannelDescriptionEditor.prototype.__proto__||Object.getPrototypeOf(ServiceLocationServiceChannelDescriptionEditor.prototype),'commitLocalizedValue',this).call(this,this.serviceLocationServiceChannel.descriptions,values,'description','Description')}}]);return ServiceLocationServiceChannelDescriptionEditor}(AbstractServiceLocationServiceChannelDescriptionEditor);;var ServiceLocationServiceChannelAbstractMultivalueEditor=function(_AbstractEditor2){_inherits(ServiceLocationServiceChannelAbstractMultivalueEditor,_AbstractEditor2);function ServiceLocationServiceChannelAbstractMultivalueEditor(dialog,tab,supportedLocales,serviceLocationServiceChannel,options){_classCallCheck(this,ServiceLocationServiceChannelAbstractMultivalueEditor);var _this8=_possibleConstructorReturn(this,(ServiceLocationServiceChannelAbstractMultivalueEditor.__proto__||Object.getPrototypeOf(ServiceLocationServiceChannelAbstractMultivalueEditor)).call(this,dialog,tab));_this8.options=options;_this8.index=-1;_this8.serviceLocationServiceChannel=serviceLocationServiceChannel;_this8.supportedLocales=supportedLocales;_this8.dialog.on('open',_this8.onDialogOpen.bind(_this8));return _this8}_createClass(ServiceLocationServiceChannelAbstractMultivalueEditor,[{key:'getValues',value:function getValues(){return[]}},{key:'getEditorFields',value:function getEditorFields(){return[this.createFieldList(this.createFieldSets()),this.createAddButton()]}},{key:'createFieldList',value:function createFieldList(items){return{label:'',type:'container',layout:'grid',id:this.options.baseName+'-list',name:this.options.baseName+'-list',columns:1,items:items}}},{key:'createFieldSets',value:function createFieldSets(){var _this9=this;return this.getValues().map(function(value){return _this9.createFieldSet(value)})}},{key:'createAddButton',value:function createAddButton(){return{id:this.options.baseName+'-add',classes:this.options.baseName+'-add',name:this.options.baseName+'-add',type:'button',text:this.options.addButtonText}}},{key:'commitLocalizedValue',value:function commitLocalizedValue(targetList,values,name,locale){var newValue=values[name];var valueUpdated=false;targetList.forEach(function(targetItem,index){if(targetItem.language===locale){if(newValue){targetItem.value=newValue}else{targetList.splice(index,1)}valueUpdated=true}});if(newValue&&!valueUpdated){targetList.push({value:newValue,language:locale})}}},{key:'onDialogOpen',value:function onDialogOpen(){this.dialog.window.find('#'+this.options.baseName+'-add').on('click',this.onAddAddressClick.bind(this))}},{key:'onAddAddressClick',value:function onAddAddressClick(event){this.dialog.addChildItems('#'+this.options.baseName+'-list',this.createFieldSet())}}]);return ServiceLocationServiceChannelAbstractMultivalueEditor}(AbstractEditor);;var ServiceLocationServiceChannelAddressEditor=function(_ServiceLocationServi){_inherits(ServiceLocationServiceChannelAddressEditor,_ServiceLocationServi);function ServiceLocationServiceChannelAddressEditor(dialog,tab,supportedLocales,serviceLocationServiceChannel){_classCallCheck(this,ServiceLocationServiceChannelAddressEditor);return _possibleConstructorReturn(this,(ServiceLocationServiceChannelAddressEditor.__proto__||Object.getPrototypeOf(ServiceLocationServiceChannelAddressEditor)).call(this,dialog,tab,supportedLocales,serviceLocationServiceChannel,{baseName:'address',addButtonText:'Lis\xE4\xE4 osoite'}))}_createClass(ServiceLocationServiceChannelAddressEditor,[{key:'getValues',value:function getValues(){return this.serviceLocationServiceChannel.addresses}},{key:'createFieldSet',value:function createFieldSet(value){return{label:'Osoite',type:'fieldset',border:'none',layout:'grid',name:'address',columns:2,items:this.createAddressFields(value)}}},{key:'createAddressFields',value:function createAddressFields(address){var _this11=this;var additionalInformation=null;var streetNumber=address?address.streetNumber:null;var postalCode=address?address.postalCode:null;this.index++;var result=[];this.supportedLocales.forEach(function(locale){result.push({'name':_this11.getStreetAddressFieldName(locale,_this11.index),'type':'textbox','label':'Kadunnimi ('+locale+')','value':address?_this11.getLocalizedValue(address.streetAddress,locale):null});result.push({'name':_this11.getAdditionalInformationFieldName(locale,_this11.index),'type':'textbox','label':'Osoitteen lis\xE4tieto ('+locale+')','value':additionalInformation?additionalInformation.value:''})});result.push({'name':this.getStreetNumberFieldName(this.index),'type':'textbox','label':'Osoitenumero','value':streetNumber});result.push({'name':this.getPostalCodeFieldName(this.index),'type':'textbox','label':'Postinumero','value':postalCode});return result}},{key:'commitValue',value:function commitValue(values){var _this12=this;var _loop=function _loop(index){var address=_this12.serviceLocationServiceChannel.addresses[index];if(!address){address={};_this12.serviceLocationServiceChannel.addresses.push(address)}if(!address.streetAddress){address.streetAddress=[]}if(!address.additionalInformations){address.additionalInformations=[]}_this12.supportedLocales.forEach(function(locale){_this12.commitLocalizedValue(address.streetAddress,values,_this12.getStreetAddressFieldName(locale,index),locale);_this12.commitLocalizedValue(address.additionalInformations,values,_this12.getAdditionalInformationFieldName(locale,index),locale)});address.streetNumber=values[_this12.getStreetNumberFieldName(index)];address.postalCode=values[_this12.getPostalCodeFieldName(index)]};for(var index=0;index<this.index+1;index++){_loop(index)}}},{key:'getStreetAddressFieldName',value:function getStreetAddressFieldName(locale,index){return'address-street-address-'+locale+'-'+index}},{key:'getStreetNumberFieldName',value:function getStreetNumberFieldName(index){return'address-street-number-'+index}},{key:'getPostalCodeFieldName',value:function getPostalCodeFieldName(index){return'address-postal-code-'+index}},{key:'getAdditionalInformationFieldName',value:function getAdditionalInformationFieldName(locale,index){return'address-additional-information-'+locale+'-'+index}}]);return ServiceLocationServiceChannelAddressEditor}(ServiceLocationServiceChannelAbstractMultivalueEditor);;var ServiceLocationServiceChannelDialog=function(){function ServiceLocationServiceChannelDialog(editor,serviceLocationServiceChannel){var _this13=this;_classCallCheck(this,ServiceLocationServiceChannelDialog);this.serviceLocationServiceChannel=serviceLocationServiceChannel;this.dialogTitle='Palvelupiste';this.supportedLocales=['fi','en','sv'];this.editor=editor;this.listeners=[];this.editors=[];this.supportedLocales.forEach(function(locale){_this13.editors.push(new ServiceLocationServiceChannelNameEditor(_this13,'basic-'+locale,locale,serviceLocationServiceChannel));_this13.editors.push(new ServiceLocationServiceChannelShortDescriptionEditor(_this13,'basic-'+locale,locale,serviceLocationServiceChannel));_this13.editors.push(new ServiceLocationServiceChannelDescriptionEditor(_this13,'basic-'+locale,locale,serviceLocationServiceChannel))});this.editors.push(new ServiceLocationServiceChannelAddressEditor(this,'addresses',this.supportedLocales,serviceLocationServiceChannel));// TODO: Kielet, joilla palvelupisteessÃ¤ palvellaan
}_createClass(ServiceLocationServiceChannelDialog,[{key:'addChildItems',value:function addChildItems(selector,items){var container=this.window.find(selector)[0];container.append(container.create(items))}},{key:'getLocaleName',value:function getLocaleName(locale){switch(locale){case'fi':return'Suomi';case'en':return'Englanti';case'sv':return'Ruotsi';}}},{key:'createTab',value:function createTab(name,title,items){var tabEditors=this.editors.filter(function(editor){return editor.tab===name});var tabItems=[];if(items){tabItems=items}else{tabEditors.forEach(function(editor){tabItems=tabItems.concat(editor.getEditorFields())})}return{type:'fieldset',name:name,title:title,items:tabItems}}},{key:'saveServiceLocationServiceChannel',value:function saveServiceLocationServiceChannel(serviceLocationServiceChannel,callback){$.post(ajaxurl,{'action':'kunta_api_save_service_location_service_channel','serviceLocationServiceChannel':JSON.stringify(this.serviceLocationServiceChannel)},function(response){callback()}).fail(function(response){callback(response.responseText||response.statusText)})}},{key:'open',value:function open(){var _this14=this;var tabs=[];var contactSubtabs=[];contactSubtabs.push(this.createTab('emails','S\xE4hk\xF6postit'));contactSubtabs.push(this.createTab('fax','Faksit'));contactSubtabs.push(this.createTab('phone','Puhelimet'));contactSubtabs.push(this.createTab('web','Verkkosivut'));tabs.push(this.createTab('common','Yleiset'));this.supportedLocales.forEach(function(locale){tabs.push(_this14.createTab('basic-'+locale,'Perustiedot ('+locale+')'))});tabs.push(this.createTab('addresses','Osoitteet'));tabs.push(this.createTab('times','Palveluajat'));tabs.push(this.createTab('contacts','Yhteystiedot',contactSubtabs));this.window=this.editor.windowManager.open({title:this.dialogTitle,body:[{id:'dialog-form',type:'form',items:[{name:'locales',type:'tabpanel',layout:'fit',items:tabs}]}],width:1000,height:700,buttons:[{text:'Tallenna',subtype:'save',onclick:function onclick(event){var dialogForm=_this14.window.find('form').filter(function(form){return form.settings.id==='dialog-form'})[0];var values=dialogForm.toJSON();_this14.editors.forEach(function(editor){editor.commitValue(values)});_this14.saveServiceLocationServiceChannel(_this14.serviceLocationServiceChannel,function(err){if(err){tinyMCE.activeEditor.windowManager.alert(err)}})}},{text:'Peruuta',onclick:function onclick(){_this14.window.close()}}]});this.trigger('open')}},{key:'trigger',value:function trigger(event,data){this.listeners.forEach(function(listener){if(listener.event===event){listener.callable(data||{})}})}},{key:'on',value:function on(event,callable){this.listeners.push({event:event,callable:callable})}}]);return ServiceLocationServiceChannelDialog}();var ServiceLocationServiceChannelEditor=function(){function ServiceLocationServiceChannelEditor(editor){_classCallCheck(this,ServiceLocationServiceChannelEditor);this.buttonStyle={'color':'#555','width':'100%','border':'1px solid #ccc','background':'#f7f7f7','display':'block','padding':'5px','margin-top':'5px','margin-bottom':'5px','cursor':'pointer'};this.editor=editor;this.editor.on('BeforeSetcontent',this.onBeforeSetcontent.bind(this));this.editor.on('GetContent',this.onGetContent.bind(this));this.editor.on('DblClick',this.onDblClick.bind(this));this.editor.addCommand('kunta-api-service-location-channel-edit',this.onServiceLocationChannelEdit.bind(this))}_createClass(ServiceLocationServiceChannelEditor,[{key:'parseAttributes',value:function parseAttributes(string){var result=[];var re=/([a-zA-Z-_]*)(\=\")([a-zA-Z0-9-]*)(\")/g;var match=null;do{match=re.exec(string);if(match&&match.length>3){result.push({name:match[1],value:match[3]})}}while(match);return result}},{key:'getComponentTitle',value:function getComponentTitle(name){return SUPPORTED_COMPONENTS[name].title}},{key:'replaceShortcodes',value:function replaceShortcodes(content){var _this15=this;return content.replace(/(\[kunta_api_location_channel_component)([a-zA-Z0-9 -=]*)(\])/g,function(all,tag,attributesText,end){var attributes=_this15.parseAttributes(attributesText);var placeholder=$('<input>').attr({'type':'button','data-kunta-api-placeholder':'location_channel_component'}).css(_this15.buttonStyle);for(var i=0;i<attributes.length;i++){var attribute=attributes[i];placeholder.attr('data-'+attribute.name,attribute.value)}var component=placeholder.attr('data-component');if(!SUPPORTED_COMPONENTS[component]){return all}placeholder.attr('value',_this15.getComponentTitle(component));return $('<div>').append(placeholder).html()})}},{key:'restoreShortcodes',value:function restoreShortcodes(content){return content.replace(/<input [^>]+>/g,function(match){var input=$(match);if(input.attr('data-kunta-api-placeholder')==='location_channel_component'){var shortcodeAttributes=[];var attributeNames=['channel-id','component'];for(var i=0;i<attributeNames.length;i++){var attributeName=attributeNames[i];var attributeValue=input.attr('data-'+attributeName);shortcodeAttributes.push([attributeName,'"'+attributeValue+'"'].join('='))}return'[kunta_api_location_channel_component '+shortcodeAttributes.join(' ')+']'}return match})}},{key:'openElementEditor',value:function openElementEditor(element){var placeholderAttr=element.attributes['data-kunta-api-placeholder'];if(placeholderAttr){var serviceLocationServiceChannelId=element.attributes['data-channel-id'].value;this.editor.execCommand('kunta-api-service-location-channel-edit','',{serviceLocationServiceChannelId:serviceLocationServiceChannelId})}}},{key:'findServiceLocationServiceChannel',value:function findServiceLocationServiceChannel(id,callback){$.post(ajaxurl,{'action':'kunta_api_load_service_location_service_channel','serviceLocationServiceChannelId':id},function(response){callback(null,JSON.parse(response))}).fail(function(response){callback(response.responseText||response.statusText)})}},{key:'onBeforeSetcontent',value:function onBeforeSetcontent(event){event.content=this.replaceShortcodes(event.content)}},{key:'onGetContent',value:function onGetContent(event){event.content=this.restoreShortcodes(event.content)}},{key:'onDblClick',value:function onDblClick(event){var element=event.target;this.openElementEditor(element)}},{key:'onServiceLocationChannelEdit',value:function onServiceLocationChannelEdit(ui,options){var _this16=this;this.findServiceLocationServiceChannel(options.serviceLocationServiceChannelId,function(err,serviceLocationServiceChannel){console.log(err,serviceLocationServiceChannel);if(err){tinyMCE.activeEditor.windowManager.alert(err)}else{var dialog=new ServiceLocationServiceChannelDialog(_this16.editor,serviceLocationServiceChannel);dialog.open()}})}}]);return ServiceLocationServiceChannelEditor}();var ServiceLocationServiceChannelEmbed=function(){function ServiceLocationServiceChannelEmbed(editor){_classCallCheck(this,ServiceLocationServiceChannelEmbed);this.editor=editor;this.displayLocale='fi';this.searching=false;this.pending=false;this.addButton()}_createClass(ServiceLocationServiceChannelEmbed,[{key:'addButton',value:function addButton(){var _this17=this;this.editor.addButton('kunta_api_service_location_embed',{title:'Search Kunta API service location channels',onclick:function onclick(){_this17.editor.windowManager.open({title:'Search Kunta API service location channels',width:768,height:500,body:[{type:'textbox',name:'kunta-api-service-query',label:'Query',onKeyUp:function onKeyUp(e){if(!_this17.searching){_this17.searching=true;_this17.searchServiceLocationChannels(e.target.value,function(response){_this17.searching=false;if(_this17.pending){_this17.searchServiceLocationChannels(e.target.value,function(innerResponse){_this17.handleResponse(innerResponse)})}else{_this17.handleResponse(response)}})}else{_this17.pending=true}}},{type:'label',classes:'kunta-api-search-info',text:'Kirjoita hakusana yll\xE4 olevaan hakukentt\xE4\xE4n'},{type:'container',classes:'kunta-api-search-results',minHeight:400}],onsubmit:function onsubmit(e){var responseHtml='';var allEmbedsFromSameChannel=true;var componentsToEmbed=$('.service-component-embed-input:checked');var firstServiceLocationChannelId=componentsToEmbed.first().attr('data-service-location-channel-id');var serviceLocationChannelName=componentsToEmbed.first().attr('data-service-location-channel-name');componentsToEmbed.each(function(){var component=$(this).attr('data-component-type');var serviceLocationChannelId=$(this).attr('data-service-location-channel-id');responseHtml+='[kunta_api_location_channel_component channel-id="'+serviceLocationChannelId+'" component="'+component+'"]';if(serviceLocationChannelId!==firstServiceLocationChannelId){allEmbedsFromSameChannel=false}});if(allEmbedsFromSameChannel){_this17.editor.windowManager.confirm('Merkit\xE4\xE4nk\xF6 sivu palvelukanavan: '+serviceLocationChannelName+' sivuksi?',function(confirmed){if(confirmed){var pageId=$('#post_ID').val();this.markAsServiceLocationPage(firstServiceLocationChannelId,pageId)}})}_this17.editor.insertContent(responseHtml)}})}})}},{key:'markAsServiceLocationPage',value:function markAsServiceLocationPage(serviceLocationChannelId,pageId){$.post(ajaxurl,{'action':'kunta_api_mark_page_as_location_page','pageId':pageId,'locationChannelId':serviceLocationChannelId},function(response){})}},{key:'searchServiceLocationChannels',value:function searchServiceLocationChannels(query,callback){$('.mce-kunta-api-search-results').empty();$('.mce-kunta-api-search-results').append($('<div>').addClass('mce-kunta-api-search-results-loader'));$('.mce-kunta-api-search-info').text('Ladataan...');$.post(ajaxurl,{'action':'kunta_api_search_service_location_channels','data':query},function(response){$('.mce-kunta-api-search-results-loader').remove();callback(JSON.parse(response))})}},{key:'getLocalizedValueAndType',value:function getLocalizedValueAndType(values,locale,type){for(var i=0;i<values.length;i++){if(locale===values[i].language&&type===values[i].type){return values[i].value}}return null}},{key:'appendResult',value:function appendResult(result){var resultContainer=$('<div>').addClass('mce-kunta-api-search-result-row');var name=this.getLocalizedValueAndType(result.names,this.displayLocale,'Name');resultContainer.append($('<p>').addClass('mce-kunta-api-search-result-title').text(name));Object.keys(SUPPORTED_COMPONENTS).forEach(function(component){var options=SUPPORTED_COMPONENTS[component];resultContainer.append($('<p>').append($('<input>').addClass('service-component-embed-input').attr({'type':'checkbox','data-service-location-channel-name':name,'data-component-type':component,'data-service-location-channel-id':result.id})).append($('<span>').text(options.title)))});$('.mce-kunta-api-search-results').append(resultContainer)}},{key:'handleResponse',value:function handleResponse(response){$('.mce-kunta-api-search-results').empty();if(response.length===0){$('.mce-kunta-api-search-info').text('Hakusanalla ei l\xF6ytynyt yht\xE4\xE4n palvelua')}else{$('.mce-kunta-api-search-info').text('Kirjoita hakusana yll\xE4 olevaan hakukentt\xE4\xE4n')}for(var i=0;i<response.length;i++){this.appendResult(response[i])}}}]);return ServiceLocationServiceChannelEmbed}();tinymce.PluginManager.add('kunta_api_service_location_embed',function(editor,url){new ServiceLocationServiceChannelEmbed(editor);new ServiceLocationServiceChannelEditor(editor)})})(tinymce,jQuery);
//# sourceMappingURL=plugin.js.map
